SELECT  observation_date AS event_date,
	    CASE WHEN participant_type = 'visitor' THEN coalesce(participant_id, 0) END AS cookie_id,
  		CASE WHEN participant_type = 'user'    THEN coalesce(participant_id, 0) END AS user_id,
  		participant_id,participant_type,
		platform_id,
		app_pushes_prepared,
		browser_pushes_prepared,
		sms_prepared,
		notification_center_prepared,
		email_prepared,
		app_pushes_no_data,
		browser_pushes_no_data,
		sms_no_data,
		notification_center_no_data,
		email_no_data,
		app_pushes_to_provider,
		browser_pushes_to_provider,
		sms_to_provider,
		notification_center_to_provider,
		email_to_provider,
		app_pushes_to_receiver,
		browser_pushes_to_receiver,
		sms_delivered_to_receiver,
		notification_center_to_receiver,
		email_to_receiver,
		app_pushes_open,
		browser_pushes_open,
		sms_delivered_open,
		notification_center_open,
		email_open,
		app_pushes_action,
		browser_pushes_action,
		sms_delivered_action,
		notification_center_action,
		email_action,
		app_pushes_sav_search_prepared,
		app_pushes_sav_search_no_data,
		app_pushes_sav_search_to_provider,
		app_pushes_sav_search_to_receiver,
		app_pushes_sav_search_open,
		app_pushes_sav_search_action,
  		app_pushes_price_prepared,
		app_pushes_price_no_data,
		app_pushes_price_to_provider,
		app_pushes_price_to_receiver,
		app_pushes_price_open,
		app_pushes_price_action,
  		app_pushes_rec_marketing_prepared,
		app_pushes_rec_marketing_no_data,
		app_pushes_rec_marketing_to_provider,
		app_pushes_rec_marketing_to_receiver,
		app_pushes_rec_marketing_open,
		app_pushes_rec_marketing_action,
  		app_pushes_price_all_prepared,
		app_pushes_price_all_no_data,
		app_pushes_price_all_to_provider,
		app_pushes_price_all_to_receiver,
		app_pushes_price_all_open,
		app_pushes_price_all_action,
		app_pushes_marketing_to_receiver,
		browser_pushes_marketing_to_receiver,
		sms_marketing_to_receiver,
		notification_center_marketing_to_receiver,
		email_marketing_to_receiver,
		app_pushes_rec_to_receiver,
		app_pushes_crm_to_receiver,
		notification_marketing_prepared,
		notification_marketing_no_data,
		notification_marketing_to_provider,
		notification_marketing_to_receiver,
		notification_marketing_open,
		notification_marketing_action,
		notification_rec_prepared,
		notification_rec_no_data,
		notification_rec_to_provider,
		notification_rec_to_receiver,
		notification_rec_open,
		notification_rec_action,
		notification_crm_prepared,
		notification_crm_no_data,
		notification_crm_to_provider,
		notification_crm_to_receiver,
		notification_crm_open,
		notification_crm_action
FROM dma.notifications_metric_observation d
where observation_date::date between :first_date and :last_date
