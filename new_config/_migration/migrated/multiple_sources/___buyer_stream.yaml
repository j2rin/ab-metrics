metric.counter:
  bt_clicks:                               {filter: [{$or: [[*is_booking], [*is_delivery], [*is_fav], [*is_msg], [*is_msg_btn], [*is_ph_tot]]}], obs: [realty_development_phone_views]}
  bt_clicks_new:                           {filter: [{$or: [[*is_booking], [*is_delivery], [*is_fav], [*is_msg_btn], [*is_ph_tot]]}], obs: [new_first_messages, realty_development_phone_views]}
  btc_funnel_all:                          {filter: [{$or: [[*is_booking], [*is_delivery], [*is_fav], [*is_msg], [*is_msg_btn], [*is_ph_tot]]}], obs: [answered_proxy_calls, call_phone_screen_views_client, missed_proxy_calls, realty_development_phone_views, total_delivery_click]}
  btc_funnel_first:                        {filter: [{$or: [[*is_fav], [*is_msg_btn], [*is_ph_tot]]}], obs: [realty_development_phone_views, total_delivery_click]}
  btc_funnel_second:                       {filter: [{$or: [[*is_booking], [*is_delivery], [*is_msg]]}], obs: [answered_proxy_calls, call_phone_screen_views_client, missed_proxy_calls]}
  cnt_book_dlv_favorites_added_fmsg_ph_realty_development: {filter: [{$or: [[*is_booking], [*is_delivery], [*is_fav], [*is_msg], [*is_ph_tot]]}], obs: [realty_development_phone_views], m42: False}
  cnt_book_dlv_favorites_added_new_fmsg_ph_realty_development: {filter: [{$or: [[*is_booking], [*is_delivery], [*is_fav], [*is_ph_tot]]}], obs: [new_first_messages, realty_development_phone_views], m42: False}
  cnt_book_dlv_flow_beginings_fmsg_ph_realty_development: {filter: [{$or: [[*is_booking], [*is_delivery], [*is_delivery_btn], [*is_msg], [*is_ph_tot]]}], obs: [realty_development_phone_views], m42: False}
  cnt_book_dlv_fmsg_ph_item_right_top_realty_development: {filter: [{$or: [[*is_booking], [*is_delivery], [*is_msg], [*is_ph, *is_ph_right], [*is_ph, *is_ph_top]]}], obs: [realty_development_phone_views], m42: False}
  cnt_ph_realty_development:               {filter: [*is_ph_tot], obs: [realty_development_phone_views], m42: False}
  cnt_sessions_active:                     {filter: [{$or: [[*is_1p, *is_search], [*is_booking], [*is_delivery], [*is_delivery_btn], [*is_fav], [*is_iv], [*is_msg], [*is_msg_btn], [*is_ph_tot]]}], obs: [realty_development_phone_views], m42: False}
  cnt_sessions_btc:                        {filter: [{$or: [[*is_booking], [*is_delivery], [*is_delivery_btn], [*is_fav], [*is_msg], [*is_msg_btn], [*is_ph_tot]]}], obs: [realty_development_phone_views], m42: False}
  cnt_users:                               {filter: [{$or: [[*is_1p, *is_search, *noq], [*is_1p, *is_search, *q], [*is_booking], [*is_delivery_btn], [*is_fav], [*is_iv], [*is_msg], [*is_ph_tot]]}], obs: [delivery_order_creasted, realty_development_phone_views], m42: False}
  cnt_users_1plus_actions:                 {filter: [{$or: [[*is_1p, *is_search, *noq], [*is_1p, *is_search, *q], [*is_booking], [*is_delivery], [*is_delivery_btn], [*is_fav], [*is_iv], [*is_msg], [*is_ph_tot]]}], obs: [realty_development_phone_views], m42: False}
  contacts:                                {filter: [{$or: [[*is_booking], [*is_delivery], [*is_msg], [*is_ph_tot]]}], obs: [realty_development_phone_views]}
  contacts_new:                            {filter: [{$or: [[*is_booking], [*is_delivery], [*is_ph_tot]]}], obs: [new_first_messages, realty_development_phone_views]}
  searches_witcher_any:                    {filter: [*is_1p, *is_search, {$or: [[*x_is_witcher_new_auto], [*x_is_witcher_new_flats], [*x_is_witcher_regions]]}], obs: [searches_witcher_delivery]}

metric.uniq:
  bt_clicks_grouped:                       {counter: bt_clicks,                       key: [item, participant]}
  bt_clicks_grouped_new:                   {counter: bt_clicks_new,                   key: [item, participant]}
  contacts_grouped:                        {counter: contacts,                        key: [item, participant]}
  contacts_grouped_new:                    {counter: contacts_new,                    key: [item, participant]}
  buyers:                                  {counter: contacts,                        key: [participant]}
  buyers_new:                              {counter: contacts_new,                    key: [participant]}
  unq_users:                               {counter: cnt_users,                       key: [participant], m42: False}
  user_pv:                                 {counter: cnt_ph_realty_development,       key: [participant]}
  user_witcher_any:                        {counter: searches_witcher_any,            key: [participant]}
  users_1plus_actions:                     {counter: cnt_users_1plus_actions,         key: [participant]}
  users_2plus_actions:                     {counter: cnt_users_1plus_actions,         key: [participant]}
  users_active_daily:                      {counter: cnt_users_1plus_actions,         key: [participant]}
  users_bt_click_daily:                    {counter: cnt_book_dlv_favorites_added_fmsg_ph_realty_development, key: [participant]}
  users_bt_click_daily_new:                {counter: cnt_book_dlv_favorites_added_new_fmsg_ph_realty_development, key: [participant]}
  users_btc_funnel_all:                    {counter: btc_funnel_all,                  key: [participant]}
  users_btc_funnel_first:                  {counter: btc_funnel_first,                key: [participant]}
  users_btc_funnel_second:                 {counter: btc_funnel_second,               key: [participant]}
  sess_btc_funnel_all:                     {counter: btc_funnel_all,                  key: [participant, session]}
  sess_btc_funnel_first:                   {counter: btc_funnel_first,                key: [participant, session]}
  sess_btc_funnel_second:                  {counter: btc_funnel_second,               key: [participant, session]}
  sessions_active:                         {counter: cnt_sessions_active,             key: [participant, session]}
  sessions_btc:                            {counter: cnt_sessions_btc,                key: [participant, session]}
  sessions_c:                              {counter: cnt_book_dlv_flow_beginings_fmsg_ph_realty_development, key: [participant, session]}

metric.ratio:
  ad_pages_to_contact:                     {num: cnt_ad_pages_to_c,               den: buyers}
  btc_from_witcher_any_per_witcher_any:    {num: btc_from_witcher_any,            den: searches_witcher_any}
  buyers_per_users:                        {num: buyers,                          den: users_active_daily}
  buyers_per_users_favorites:              {num: buyers,                          den: users_favorites}
  c_from_witcher_any_per_witcher_any:      {num: c_from_witcher_any,              den: searches_witcher_any}
  contacts_per_item_view:                  {num: cnt_book_dlv_fmsg_ph_item_right_top_realty_development, den: item_views}
  contacts_total_vas_per_contacts:         {num: contacts_total_vas,              den: contacts}
  correct_and_map_searches_and_iv_to_contact: {num: cnt_correct_and_map_s_iv_to_c,   den: buyers}
  correct_searches_and_iv_to_contact:      {num: cnt_correct_s_and_iv_to_c,       den: buyers}
  correct_searches_to_contact:             {num: cnt_correct_s_to_c,              den: buyers}
  item_views_to_contact:                   {num: cnt_iv_to_c,                     den: buyers}
  iv_from_witcher_any_per_witcher_any:     {num: iv_from_witcher_any,             den: searches_witcher_any}
  map_searches_and_iv_to_contact:          {num: cnt_map_s_and_iv_to_c,           den: buyers}
  map_searches_to_contact:                 {num: cnt_map_s_to_c,                  den: buyers}
  searches_and_item_views_to_contact:      {num: cnt_s_and_iv_to_c,               den: buyers}
  searches_from_witcher_any_per_witcher_any: {num: searches_from_witcher_any,       den: searches_witcher_any}
  searches_to_contact:                     {num: cnt_s_to_c,                      den: buyers}
  searches_witcher_any_per_search:         {num: searches_witcher_any,            den: searches}
  searches_witcher_any_with_btc_per_witcher_any: {num: s_witcher_any_with_btc,          den: searches_witcher_any}
  searches_witcher_any_with_iv_per_witcher_any: {num: s_witcher_any_with_iv,           den: searches_witcher_any}
  sessions_btc_per_active:                 {num: sessions_btc,                    den: sessions_active}
  sessions_c_per_active:                   {num: sessions_c,                      den: sessions_active}
  sessions_iv_per_active:                  {num: sessions_iv,                     den: sessions_active}
  user_fatal_error_per_users:              {num: users_fatal_app_errors,          den: unq_users}
  user_non_fatal_error_per_users:          {num: users_non_fatal_app_errors,      den: users_active_daily}
  user_witcher_any_with_iv_per_user_witcher_any: {num: unq_s_wtc_dlv_with_iv_new_auto_flats_reg, den: user_witcher_any}
  user_witcher_btc_per_user_witcher_any:   {num: unq_s_wtc_dlv_with_btc_new_auto_flats_reg, den: user_witcher_any}
  users_bt_click_per_users:                {num: users_bt_click_daily,            den: users_active_daily}
  users_item_view_per_users:               {num: users_item_view_daily,           den: users_active_daily}
  wtc_per_witcher_any:                     {num: wtc_from_witcher_any,            den: searches_witcher_any}

