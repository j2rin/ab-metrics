definitions:
  - &callback_scenario  [notification_call_back,deeplink_call_back,call_log_callback]
  - &direct_scenario    [item,item_gallery,item_feed,item_feed_photo,messenger_chat_menu,messenger_empty_chat]
  - &item_scenario      [item,item_gallery,item_feed,item_feed_photo]
  - &any_scenario       [item,item_gallery,item_feed,item_feed_photo,messenger_chat_menu,messenger_empty_chat,notification_call_back,deeplink_call_back,call_log_callback]

  - &is_callback_c      {AppCallScenario: *callback_scenario}
  - &is_direct_c        {AppCallScenario: *direct_scenario}
  - &is_item_c          {AppCallScenario: *item_scenario}
  - &is_c               {AppCallScenario: *any_scenario}
  - &is_messenger_chat_menu  {AppCallScenario: messenger_chat_menu}
  - &is_deeplink_call_back   {AppCallScenario: deeplink_call_back}
  - &is_outgoing        {CallType: outgoing}
  - &is_incoming        {CallType: incoming}
  - &is_answered        {TalkDuration.>: 0}
  - &is_success         {TalkDuration.>: 30}
  - &is_less5           {TalkDuration.<: 5}
  - &is_less15          {TalkDuration.<: 15}
  - &is_less60          {TalkDuration.<: 60}
  - &is_less120         {TalkDuration.<: 120}
  - &is_less300         {TalkDuration.<: 300}

metric.counter:

  appcall_bx_incoming:                     {filter: [*is_incoming,  *is_callback_c]}
  appcall_bx_incoming_answered:            {filter: [*is_incoming,  *is_callback_c, *is_answered], m42: False}
  appcall_bx_incoming_success:             {filter: [*is_incoming,  *is_callback_c, *is_success]}
  appcall_bx_incoming_talkseconds:         {filter: [*is_incoming,  *is_callback_c, *is_answered], obs: [TalkDuration]}
  
  appcall_bx_outgoing:                     {filter: [*is_outgoing, *is_c]}
  appcall_bx_outgoing_answered:            {filter: [*is_outgoing, *is_c, *is_answered]}
  appcall_bx_outgoing_success:             {filter: [*is_outgoing, *is_c, *is_success]}
  appcall_bx_outgoing_talkseconds:         {filter: [*is_outgoing, *is_c, *is_answered], obs: [TalkDuration]}
  appcall_bx_outgoing_less15seconds:       {filter: [*is_outgoing, *is_c, *is_answered, *is_less15]}
  appcall_bx_outgoing_less60seconds:       {filter: [*is_outgoing, *is_c, *is_answered, *is_less60]}
  appcall_bx_outgoing_less120seconds:      {filter: [*is_outgoing, *is_c, *is_answered, *is_less120]}
  appcall_bx_outgoing_less300seconds:      {filter: [*is_outgoing, *is_c, *is_answered, *is_less300]}
  
  appcall_bx_outgoing_callback:            {filter: [*is_outgoing, *is_callback_c], m42: False}
  appcall_bx_outgoing_callback_answered:   {filter: [*is_outgoing, *is_callback_c, *is_answered], m42: False}
  appcall_bx_outgoing_callback_success:    {filter: [*is_outgoing, *is_callback_c, *is_success], m42: False}
  
  appcall_bx_outgoing_direct:              {filter: [*is_outgoing, *is_direct_c]}
  appcall_bx_outgoing_direct_answered:     {filter: [*is_outgoing, *is_direct_c, *is_answered]}
  appcall_bx_outgoing_direct_success:      {filter: [*is_outgoing, *is_direct_c, *is_success]}
  
  appcall_bx_outgoing_item:                {filter: [*is_outgoing, *is_item_c], m42: False}
  appcall_bx_outgoing_item_answered:       {filter: [*is_outgoing, *is_item_c, *is_answered], m42: False}
  appcall_bx_outgoing_item_success:        {filter: [*is_outgoing, *is_item_c, *is_success], m42: False}
  
  appcall_bx_msg_chat_menu:                {filter: [*is_outgoing, *is_messenger_chat_menu], m42: False}
  appcall_bx_msg_chat_menu_success:        {filter: [*is_outgoing, *is_messenger_chat_menu, *is_success], m42: False}
  appcall_bx_msg_chat_menu_talkseconds:    {filter: [*is_outgoing, *is_messenger_chat_menu, *is_answered], obs: [TalkDuration], m42: False}
  
  appcall_bx_msg_callback:                {filter: [*is_outgoing, *is_deeplink_call_back], m42: False}
  appcall_bx_msg_callback_success:        {filter: [*is_outgoing, *is_deeplink_call_back, *is_success], m42: False}
  appcall_bx_msg_callback_talkseconds:    {filter: [*is_outgoing, *is_deeplink_call_back, *is_answered], obs: [TalkDuration], m42: False}

  appcall_bx_any_calls:                    {filter: [*is_c]}
  appcall_bx_any_calls_answered:           {filter: [*is_c, *is_answered]}
  appcall_bx_any_calls_success:            {filter: [*is_c, *is_success]}
  appcall_bx_any_talkseconds:              {filter: [*is_c, *is_answered], obs: [TalkDuration]}
  appcall_bx_any_less5seconds:             {filter: [*is_c, *is_answered, *is_less5]}
  appcall_bx_any_less15seconds:            {filter: [*is_c, *is_answered, *is_less15]}
  appcall_bx_any_less60seconds:            {filter: [*is_c, *is_answered, *is_less60]}
  appcall_bx_any_less120seconds:           {filter: [*is_c, *is_answered, *is_less120]}
  appcall_bx_any_less300seconds:           {filter: [*is_c, *is_answered, *is_less300]}
 
metric.uniq:
  unq_appcall_bx_outgoing_item:            {counter: appcall_bx_outgoing_item, key: [user], m42: False}
  unq_appcall_bx_outgoing_item_success:    {counter: appcall_bx_outgoing_item_success, key: [user], m42: False}
  unq_appcall_bx_any_calls:                {counter: appcall_bx_any_calls, key: [user]}

metric.ratio:
  appcall_bx_outgoing_direct_answered_ratio:            {num: appcall_bx_outgoing_direct_answered, den: appcall_bx_outgoing_direct}
  appcall_bx_outgoing_direct_success_answered_ratio:    {num: appcall_bx_outgoing_direct_success, den: appcall_bx_outgoing_direct_answered}
  appcall_bx_outgoing_direct_success_ratio:             {num: appcall_bx_outgoing_direct_success, den: appcall_bx_outgoing_direct}
  
  appcall_bx_msg_chat_menu_success_ratio:               {num: appcall_bx_msg_chat_menu_success, den: appcall_bx_msg_chat_menu}
  appcall_bx_msg_callback_success_ratio:                {num: appcall_bx_msg_callback_success, den: appcall_bx_msg_callback}
  
  appcall_bx_outgoing_talkseconds_avg:                  {num: appcall_bx_outgoing_talkseconds, den: appcall_bx_outgoing_answered}
  appcall_bx_incoming_talkseconds_avg:                  {num: appcall_bx_incoming_talkseconds, den: appcall_bx_incoming_answered}
  appcall_bx_any_talkseconds_avg:                       {num: appcall_bx_any_talkseconds, den: appcall_bx_any_calls_answered}
  
  appcall_bx_any_less5seconds_ratio:                    {num: appcall_bx_any_less5seconds, den: appcall_bx_any_calls_answered}
  appcall_bx_any_less15seconds_ratio:                   {num: appcall_bx_any_less15seconds, den: appcall_bx_any_calls_answered}
  appcall_bx_any_less60seconds_ratio:                   {num: appcall_bx_any_less60seconds, den: appcall_bx_any_calls_answered}
  appcall_bx_any_less120seconds_ratio:                  {num: appcall_bx_any_less120seconds, den: appcall_bx_any_calls_answered}
  appcall_bx_any_less300seconds_ratio:                  {num: appcall_bx_any_less300seconds, den: appcall_bx_any_calls_answered}
  
  
  
