definitions:
  - &callback_scenario  [notification_call_back,deeplink_call_back,messenger_call_back,call_log_callback]
  - &direct_scenario    [item,item_gallery,messenger_chat_menu,messenger_chat_long_answer]
  - &item_scenario      [item,item_gallery]
  - &any_scenario       [item,item_gallery,messenger_chat_menu,messenger_chat_long_answer,notification_call_back,deeplink_call_back,messenger_call_back,call_log_callback]

  - &is_callback_c      {AppCallScenario: *callback_scenario}
  - &is_direct_c        {AppCallScenario: *direct_scenario}
  - &is_item_c          {AppCallScenario: *item_scenario}
  - &is_c               {AppCallScenario: *any_scenario}
  - &is_outgoing        {CallType: outgoing}
  - &is_incoming        {CallType: incoming}
  - &is_answered        {TalkDuration.>: 0}
  - &is_success         {TalkDuration.>: 30}

metric.counter:

  appcall_bx_incoming:                     {filter: [*is_incoming,  *is_callback_c]}
  appcall_bx_incoming_answered:            {filter: [*is_incoming,  *is_callback_c, *is_answered], m42: False}
  appcall_bx_incoming_success:             {filter: [*is_incoming,  *is_callback_c, *is_success]}
  appcall_bx_incoming_talkminutes:         {filter: [*is_incoming,  *is_callback_c, *is_answered], obs: TalkDuration}
  
  appcall_bx_outgoing:                     {filter: [*is_outgoing, *is_c]}
  appcall_bx_outgoing_answered:            {filter: [*is_outgoing, *is_c, *is_answered]}
  appcall_bx_outgoing_success:             {filter: [*is_outgoing, *is_c, *is_success]}
  appcall_bx_outgoing_talkminutes:         {filter: [*is_outgoing, *is_c, *is_answered], obs: TalkDuration}
  
  appcall_bx_outgoing_callback:            {filter: [*is_outgoing, *is_callback_c], m42: False}
  appcall_bx_outgoing_callback_answered:   {filter: [*is_outgoing, *is_callback_c, *is_answered], m42: False}
  appcall_bx_outgoing_callback_success:    {filter: [*is_outgoing, *is_callback_c, *is_success], m42: False}
  
  appcall_bx_outgoing_direct:              {filter: [*is_outgoing, *is_direct_c]}
  appcall_bx_outgoing_direct_answered:     {filter: [*is_outgoing, *is_direct_c, *is_answered]}
  appcall_bx_outgoing_direct_success:      {filter: [*is_outgoing, *is_direct_c, *is_success]}
  
  appcall_bx_outgoing_item:                {filter: [*is_outgoing, *is_item_c], m42: False}
  appcall_bx_outgoing_item_answered:       {filter: [*is_outgoing, *is_item_c, *is_answered], m42: False}
  appcall_bx_outgoing_item_success:        {filter: [*is_outgoing, *is_item_c, *is_success], m42: False}
   
  appcall_bx_any_calls:                    {filter: [*is_c]}
  appcall_bx_any_calls_answered:           {filter: [*is_c, *is_answered]}
  appcall_bx_any_calls_success:            {filter: [*is_c, *is_success]}
  appcall_bx_any_talkminutes:              {filter: [*is_c, *is_answered], obs: TalkDuration}
 
metric.uniq:
  unq_appcall_bx_outgoing_item:            {counter: appcall_bx_outgoing_item, key: [cookie], m42: False}
  unq_appcall_bx_outgoing_item_success:    {counter: appcall_bx_outgoing_item_success, key: [cookie], m42: False}

metric.ratio:
  appcall_bx_outgoing_direct_answered_ratio:            {num: appcall_bx_outgoing_direct_answered, den: appcall_bx_outgoing_direct}
  appcall_bx_outgoing_direct_success_answered_ratio:    {num: appcall_bx_outgoing_direct_success, den: appcall_bx_outgoing_direct_answered}
  appcall_bx_outgoing_direct_success_ratio:             {num: appcall_bx_outgoing_direct_success, den: appcall_bx_outgoing_direct}
  
  appcall_bx_outgoing_talkminutes_avg:                  {num: appcall_bx_outgoing_talkminutes, den: appcall_bx_outgoing_answered}
  appcall_bx_incoming_talkminutes_avg:                  {num: appcall_bx_incoming_talkminutes, den: appcall_bx_incoming_answered}
  appcall_bx_any_talkminutes_avg:                       {num: appcall_bx_any_talkminutes, den: appcall_bx_any_calls_answered}
