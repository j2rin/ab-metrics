metric.counter:
  # suspicious auth attempts by auth source
  susp_auth_attempts:                           {obs: [susp_auth_attempts]}
  susp_direct_auth_attempts:                    {obs: [susp_auth_attempts], filter: [auth_source: 'auth']}
  susp_restore_phone_attempts:                  {obs: [susp_auth_attempts], filter: [auth_source: 'restore_phone']}
  susp_restore_email_attempts:                  {obs: [susp_auth_attempts], filter: [auth_source: 'restore_phone']}
  # NOT suspicious auth attempts by auth source
  not_susp_auth_attempts:                       {obs: [not_susp_auth_attempts]}
  not_susp_direct_auth_attempts:                {obs: [not_susp_auth_attempts], filter: [auth_source: 'auth']}
  not_susp_restore_phone_attempts:              {obs: [not_susp_auth_attempts], filter: [auth_source: 'restore_phone']}
  not_susp_restore_email_attempts:              {obs: [not_susp_auth_attempts], filter: [auth_source: 'restore_phone']}

  # suspicious auth attempts with check by auth source
  susp_auth_attempts_with_check:                {obs: [susp_auth_attempts_with_check]}
  susp_direct_auth_with_check:               {obs: [susp_auth_attempts_with_check], filter: [auth_source: 'auth']}
  susp_restore_phone_attempts_with_check:     {obs: [susp_auth_attempts_with_check], filter: [auth_source: 'restore_phone']}
  susp_restore_email_attempts_with_check:     {obs: [susp_auth_attempts_with_check], filter: [auth_source: 'restore_phone']}
  # NOT suspicious auth attempts with check by auth source
  not_susp_auth_attempts_with_check:          {obs: [not_susp_auth_attempts_with_sheck]}
  not_susp_direct_auth_with_check:          {obs: [not_susp_auth_attempts_with_sheck], filter: [auth_source: 'auth']}
  not_susp_restore_phone_attempts_with_check:     {obs: [not_susp_auth_attempts_with_sheck], filter: [auth_source: 'restore_phone']}
  not_susp_restore_email_attempts_with_check:     {obs: [not_susp_auth_attempts_with_sheck], filter: [auth_source: 'restore_phone']}

  # suspicious auth success by auth source
  susp_auth_success:                    {obs: [susp_auth_success]}
  susp_direct_auth_success:               {obs: [susp_auth_success], filter: [auth_source: 'auth']}
  susp_restore_phone_success:               {obs: [susp_auth_success], filter: [auth_source: 'restore_phone']}
  susp_restore_email_success:               {obs: [susp_auth_success], filter: [auth_source: 'restore_phone']}
  # NOT suspicious auth success by auth source
  not_susp_auth_success:               {obs: [not_susp_auth_success]}
  not_susp_direct_auth_success:               {obs: [not_susp_auth_success], filter: [auth_source: 'auth']}
  not_susp_restore_phone_success:          {obs: [not_susp_auth_success], filter: [auth_source: 'restore_phone']}
  not_susp_restore_email_success:          {obs: [not_susp_auth_success], filter: [auth_source: 'restore_phone']}

  # suspicious auth success with check by auth source
  susp_auth_success_with_check:               {obs: [susp_auth_success_with_check]}
  susp_direct_auth_success_with_check:          {obs: [susp_auth_success_with_check], filter: [auth_source: 'auth']}
  susp_restore_phone_success_with_check:     {obs: [susp_auth_success_with_check], filter: [auth_source: 'restore_phone']}
  susp_restore_email_with_check:          {obs: [susp_auth_success_with_check], filter: [auth_source: 'restore_phone']}
  # NOT suspicious auth success with check by auth source
  not_susp_auth_success_with_check:          {obs: [not_susp_auth_success_with_check]}
  not_susp_direct_auth_success_with_check:     {obs: [not_susp_auth_success_with_check], filter: [auth_source: 'auth']}
  not_susp_restore_phone_success_with_check:     {obs: [not_susp_auth_success_with_check], filter: [auth_source: 'restore_phone']}
  not_susp_restore_email_success_with_check:          {obs: [not_susp_auth_success_with_check], filter: [auth_source: 'restore_phone']}

  # hacked through suspicious auth by auth source
  hacked_by_susp_auth:                    {obs: [is_hack_auth_susp]}
  hacked_by_susp_direct_auth:               {obs: [is_hack_direct_auth_susp]}
  hacked_by_susp_restore_phone:               {obs: [is_hack_restore_phone_susp]}
  hacked_by_susp_restore_email:               {obs: [is_hack_restore_email_susp]}
  # hacked through NOT suspicious auth by auth source
  hacked_by_not_susp_auth:               {obs: [is_hack_auth_not_susp]}
  hacked_by_not_susp_direct_auth:          {obs: [is_hack_direct_auth_not_susp]}
  hacked_by_not_susp_restore_phone:          {obs: [is_hack_restore_phone_not_susp]}
  hacked_by_not_susp_restore_email:          {obs: [is_hack_restore_email_not_susp]}


metric.uniq:
  user_susp_auth_attempts:                    {counter: susp_auth_attempts,                    key: [user_id]}     
  user_susp_direct_auth_attempts:               {counter: susp_direct_auth_attempts,                   key: [user_id]} 
  user_susp_restore_phone_attempts:               {counter: susp_restore_phone_attempts,                   key: [user_id]}
  user_susp_restore_email_attempts:               {counter: susp_restore_email_attempts,                   key: [user_id]}
                        
  user_not_susp_auth_attempts:                    {counter: not_susp_auth_attempts,                  key: [user_id]}          
  user_not_susp_direct_auth_attempts:               {counter: not_susp_direct_auth_attempts,             key: [user_id]}
  user_not_susp_restore_phone_attempts:               {counter: not_susp_restore_phone_attempts,             key: [user_id]}     
  user_not_susp_restore_email_attempts:               {counter: not_susp_restore_email_attempts,             key: [user_id]}     
            
  user_susp_auth_attempts_with_check:               {counter: susp_auth_attempts_with_check,             key: [user_id]}     
  user_susp_direct_auth_with_check:               {counter: susp_direct_auth_with_check,                     key: [user_id]}
  user_susp_restore_phone_attempts_with_check:           {counter: susp_restore_phone_attempts_with_check,       key: [user_id]}     
  user_susp_restore_email_attempts_with_check:           {counter: susp_restore_email_attempts_with_check,       key: [user_id]}     

  user_not_susp_auth_attempts_with_check:               {counter: not_susp_auth_attempts_with_check,            key: [user_id]}          
  user_not_susp_direct_auth_with_check:                     {counter: not_susp_direct_auth_with_check,              key: [user_id]}
  user_not_susp_restore_phone_attempts_with_check:      {counter: not_susp_restore_phone_attempts_with_check,   key: [user_id]}     
  user_not_susp_restore_email_attempts_with_check:      {counter: not_susp_restore_email_attempts_with_check,   key: [user_id]}     
  
  user_susp_auth_success:                               {counter: susp_auth_success,                            key: [user_id]}     
  user_susp_direct_auth_success:               {counter: susp_direct_auth_success,                     key: [user_id]} 
  user_susp_restore_phone_success:               {counter: susp_restore_phone_success,                     key: [user_id]}
  user_susp_restore_email_success:               {counter: susp_restore_email_success,                     key: [user_id]}
  
  user_not_susp_auth_success:                    {counter: not_susp_auth_success,                  key: [user_id]}     
  user_not_susp_direct_auth_success:               {counter: not_susp_direct_auth_success,                 key: [user_id]}
  user_not_susp_restore_phone_success:                     {counter: not_susp_restore_phone_success,             key: [user_id]}     
  user_not_susp_restore_email_success:                  {counter: not_susp_restore_email_success,             key: [user_id]}     
  
  user_susp_auth_success_with_check:                    {counter: susp_auth_success_with_check,                 key: [user_id]}     
  user_susp_direct_auth_success_with_check:             {counter: susp_direct_auth_success_with_check,          key: [user_id]}
  user_susp_restore_phone_success_with_check:           {counter: susp_restore_phone_success_with_check,        key: [user_id]}     
  user_susp_restore_email_with_check:                   {counter: susp_restore_email_with_check,                key: [user_id]}
  
  user_not_susp_auth_success_with_check:                {counter: not_susp_auth_success_with_check,             key: [user_id]}     
  user_not_susp_direct_auth_success_with_check:         {counter: not_susp_direct_auth_success_with_check,      key: [user_id]}
  user_not_susp_restore_phone_success_with_check:       {counter: not_susp_restore_phone_success_with_check,    key: [user_id]}     
  user_not_susp_restore_email_success_with_check:               {counter: not_susp_restore_email_success_with_check,            key: [user_id]}     
  
  user_hacked_by_susp_auth:                             {counter: hacked_by_susp_auth,                          key: [user_id]}     
  user_hacked_by_susp_direct_auth:                      {counter: hacked_by_susp_direct_auth,                   key: [user_id]}
  user_hacked_by_susp_restore_phone:                    {counter: hacked_by_susp_restore_phone,                 key: [user_id]}     
  user_hacked_by_susp_restore_email:                    {counter: hacked_by_susp_restore_email,                 key: [user_id]}
  
  user_hacked_by_not_susp_auth:                         {counter: hacked_by_not_susp_auth,                      key: [user_id]}     
  user_hacked_by_not_susp_direct_auth:                     {counter: hacked_by_not_susp_direct_auth,                key: [user_id]}
  user_hacked_by_not_susp_restore_phone:             {counter: hacked_by_not_susp_restore_phone,             key: [user_id]}     
  user_hacked_by_not_susp_restore_email:                {counter: hacked_by_not_susp_restore_email,             key: [user_id]}     

metric.ratio:
  # conversion to hack from success auth by auth source and susp distribution
  hacked_conv_from_susp_auth:
    num: user_hacked_by_susp_auth
    den: user_susp_auth_success
  hacked_conv_from_susp_direct_auth:
    num: user_hacked_by_susp_direct_auth
    den: user_susp_direct_auth_success
  hacked_conv_from_susp_restore_phone:
    num: user_hacked_by_susp_restore_phone
    den: user_susp_restore_phone_success
  hacked_conv_from_susp_restore_email:
    num: user_hacked_by_susp_restore_email
    den: user_susp_restore_email_success

  hacked_conv_from_not_susp_auth:
    num: user_hacked_by_not_susp_auth
    den: user_not_susp_auth_success
  hacked_conv_from_not_susp_direct_auth:
    num: user_hacked_by_not_susp_direct_auth
    den: user_not_susp_direct_auth_success
  hacked_conv_from_not_susp_restore_phone:
    num: user_hacked_by_not_susp_restore_phone
    den: user_not_susp_restore_phone_success
  hacked_conv_from_not_susp_restore_email: 
   num: user_hacked_by_not_susp_restore_email
   den: user_not_susp_restore_email_success
  
  # conversion from auth attempt to success auth 
  conv_from_susp_auth_attempt_to_succ:                    
    num: susp_auth_success                    
    den: susp_auth_attempts           
  conv_from_susp_direct_auth_attempt_to_succ:             
    num: susp_direct_auth_success                
    den: susp_direct_auth_attempts        
  conv_from_susp_restore_phone_attempt_to_succ:           
    num: susp_restore_phone_success                       
    den: susp_restore_phone_attempts
  conv_from_susp_restore_email_attempt_to_succ:           
    num: susp_restore_email_success               
    den: susp_restore_email_attempts
  
  conv_from_not_susp_auth_attempt_to_succ:                    
    num: not_susp_auth_success                    
    den: not_susp_auth_attempts            
  conv_from_not_susp_direct_auth_attempt_to_succ:             
    num: not_susp_direct_auth_success                
    den: not_susp_direct_auth_attempts         
  conv_from_not_susp_restore_phone_attempt_to_succ:           
    num: not_susp_restore_phone_success                
    den: not_susp_restore_phone_attempts
  conv_from_not_susp_restore_email_attempt_to_succ:           
    num: not_susp_restore_email_success                
    den: not_susp_restore_email_attempts
  
  user_conv_from_susp_auth_attempt_to_succ:                    
    num: user_susp_auth_success                     
    den: user_susp_auth_attempts           
  user_conv_from_susp_direct_auth_attempt_to_succ:             
    num: user_susp_direct_auth_success                
    den: user_susp_direct_auth_attempts         
  user_conv_from_susp_restore_phone_attempt_to_succ:          
    num: user_susp_restore_phone_success             
    den: user_susp_restore_phone_attempts
  user_conv_from_susp_restore_email_attempt_to_succ:           
    num: user_susp_restore_email_success                
    den: user_susp_restore_email_attempts

  user_conv_from_not_susp_auth_attempt_to_succ:              
    num: user_not_susp_auth_success                
    den: user_not_susp_auth_attempts            
  user_conv_from_not_susp_direct_auth_attempt_to_succ:       
    num: user_not_susp_direct_auth_success           
    den: user_not_susp_direct_auth_attempts        
  user_conv_from_not_susp_restore_phone_attempt_to_succ:     
    num: user_not_susp_restore_phone_success           
    den: user_not_susp_restore_phone_attempts
  user_conv_from_not_susp_restore_email_attempt_to_succ:     
    num: user_not_susp_restore_email_success           
    den: user_not_susp_restore_email_attempts

  # share of auth attempts with check
  susp_auth_attemps_with_check_share:                             
    num: susp_auth_attempts_with_check               
    den: susp_auth_attempts
  susp_direct_auth_attempts_with_check_share:                     
    num: susp_direct_auth_with_check               
    den: susp_direct_auth_attempts
  susp_restore_phone_attempts_with_check_share:                   
    num: susp_restore_phone_attempts_with_check          
    den: susp_restore_phone_attempts
  susp_restore_email_attempts_with_check_share:                   
    num: susp_restore_email_attempts_with_check          
    den: susp_restore_email_attempts
  
  not_susp_auth_attemps_with_check_share:                       
    num: not_susp_auth_attempts_with_check          
    den: not_susp_auth_attempts
  not_susp_direct_auth_attempts_with_check_share:               
    num: not_susp_direct_auth_with_check                     
    den: not_susp_direct_auth_attempts
  not_susp_restore_phone_attempts_with_check_share:             
    num: not_susp_restore_phone_attempts_with_check       
    den: not_susp_restore_phone_attempts
  not_susp_restore_email_attempts_with_check_share:             
    num: not_susp_restore_email_attempts_with_check       
    den: not_susp_restore_email_attempts
  
  user_susp_auth_attemps_with_check_share:                      
    num: user_susp_auth_attempts_with_check             
    den: user_susp_auth_attempts
  user_susp_direct_auth_attempts_with_check_share:              
    num: user_susp_direct_auth_with_check                     
    den: user_susp_direct_auth_attempts
  user_susp_restore_phone_attempts_with_check_share:            
    num: user_susp_restore_phone_attempts_with_check      
    den: user_susp_restore_phone_attempts
  user_susp_restore_email_attempts_with_check_share:            
    num: user_susp_restore_email_attempts_with_check      
    den: user_susp_restore_email_attempts
  
  user_not_susp_auth_attemps_with_check_share:                  
    num: user_not_susp_auth_attempts_with_check             
    den: user_not_susp_auth_attempts
  user_not_susp_direct_auth_attempts_with_check_share:          
    num: user_not_susp_direct_auth_with_check         
    den: user_not_susp_direct_auth_attempts
  user_not_susp_restore_phone_attempts_with_check_share:        
    num: user_not_susp_restore_phone_attempts_with_check     
    den: user_not_susp_restore_phone_attempts
  user_not_susp_restore_email_attempts_with_check_share:        
    num: user_not_susp_restore_email_attempts_with_check     
    den: user_not_susp_restore_email_attempts
  
  # conversion from auth attempt with check to success auth
  conv_from_susp_auth_attempt_with_check_to_succ:                        
    num: susp_auth_success_with_check                 
    den: susp_auth_attempts_with_check
  conv_from_susp_direct_auth_attempt_with_check_to_succ:                 
    num: susp_direct_auth_success_with_check             
    den: susp_direct_auth_with_check
  conv_from_susp_restore_phone_attempt_with_check_to_succ:               
    num: susp_restore_phone_success_with_check           
    den: susp_restore_phone_attempts_with_check
  conv_from_susp_restore_email_attempt_with_check_to_succ:               
    num: susp_restore_email_with_check                   
    den: susp_restore_email_attempts_with_check
  
  conv_from_not_susp_auth_attempt_with_check_to_succ:                   
    num: not_susp_auth_success_with_check               
    den: not_susp_auth_attempts_with_check
  conv_from_not_susp_direct_auth_attempt_with_check_to_succ:            
    num: not_susp_direct_auth_success_with_check      
    den: not_susp_direct_auth_with_check
  conv_from_not_susp_restore_phone_attempt_with_check_to_succ:          
    num: not_susp_restore_phone_success_with_check      
    den: not_susp_restore_phone_attempts_with_check
  conv_from_not_susp_restore_email_attempt_with_check_to_succ:          
    num: not_susp_restore_email_success_with_check              
    den: not_susp_restore_email_attempts_with_check
  
  user_conv_from_susp_auth_attempt_with_check_to_succ:                  
    num: user_susp_auth_success_with_check               
    den: user_susp_auth_attempts_with_check
  user_conv_from_susp_direct_auth_attempt_with_check_to_succ:           
    num: user_susp_direct_auth_success_with_check       
    den: user_susp_direct_auth_with_check
  user_conv_from_susp_restore_phone_attempt_with_check_to_succ:         
    num: user_susp_restore_phone_success_with_check      
    den: user_susp_restore_phone_attempts_with_check
  user_conv_from_susp_restore_email_attempt_with_check_to_succ:         
    num: user_susp_restore_email_with_check              
    den: user_susp_restore_email_attempts_with_check
  
  user_conv_from_not_susp_auth_attempt_with_check_to_succ:              
    num: user_not_susp_auth_success_with_check               
    den: user_not_susp_auth_attempts_with_check
  user_conv_from_not_susp_direct_auth_attempt_with_check_to_succ:       
    num: user_not_susp_direct_auth_success_with_check        
    den: user_not_susp_direct_auth_with_check
  user_conv_from_not_susp_restore_phone_attempt_with_check_to_succ:     
    num: user_not_susp_restore_phone_success_with_check      
    den: user_not_susp_restore_phone_attempts_with_check
  user_conv_from_not_susp_restore_email_attempt_with_check_to_succ:     
    num: user_not_susp_restore_email_success_with_check           
    den: user_not_susp_restore_email_attempts_with_check
