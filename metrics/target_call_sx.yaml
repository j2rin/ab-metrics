definitions:
  - &is_target_call       {is_target_call: True}
  - &is_success_call      {talk_duration.>: 30}
  - &is_answered_call     {talk_duration.>: 0}

metric.counter:

  target_call_sx:         {filter: [*is_target_call]} # количество целевых звонков
  target_call_sx_success: {filter: [*is_target_call, *is_success_call]} # количество целевых звонков длительностью более 30 секунд
  answered_call_sx:       {filter: [*is_answered_call]} # количество отвеченных звонков
  target_call_sx_talkseconds:     {filter: [*is_target_call], obs: [talk_duration]} # количество целевых секунд

metric.uniq:

  user_target_call_sx:    {counter: target_call_sx, key: [user]}
  user_target_call_sx_success:    {counter: target_success_call_sx, key: [user]}
  user_answered_call_sx:  {counter: answered_call_sx, key: [user]}

metric.ratio:
  target_call_sx_ratio:   {num: target_call_sx, den: answered_call_sx} # доля целевых звонков от всех отвеченных
  user_target_call_sx_ratio:   {num: user_target_call_sx, den: user_answered_call_sx} # доля юзеров с целевыми звонками от всех

