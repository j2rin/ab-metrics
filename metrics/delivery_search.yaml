
definitions:
  - &eid_search     [300]

  - &is_search      {eid: *eid_search, $or: [platform_id.!=: 1, onmap: 0]}

  - &x_is_search    {x_eid: *eid_search}

  - &x_is_extra_regions       {search_flags.bit: 11}
  - &x_is_extra_delivery      {search_flags.bit: 12}
  - &x_is_extra_quorum        {search_flags.bit: 18}
  - &x_is_extra_vector        {search_flags.bit: 19}
  - &x_is_extra_regions_mix   {search_flags.bit: 22}

  - &is_iv            {eid: 301}
  - &is_iv_wo_guessing    {<<: *is_iv, item_x_type: 0}
  - &is_delivery      {eid: 2015}

  - &is_serp_delivery           {search_query_type: 10}
  - &is_serp_regions            {search_query_type: 9}
  - &is_serp_regions_mix        {search_query_type: 20}
  - &is_serp_quorum             {search_query_type: 15}
  - &is_serp_vector             {search_query_type: 18}


  - &is_delivery_active       {item_flags.bit: 16}


metric.counter:
 cnt_iv_delivery_serp:					  {filter: [*is_iv_wo_guessing, *is_delivery_active, *x_is_search], m42: False}
 cnt_click_delivery_serp:				  {filter: [eid: 2483, *is_delivery_active, *x_is_search], m42: False}
 cnt_widget_delivery_serp:				  {filter: [eid: 2013, *is_delivery_active, *x_is_search], m42: False}
 cnt_confirm_delivery_serp:				  {filter: [eid: 2749, *is_delivery_active, *x_is_search], m42: False}
 cnt_contact_delivery_serp:				  {filter: [eid: 4675, *is_delivery_active, *x_is_search], m42: False}

 searches_any_ext_block:                  {filter: [*is_search, {$or: [[*x_is_extra_delivery], [*x_is_extra_regions],[*x_is_extra_regions_mix], [*x_is_extra_quorum], [*x_is_extra_vector]]}]}
 cnt_iv_delivery_any_ext_block:           {filter: [*is_iv_wo_guessing, *is_delivery_active, *x_is_search, {$or: [[*is_serp_delivery], [*is_serp_regions], [*is_serp_regions_mix], [*is_serp_quorum], [*is_serp_vector]]}], m42: False}
 cnt_click_delivery_any_ext_block:        {filter: [eid: 2483, *x_is_search, {$or: [[*is_serp_delivery], [*is_serp_regions], [*is_serp_regions_mix], [*is_serp_quorum], [*is_serp_vector]]}], m42: False}
 cnt_create_order_delivery_any_ext_block: {filter: [*is_delivery, *x_is_search, {$or: [[*is_serp_delivery], [*is_serp_regions], [*is_serp_regions_mix], [*is_serp_quorum], [*is_serp_vector]]}], m42: False}
 cnt_contact_delivery_any_ext_block:      {filter: [eid: 4675, *x_is_search, {$or: [[*is_serp_delivery], [*is_serp_regions], [*is_serp_regions_mix], [*is_serp_quorum], [*is_serp_vector]]}], m42: False}

metric.uniq:
# Метрики поиска
 item_views_delivery_serp:             {counter: cnt_iv_delivery_serp,      key: [item_x]}
 click_delivery_serp:				   {counter: cnt_click_delivery_serp,   key: [item_x]}
 widget_delivery_serp:				   {counter: cnt_widget_delivery_serp,  key: [item_x]}
 confirm_delivery_serp:                {counter: cnt_confirm_delivery_serp, key: [item_x]}
 contact_delivery_serp:				   {counter: cnt_contact_delivery_serp, key: [item_x]}

# Юзерные аналоги
 users_item_views_delivery_serp:       {counter: cnt_iv_delivery_serp,      key: [cookie]}
 users_click_delivery_serp:			   {counter: cnt_click_delivery_serp,   key: [cookie]}
 users_widget_delivery_serp:		   {counter: cnt_widget_delivery_serp,  key: [cookie]}
 users_confirm_delivery_serp:		   {counter: cnt_confirm_delivery_serp, key: [cookie]}
 users_contact_delivery_serp:		   {counter: cnt_contact_delivery_serp, key: [cookie]}

# Метрики допблоков
 users_searches_any_ext_block:         {counter: searches_any_ext_block,                  key: [cookie]}
 item_views_delivery_any_ext_block:    {counter: cnt_iv_delivery_any_ext_block,           key: [item_x]}
 click_delivery_any_ext_block:         {counter: cnt_click_delivery_any_ext_block,        key: [item_x]}
 create_order_delivery_any_ext_block:  {counter: cnt_create_order_delivery_any_ext_block, key: [item_x]}
 contact_delivery_any_ext_block:       {counter: cnt_contact_delivery_any_ext_block,      key: [item_x]}


metric.ratio:
 click_delivery_per_iv_delivery_any_ext_block:           {num: click_delivery_any_ext_block,         den: item_views_delivery_any_ext_block}
 contact_delivery_per_iv_delivery_any_ext_block:         {num: contact_delivery_any_ext_block,       den: item_views_delivery_any_ext_block}
 create_order_delivery_per_iv_delivery_any_ext_block:    {num: create_order_delivery_any_ext_block,  den: item_views_delivery_any_ext_block}
 create_order_delivery_per_click_delivery_any_ext_block: {num: create_order_delivery_any_ext_block,  den: click_delivery_any_ext_block}
 item_views_delivery_per_searches_any_ext_block:         {num: item_views_delivery_any_ext_block,    den: searches_any_ext_block}