metric.counter:
  active_items:                            {filter: [{is_active: True}]}
  cnt_active_items_0_photo:                {filter: [{photo_count: 0}], m42: False}
  cnt_active_items_more_10_description_word: {filter: [{description_word_count.>=: 10}], m42: False}
  cnt_active_items_more_10_photo:          {filter: [{photo_count.>=: 10}], m42: False}
  cnt_active_items_more_1_photo:           {filter: [{photo_count.>=: 1}], m42: False}
  cnt_active_items_more_3_photo:           {filter: [{photo_count.>=: 3}], m42: False}
  cnt_active_items_more_40_description_word: {filter: [{description_word_count.>=: 40}], m42: False}
  cnt_active_items_more_5_description_word: {filter: [{description_word_count.>=: 5}], m42: False}
  cnt_active_items_more_5_photo:           {filter: [{photo_count.>=: 5}], m42: False}
  cnt_item_address_length:                 {filter: [{is_active: True}], obs: [address_length], m42: False}
  cnt_item_address_length_new:             {filter: [{is_active: True}, {start_date: $event_date}], obs: [address_length], m42: False}
  cnt_item_address_length_reactivated:     {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}], obs: [address_length], m42: False}
  cnt_new_items_0_photo:                   {filter: [{start_date: $event_date, photo_count: 0}], m42: False}
  cnt_new_items_more_10_description_word:  {filter: [{description_word_count.>=: 10, start_date: $event_date}], m42: False}
  cnt_new_items_more_10_photo:             {filter: [{start_date: $event_date, photo_count.>=: 10}], m42: False}
  cnt_new_items_more_1_photo:              {filter: [{start_date: $event_date, photo_count.>=: 1}], m42: False}
  cnt_new_items_more_3_photo:              {filter: [{start_date: $event_date, photo_count.>=: 3}], m42: False}
  cnt_new_items_more_40_description_word:  {filter: [{description_word_count.>=: 40, start_date: $event_date}], m42: False}
  cnt_new_items_more_5_description_word:   {filter: [{description_word_count.>=: 5, start_date: $event_date}], m42: False}
  cnt_new_items_more_5_photo:              {filter: [{start_date: $event_date, photo_count.>=: 5}], m42: False}
  items_100m_from_location:                {filter: [{is_active: True}, {location_distance.<=: 0.1}]}
  items_100m_from_location_new:            {filter: [{is_active: True}, {location_distance.<=: 0.1}, {start_date: $event_date}]}
  items_100m_from_location_reactivated:    {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.1}]}
  items_200_plus_km_from_location:         {filter: [{is_active: True}, {location_distance.>: 200}]}
  items_200_plus_km_from_location_new:     {filter: [{is_active: True}, {location_distance.>: 200}, {start_date: $event_date}]}
  items_200_plus_km_from_location_reactivated: {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.>: 200}]}
  items_20m_from_location:                 {filter: [{is_active: True}, {location_distance.<=: 0.02}]}
  items_20m_from_location_new:             {filter: [{is_active: True}, {location_distance.<=: 0.02}, {start_date: $event_date}]}
  items_20m_from_location_reactivated:     {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.02}]}
  items_500m_from_location:                {filter: [{is_active: True}, {location_distance.<=: 0.5}]}
  items_500m_from_location_new:            {filter: [{is_active: True}, {location_distance.<=: 0.5}, {start_date: $event_date}]}
  items_500m_from_location_reactivated:    {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.5}]}
  items_no_address_id:                     {filter: [{has_address_id: False}, {is_active: True}]}
  items_no_address_id_new:                 {filter: [{has_address_id: False}, {is_active: True}, {start_date: $event_date}]}
  items_no_address_id_reactivated:         {filter: [{activations_count.>: 1}, {has_address_id: False}, {is_active: True}, {last_activation_date: $event_date}]}
  items_no_address_string:                 {filter: [{has_address: False}, {is_active: True}]}
  items_no_address_string_new:             {filter: [{has_address: False}, {is_active: True}, {start_date: $event_date}]}
  items_no_address_string_reactivated:     {filter: [{activations_count.>: 1}, {has_address: False}, {is_active: True}, {last_activation_date: $event_date}]}
  items_no_city:                           {filter: [{is_active: True}, {min_kind_level: [120, 130, 140]}]}
  items_no_city_new:                       {filter: [{is_active: True}, {min_kind_level: [120, 130, 140]}, {start_date: $event_date}]}
  items_no_city_reactivated:               {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {min_kind_level: [120, 130, 140]}]}
  items_no_coordinates:                    {filter: [{$or: [[{location_distance.isnull: True}], [{location_distance: -1}]]}, {is_active: True}]}
  items_no_coordinates_new:                {filter: [{$or: [[{location_distance.isnull: True}], [{location_distance: -1}]]}, {is_active: True}, {start_date: $event_date}]}
  items_no_coordinates_reactivated:        {filter: [{$or: [[{location_distance.isnull: True}], [{location_distance: -1}]]}, {activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}]}
  items_with_address_id:                   {filter: [{has_address_id: True}, {is_active: True}]}
  items_with_address_id_new:               {filter: [{has_address_id: True}, {is_active: True}, {start_date: $event_date}]}
  items_with_address_id_reactivated:       {filter: [{activations_count.>: 1}, {has_address_id: True}, {is_active: True}, {last_activation_date: $event_date}]}
  items_with_address_string:               {filter: [{has_address: True}, {is_active: True}]}
  items_with_address_string_new:           {filter: [{has_address: True}, {is_active: True}, {start_date: $event_date}]}
  items_with_address_string_reactivated:   {filter: [{activations_count.>: 1}, {has_address: True}, {is_active: True}, {last_activation_date: $event_date}]}
  items_with_building:                     {filter: [{is_active: True}, {min_kind_level: 40}]}
  items_with_building_new:                 {filter: [{is_active: True}, {min_kind_level: 40}, {start_date: $event_date}]}
  items_with_building_reactivated:         {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {min_kind_level: 40}]}
  items_with_city:                         {filter: [{is_active: True}, {min_kind_level: [100, 110]}]}
  items_with_city_new:                     {filter: [{is_active: True}, {min_kind_level: [100, 110]}, {start_date: $event_date}]}
  items_with_city_reactivated:             {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {min_kind_level: [100, 110]}]}
  items_with_coordinates:                  {filter: [{is_active: True}, {location_distance.>=: -1}]}
  items_with_coordinates_new:              {filter: [{is_active: True}, {location_distance.>=: -1}, {start_date: $event_date}]}
  items_with_coordinates_reactivated:      {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.>=: -1}]}
  items_with_district:                     {filter: [{is_active: True}, {min_kind_level: [60, 70]}]}
  items_with_district_100m_from_location:  {filter: [{is_active: True}, {location_distance.<=: 0.1}, {min_kind_level: [60, 70]}]}
  items_with_district_100m_from_location_new: {filter: [{is_active: True}, {location_distance.<=: 0.1}, {min_kind_level: [60, 70]}, {start_date: $event_date}]}
  items_with_district_100m_from_location_reactivated: {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.1}, {min_kind_level: [60, 70]}]}
  items_with_district_500m_from_location:  {filter: [{is_active: True}, {location_distance.<=: 0.5}, {min_kind_level: [60, 70]}]}
  items_with_district_500m_from_location_new: {filter: [{is_active: True}, {location_distance.<=: 0.5}, {min_kind_level: [60, 70]}, {start_date: $event_date}]}
  items_with_district_500m_from_location_reactivated: {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.5}, {min_kind_level: [60, 70]}]}
  items_with_district_new:                 {filter: [{is_active: True}, {min_kind_level: [60, 70]}, {start_date: $event_date}]}
  items_with_district_reactivated:         {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {min_kind_level: [60, 70]}]}
  items_with_marginal_address:             {filter: [{is_active: True}, {min_kind_level: [10, 20, 30, 80, 90]}]}
  items_with_marginal_address_new:         {filter: [{is_active: True}, {min_kind_level: [10, 20, 30, 80, 90]}, {start_date: $event_date}]}
  items_with_marginal_address_reactivated: {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {min_kind_level: [10, 20, 30, 80, 90]}]}
  items_with_metro:                        {filter: [{is_active: True}, {min_kind_level: 55}]}
  items_with_metro_100m_from_location:     {filter: [{is_active: True}, {location_distance.<=: 0.1}, {min_kind_level: 55}]}
  items_with_metro_100m_from_location_new: {filter: [{is_active: True}, {location_distance.<=: 0.1}, {min_kind_level: 55}, {start_date: $event_date}]}
  items_with_metro_100m_from_location_reactivated: {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.1}, {min_kind_level: 55}]}
  items_with_metro_500m_from_location:     {filter: [{is_active: True}, {location_distance.<=: 0.5}, {min_kind_level: [55]}]}
  items_with_metro_500m_from_location_new: {filter: [{is_active: True}, {location_distance.<=: 0.5}, {min_kind_level: [55]}, {start_date: $event_date}]}
  items_with_metro_500m_from_location_reactivated: {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.5}, {min_kind_level: [55]}]}
  items_with_metro_new:                    {filter: [{is_active: True}, {min_kind_level: 55}, {start_date: $event_date}]}
  items_with_metro_reactivated:            {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {min_kind_level: 55}]}
  items_with_street:                       {filter: [{is_active: True}, {min_kind_level: 50}]}
  items_with_street_100m_from_location:    {filter: [{is_active: True}, {location_distance.<=: 0.1}, {min_kind_level: 50}]}
  items_with_street_100m_from_location_new: {filter: [{is_active: True}, {location_distance.<=: 0.1}, {min_kind_level: 50}, {start_date: $event_date}]}
  items_with_street_100m_from_location_reactivated: {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.1}, {min_kind_level: 50}]}
  items_with_street_500m_from_location:    {filter: [{is_active: True}, {location_distance.<=: 0.5}, {min_kind_level: [50]}]}
  items_with_street_500m_from_location_new: {filter: [{is_active: True}, {location_distance.<=: 0.5}, {min_kind_level: [50]}, {start_date: $event_date}]}
  items_with_street_500m_from_location_reactivated: {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {location_distance.<=: 0.5}, {min_kind_level: [50]}]}
  items_with_street_new:                   {filter: [{is_active: True}, {min_kind_level: 50}, {start_date: $event_date}]}
  items_with_street_reactivated:           {filter: [{activations_count.>: 1}, {is_active: True}, {last_activation_date: $event_date}, {min_kind_level: 50}]}
  seller_item_views:                       {obs: [item_views]}
  seller_contacts:                         {obs: [contacts]}
  seller_btc:                              {obs: [item_views, contacts]}
  seller_contacts_start_date:              {filter: [{start_date.>=: $ab_start_date}], obs: [contacts]}
  seller_favorites_added:                  {obs: [favs_added]}
  seller_favorites_added_start_date:       {filter: [{start_date.>=: $ab_start_date}], obs: [favs_added]}
  seller_favorites_removed:                {obs: [favs_removed]}
  seller_favorites_removed_start_date:     {filter: [{start_date.>=: $ab_start_date}], obs: [favs_removed]}
  cnt_active_items_liquidity:              {filter: [{is_active: True}], obs: [liquidity], m42: False}
  active_liquid_items:                     {filter: [{is_active: True}, {is_liquid: True}]}
  
metric.uniq:
  active_items_0_photo:                    {counter: cnt_active_items_0_photo,        key: [item]}
  active_items_more_10_description_word:   {counter: cnt_active_items_more_10_description_word, key: [item]}
  active_items_more_10_photo:              {counter: cnt_active_items_more_10_photo,  key: [item]}
  active_items_more_1_photo:               {counter: cnt_active_items_more_1_photo,   key: [item]}
  active_items_more_3_photo:               {counter: cnt_active_items_more_3_photo,   key: [item]}
  active_items_more_40_description_word:   {counter: cnt_active_items_more_40_description_word, key: [item]}
  active_items_more_5_description_word:    {counter: cnt_active_items_more_5_description_word, key: [item]}
  active_items_more_5_photo:               {counter: cnt_active_items_more_5_photo,   key: [item]}
  new_items_0_photo:                       {counter: cnt_new_items_0_photo,           key: [item]}
  new_items_more_10_description_word:      {counter: cnt_new_items_more_10_description_word, key: [item]}
  new_items_more_10_photo:                 {counter: cnt_new_items_more_10_photo,     key: [item]}
  new_items_more_1_photo:                  {counter: cnt_new_items_more_1_photo,      key: [item]}
  new_items_more_3_photo:                  {counter: cnt_new_items_more_3_photo,      key: [item]}
  new_items_more_40_description_word:      {counter: cnt_new_items_more_40_description_word, key: [item]}
  new_items_more_5_description_word:       {counter: cnt_new_items_more_5_description_word, key: [item]}
  new_items_more_5_photo:                  {counter: cnt_new_items_more_5_photo,      key: [item]}
  seller_items_favorites_added:            {counter: seller_favorites_added,          key: [item]}
  seller_items_favorites_removed:          {counter: seller_favorites_removed,        key: [item]}
  seller_items_with_item_views:            {counter: seller_item_views,          key: [item]}
  seller_items_with_btc:                   {counter: seller_btc,                 key: [item]}
  sellers_items_with_contacts:             {counter: seller_contacts,                 key: [item]}
  sellers_favorite_added:                  {counter: seller_favorites_added,          key: [participant]}
  sellers_favorite_added_start_date:       {counter: seller_favorites_added_start_date, key: [participant]}
  sellers_favorite_removed:                {counter: seller_favorites_removed,        key: [participant]}
  sellers_favorite_removed_start_date:     {counter: seller_favorites_removed_start_date, key: [participant]}
  sellers_with_contacts:                   {counter: seller_contacts,                 key: [participant]}
  sellers_with_contacts_start_date:        {counter: seller_contacts_start_date,      key: [participant]}
  sellers_with_item_views:                 {counter: seller_item_views,                 key: [participant]}
  sellers_with_btc:                        {counter: seller_btc,                        key: [participant]}
  users_active_item_0_photo:               {counter: cnt_active_items_0_photo,        key: [participant]}
  users_active_item_more_10_description_word: {counter: cnt_active_items_more_10_description_word, key: [participant]}
  users_active_item_more_10_photo:         {counter: cnt_active_items_more_10_photo,  key: [participant]}
  users_active_item_more_1_photo:          {counter: cnt_active_items_more_1_photo,   key: [participant]}
  users_active_item_more_3_photo:          {counter: cnt_active_items_more_3_photo,   key: [participant]}
  users_active_item_more_40_description_word: {counter: cnt_active_items_more_40_description_word, key: [participant]}
  users_active_item_more_5_description_word: {counter: cnt_active_items_more_5_description_word, key: [participant]}
  users_active_item_more_5_photo:          {counter: cnt_active_items_more_5_photo,   key: [participant]}
  users_active_items:                      {counter: active_items,                    key: [participant]}
  users_new_item_0_photo:                  {counter: cnt_new_items_0_photo,           key: [participant]}
  users_new_item_more_10_description_word: {counter: cnt_new_items_more_10_description_word, key: [participant]}
  users_new_item_more_10_photo:            {counter: cnt_new_items_more_10_photo,     key: [participant]}
  users_new_item_more_1_photo:             {counter: cnt_new_items_more_1_photo,      key: [participant]}
  users_new_item_more_3_photo:             {counter: cnt_new_items_more_3_photo,      key: [participant]}
  users_new_item_more_40_description_word: {counter: cnt_new_items_more_40_description_word, key: [participant]}
  users_new_item_more_5_description_word:  {counter: cnt_new_items_more_5_description_word, key: [participant]}
  users_new_item_more_5_photo:             {counter: cnt_new_items_more_5_photo,      key: [participant]}
  user_active_items_1plus_locations:       {counter: active_items,   key: [participant: 1, city_id: 0]}
  user_active_items_2plus_locations:       {counter: active_items,   key: [participant: 2, city_id: 0]}
  user_active_items_5plus_locations:       {counter: active_items,   key: [participant: 5, city_id: 0]}
  user_active_items_10plus_locations:      {counter: active_items,   key: [participant: 10, city_id: 0]}
  user_active_items_1plus_locations_microcat:       {counter: active_items,   key: [participant: 0, microcat_id: 1, location_id: 0]}
  user_active_items_2plus_locations_microcat:       {counter: active_items,   key: [participant: 0, microcat_id: 2, location_id: 0]}
  user_active_items_5plus_locations_microcat:       {counter: active_items,   key: [participant: 0, microcat_id: 5, location_id: 0]}
  user_active_items_10plus_locations_microcat:      {counter: active_items,   key: [participant: 0, microcat_id: 10, location_id: 0]}
  user_active_items_locations:                      {counter: active_items,   key: [location_id]}           
  user_active_liquid_items:                 {counter: active_liquid_items, key: [participant]}

metric.ratio:
  avg_item_address_length:                      {num: cnt_item_address_length,         den: items_with_address_string}
  avg_item_address_length_new:                  {num: cnt_item_address_length_new,     den: items_with_address_string_new}
  avg_item_address_length_react:                {num: cnt_item_address_length_reactivated, den: items_with_address_string_reactivated}
  seller_item_views_per_active_item:            {num: seller_item_views, den: active_items}
  seller_items_with_item_views_per_active_item: {num: seller_items_with_item_views, den: active_items}
  sellers_with_item_views_per_user_active_items: {num: sellers_with_item_views, den: users_active_items}
  seller_btc_per_item_views:                    {num: seller_btc, den: seller_item_views}
  seller_btc_per_active_item:                   {num: seller_btc, den: active_items}
  seller_contacts_per_item_views:               {num: seller_contacts, den: seller_item_views}
  seller_contact_per_active_item:               {num: seller_contacts, den: active_items}
  liquidity_per_item:                           {num: cnt_active_items_liquidity, den: active_items} 
  active_liquid_items_per_active_items:         {num: active_liquid_items, den: active_items}
  active_liquid_items_per_user_active_items:    {num: active_liquid_items, den: users_active_items}
  seller_1plus_locations_per_user_active_items: {num: user_active_items_1plus_locations, den: users_active_items}
  seller_1plus_multiloc_per_user_active_items:  {num: user_active_items_1plus_locations_microcat, den: users_active_items}
