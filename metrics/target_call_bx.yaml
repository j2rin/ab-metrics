definitions:
  - &is_target_call       {is_target_call: True}
  - &is_success_call      {talk_duration.>: 30}
  - &is_answered_call     {talk_duration.>: 0}
  - &is_call              {call_id.>: 0}

metric.counter:

  target_contact_call_bx:                 {filter: [*is_target_call]} # количество целевых звонков
  target_contact_call_bx_success:         {filter: [*is_target_call, *is_success_call]} # количество целевых звонков длительностью более 30 секунд
  target_contact_call_bx_talkseconds:     {filter: [*is_target_call], obs: [talk_duration]} # количество целевых секунд
  answered_call_bx:                       {filter: [*is_answered_call]} # количество отвеченных звонков
  call_bx:                                {filter: [*is_call]} # количество звонков

metric.uniq:

  user_target_contact_call_bx:            {counter: target_contact_call_bx, key: [user]}
  user_target_contact_call_bx_success:    {counter: target_contact_call_bx_success, key: [user]}
  user_answered_call_bx:                  {counter: answered_call_bx, key: [user]}
  user_call_bx:                           {counter: call_bx, key: [user]}

metric.ratio:
  target_contact_call_bx_ratio:           {num: target_contact_call_bx, den: call_bx} # доля целевых звонков от всех отвеченных
  user_target_contact_call_bx_ratio:      {num: user_target_contact_call_bx, den: user_call_bx} # доля юзеров с целевыми звонками от всех

  target_contact_call_bx_ratio_answered:  {num: target_contact_call_bx, den: answered_call_bx} # доля целевых звонков от всех отвеченных
  

