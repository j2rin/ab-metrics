definitions:
  - &queue_not_asd  [1stDelivery, 1st_Delivery, HelpCenter, Items, Mobile, Privatebuddy]
  - &asd_excluded   {queue: *queue_not_asd}

metric.counter:
  classified_amount_net_adj:         {obs: [transaction_amount_net_adj], filter: [is_revenue: true]}
  classified_transactions:           {obs: [transaction_count], filter: [is_revenue: true]}
  lf_amount_net_adj:                 {obs: [transaction_amount_net_adj], filter: [is_revenue: true, product_type: 'lf']}
  lf_transactions:                   {obs: [transaction_count], filter: [is_revenue: true, product_type: 'lf']}
  subs_amount_net_adj:               {obs: [transaction_amount_net_adj], filter: [is_revenue: true, product_type: 'subscription', product_subtype.!=: 'extension']}
  subs_transactions:                 {obs: [transaction_count], filter: [is_revenue: true, product_type: 'subscription', product_subtype.!=: 'extension']}
  ext_amount_net_adj:                {obs: [transaction_amount_net_adj], filter: [is_revenue: true, product_type: 'subscription', product_subtype: 'extension']}
  ext_transactions:                  {obs: [transaction_count], filter: [is_revenue: true, product_type: 'subscription', product_subtype: 'extension']}
  subs_w_extensions_amount_net_adj:  {obs: [transaction_amount_net_adj ], filter: [is_revenue: true, product_type: 'subscription']}
  subs_w_extensions_transactions:    {obs: [transaction_count], filter: [is_revenue: true, product_type: 'subscription']}
  vas_amount_net_adj:                {obs: [transaction_amount_net_adj], filter: [is_revenue: true, product_type: 'vas']}
  vas_transactions:                  {obs: [transaction_count], filter: [is_revenue: true, product_type: 'vas']}
  paid_contact_amount_net_adj:       {obs: [transaction_count], filter: [is_revenue: true, product_type: 'paid_contact']}
  cpa_amount_net_adj:                {obs: [transaction_amount_net_adj], filter: [is_revenue: true, product_type: 'cpa']}
  cpa_transactions:                  {obs: [transaction_count], filter: [is_revenue: true, product_type: 'cpa']}
  bundle_amount_net_adj:             {obs: [transaction_amount_net_adj], filter: [is_revenue: true, product_type: 'bundle']}
  bundle_transactions:               {obs: [transaction_count], filter: [is_revenue: true, product_type: 'bundle']}

metric.uniq:
  classified_users:                        {counter: classified_amount_net_adj,   key: [user]}
  lf_users:                                {counter: lf_amount_net_adj,           key: [user]}
  paying_users:                            {counter: avito_amount_net_adj,        key: [user]}
  subs_w_extensions_users:                 {counter: subs_w_extensions_amount_net_adj,   key: [user]}
  vas_users:                               {counter: vas_amount_net_adj,          key: [user]}

metric.ratio:
  classified_price_net_adj:                {num: classified_amount_net_adj,       den: classified_transactions}
  lf_price_net_adj:                        {num: lf_amount_net_adj,               den: lf_transactions}
  subs_w_extensions_price_net_adj:         {num: subs_w_extensions_amount_net_adj,   den: subs_w_extensions_transactions}
  vas_transactions_per_user:               {num: vas_transactions,                den: vas_users}
  subs_w_extensions_transactions_per_user: {num: subs_w_extensions_transactions,  den: subs_w_extensions_users}
  lf_transactions_per_user:                {num: lf_transactions,                 den: lf_users}
  classified_transactions_per_user:        {num: classified_transactions,         den: classified_users}
  vas_price_net_adj:                       {num: vas_amount_net_adj,              den: vas_transactions}
