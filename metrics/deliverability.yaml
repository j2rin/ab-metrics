definitions:
  - &any_courier_enabled: {
      $or: {
            [{is_enabled_courierd2d: True}, {available_courierd2d: True}],
            [{is_enabled_courier: True}, {available_courier: True}]
          }
      }
  - &is_bulky:                    { available_courier_yandexcargo: True}
  - &any_courier_available:       {$or: [available_courier: True, available_courierd2d: True] }


metric.counter:

  # general
  cnt_dlb_active_items:                           {}
  cnt_items_available_regular_bulky:              {filter: [is_delivery_available_regular: True]}
  cnt_items_enabled_regular_bulky:                {filter: [is_delivery_active_regular: True, is_delivery_available_regular: True]}
  cnt_items_available_regular:                    {filter: [is_delivery_available_regular: True, available_courier_yandexcargo: False]}
  cnt_items_enabled_regular:                      {filter: [is_delivery_active_regular: True, is_delivery_available_regular: True, available_courier_yandexcargo: False]}
  cnt_items_available_anydbs:                     {filter: [is_delivery_available_anydbs: True]}
  cnt_items_enabled_anydbs:                       {filter: [is_delivery_active_anydbs: True, is_delivery_available_anydbs: True]}

  # enabled by delivery flow
  cnt_items_enabled_pudo:                         {filter: [ is_enabled_pvz: True, available_pvz: True ] }
  cnt_items_available_pudo:                       {filter: [ available_pvz: True ] }
  cnt_items_enabled_locker:                       {filter: [ is_enabled_postamat: True, available_locker: True ] }
  cnt_items_available_locker:                     {filter: [ available_locker: True ] }
  cnt_items_enabled_courier_bulky:                {filter: [ *any_courier_enabled: True, *any_courier_available: True]}
  cnt_items_available_courier_bulky:              {filter: [ *any_courier_available: True ] }
  cnt_items_enabled_express_courier_bulky:        {filter: [ is_enabled_courier: True, available_courier: True ] }
  cnt_items_available_express_courier_bulky:      {filter: [ available_courier: True ] }
  cnt_items_enabled_courier:                      {filter: [ *any_courier_enabled: True, *any_courier_available: True, *is_bulky: False  ] }
  cnt_items_available_courier:                    {filter: [ *any_courier_available: True , *is_bulky: False ] }
  cnt_items_enabled_express_courier:              {filter: [ is_enabled_courier: True , *is_bulky: False ] }
  cnt_items_available_express_courier:            {filter: [ available_courier: True , *is_bulky: False ] }
  cnt_items_enabled_dbs:                          {filter: [ is_enabled_dbs: True ] }
  cnt_items_available_dbs:                        {filter: [ available_dbs: True ] }
  cnt_items_enabled_rdbs:                         {filter: [ is_enabled_rdbs: True ] }
  cnt_items_available_rdbs:                       {filter: [ available_rdbs: True ] }

  # enabled by delivery provider



metric.uniq:

  ################################################
  # general
    # items
  dlb_active_items:                               {counter: cnt_dlb_active_items,                       key: [item]}
  items_available_regular_bulky:                  {counter: cnt_items_available_regular_bulky,          key: [item]}
  items_enabled_regular_bulky:                    {counter: cnt_items_enabled_regular_bulky,            key: [item]}
  items_available_regular:                        {counter: cnt_items_available_regular,                key: [item]}
  items_enabled_regular:                          {counter: cnt_items_enabled_regular,                  key: [item]}
  items_available_anydbs:                         {counter: cnt_items_available_anydbs,                 key: [item]}
  items_enabled_anydbs:                           {counter: cnt_items_enabled_anydbs,                   key: [item]}
    # users
  dlb_active_users:                               {counter: cnt_dlb_active_items,                       key: [user_id]}
  users_available_regular_bulky:                  {counter: cnt_items_available_regular_bulky,          key: [user_id]}
  users_enabled_regular_bulky:                    {counter: cnt_items_enabled_regular_bulky,            key: [user_id]}
  users_available_regular:                        {counter: cnt_items_available_regular,                key: [user_id]}
  users_enabled_regular:                          {counter: cnt_items_enabled_regular,                  key: [user_id]}
  users_available_anydbs:                         {counter: cnt_items_available_anydbs,                 key: [user_id]}
  users_enabled_anydbs:                           {counter: cnt_items_enabled_anydbs,                   key: [user_id]}
    # listers
  dlb_active_listers:                             {counter: cnt_dlb_active_items,                       key: [user_id, logical_category_id]}
  listers_available_regular_bulky:                {counter: cnt_items_available_regular_bulky,          key: [user_id, logical_category_id]}
  listers_enabled_regular_bulky:                  {counter: cnt_items_enabled_regular_bulky,            key: [user_id, logical_category_id]}
  listers_available_regular:                      {counter: cnt_items_available_regular,                key: [user_id, logical_category_id]}
  listers_enabled_regular:                        {counter: cnt_items_enabled_regular,                  key: [user_id, logical_category_id]}
  listers_available_anydbs:                       {counter: cnt_items_available_anydbs,                 key: [user_id, logical_category_id]}
  listers_enabled_anydbs:                         {counter: cnt_items_enabled_anydbs,                   key: [user_id, logical_category_id]}

  ################################################
  # enabled by delivery flow
    # items
  items_enabled_pudo:                             {counter: cnt_items_enabled_pudo,                     key: [item]}
  items_available_pudo:                           {counter: cnt_items_available_pudo,                   key: [item]}
  items_enabled_locker:                           {counter: cnt_items_enabled_locker,                   key: [item]}
  items_available_locker:                         {counter: cnt_items_available_locker,                 key: [item]}
  items_enabled_courier_bulky:                    {counter: cnt_items_enabled_courier_bulky,            key: [item]}
  items_available_courier_bulky:                  {counter: cnt_items_available_courier_bulky,          key: [item]}
  items_enabled_express_courier_bulky:            {counter: cnt_items_enabled_express_courier_bulky,    key: [item]}
  items_available_express_courier_bulky:          {counter: cnt_items_available_express_courier_bulky,  key: [item]}
  items_enabled_courier:                          {counter: cnt_items_enabled_courier,                  key: [item]}
  items_available_courier:                        {counter: cnt_items_available_courier,                key: [item]}
  items_enabled_express_courier:                  {counter: cnt_items_enabled_express_courier,          key: [item]}
  items_available_express_courier:                {counter: cnt_items_available_express_courier,        key: [item]}
  items_enabled_dbs:                              {counter: cnt_items_enabled_dbs,                      key: [item]}
  items_available_dbs:                            {counter: cnt_items_available_dbs,                    key: [item]}
  items_enabled_rdbs:                             {counter: cnt_items_enabled_rdbs,                     key: [item]}
  items_available_rdbs:                           {counter: cnt_items_available_rdbs,                   key: [item]}
    # users
  users_enabled_pudo:                             {counter: cnt_items_enabled_pudo,                     key: [user_id]}
  users_available_pudo:                           {counter: cnt_items_available_pudo,                   key: [user_id]}
  users_enabled_locker:                           {counter: cnt_items_enabled_locker,                   key: [user_id]}
  users_available_locker:                         {counter: cnt_items_available_locker,                 key: [user_id]}
  users_enabled_courier_bulky:                    {counter: cnt_items_enabled_courier_bulky,            key: [user_id]}
  users_available_courier_bulky:                  {counter: cnt_items_available_courier_bulky,          key: [user_id]}
  users_enabled_express_courier_bulky:            {counter: cnt_items_enabled_express_courier_bulky,    key: [user_id]}
  users_available_express_courier_bulky:          {counter: cnt_items_available_express_courier_bulky,  key: [user_id]}
  users_enabled_courier:                          {counter: cnt_items_enabled_courier,                  key: [user_id]}
  users_available_courier:                        {counter: cnt_items_available_courier,                key: [user_id]}
  users_enabled_express_courier:                  {counter: cnt_items_enabled_express_courier,          key: [user_id]}
  users_available_express_courier:                {counter: cnt_items_available_express_courier,        key: [user_id]}
  users_enabled_dbs:                              {counter: cnt_items_enabled_dbs,                      key: [user_id]}
  users_available_dbs:                            {counter: cnt_items_available_dbs,                    key: [user_id]}
  users_enabled_rdbs:                             {counter: cnt_items_enabled_rdbs,                     key: [user_id]}
  users_available_rdbs:                           {counter: cnt_items_available_rdbs,                   key: [user_id]}
    # listers
  listers_enabled_pudo:                           {counter: cnt_items_enabled_pudo,                     key: [user_id, logical_category_id]]}
  listers_available_pudo:                         {counter: cnt_items_available_pudo,                   key: [user_id, logical_category_id]]}
  listers_enabled_locker:                         {counter: cnt_items_enabled_locker,                   key: [user_id, logical_category_id]]}
  listers_available_locker:                       {counter: cnt_items_available_locker,                 key: [user_id, logical_category_id]]}
  listers_enabled_courier_bulky:                  {counter: cnt_items_enabled_courier_bulky,            key: [user_id, logical_category_id]]}
  listers_available_courier_bulky:                {counter: cnt_items_available_courier_bulky,          key: [user_id, logical_category_id]]}
  listers_enabled_express_courier_bulky:          {counter: cnt_items_enabled_express_courier_bulky,    key: [user_id, logical_category_id]]}
  listers_available_express_courier_bulky:        {counter: cnt_items_available_express_courier_bulky,  key: [user_id, logical_category_id]]}
  listers_enabled_courier:                        {counter: cnt_items_enabled_courier,                  key: [user_id, logical_category_id]]}
  listers_available_courier:                      {counter: cnt_items_available_courier,                key: [user_id, logical_category_id]]}
  listers_enabled_express_courier:                {counter: cnt_items_enabled_express_courier,          key: [user_id, logical_category_id]]}
  listers_available_express_courier:              {counter: cnt_items_available_express_courier,        key: [user_id, logical_category_id]]}
  listers_enabled_dbs:                            {counter: cnt_items_enabled_dbs,                      key: [user_id, logical_category_id]]}
  listers_available_dbs:                          {counter: cnt_items_available_dbs,                    key: [user_id, logical_category_id]]}
  listers_enabled_rdbs:                           {counter: cnt_items_enabled_rdbs,                     key: [user_id, logical_category_id]]}
  listers_available_rdbs:                         {counter: cnt_items_available_rdbs,                   key: [user_id, logical_category_id]]}


metric.ratio:
  # general
  available_regular:                              {num: cnt_items_available_regular,                    den: cnt_dlb_active_items}
  active_regular:                                 {num: cnt_items_enabled_regular,                      den: cnt_items_available_regular}
  available_regular_bulky:                        {num: cnt_items_available_regular_bulky,              den: cnt_dlb_active_items}
  active_regular_bulky:                           {num: cnt_items_enabled_regular_bulky,                den: cnt_items_available_regular_bulky}
  dlb_available_anydbs:                           {num: cnt_items_available_anydbs,                     den: cnt_dlb_active_items}
  dlb_active_anydbs:                              {num: cnt_items_enabled_anydbs,                       den: cnt_items_available_anydbs}

  # enabled by delivery flow
  enabled_pudo:                                  {num: items_enabled_pudo,                             den: items_available_pudo}
  enabled_locker:                                {num: items_enabled_locker,                           den: items_available_locker}
  enabled_courier_bulky:                         {num: items_enabled_courier_bulky,                    den: items_available_courier_bulky}
  enabled_express_courier_bulky:                 {num: items_enabled_express_courier_bulky,            den: items_available_express_courier_bulky}
  enabled_courier:                               {num: items_enabled_courier,                          den: items_available_courier}
  enabled_express_courier:                       {num: items_enabled_express_courier,                  den: items_available_express_courier}
  enabled_dbs:                                   {num: items_enabled_dbs,                              den: items_available_dbs}
  enabled_rdbs:                                  {num: items_enabled_rdbs,                             den: items_available_rdbs}