definitions:
  - &revenue   {is_revenue: true, is_classified: true}
  - &payment   {is_payment: true, is_classified: true}

metric.counter:
#revenue (amount)
  vas_amount:                              {obs: [amount],      filter: [*revenue, product_type: 'vas']}
  vas_amount_start_date:                   {obs: [amount],      filter: [*revenue, product_type: 'vas', start_date.>=: $ab_start_date]}
  vas_amount_visual:                       {obs: [amount],      filter: [*revenue, product_type: 'vas', product_subtype: 'visual']}
  vas_amount_performance:                  {obs: [amount],      filter: [*revenue, product_type: 'vas', product_subtype: 'performance']}
  vas_amount_bundle:                       {obs: [amount],      filter: [*revenue, product_type: 'vas', product_subtype: 'bundle']}
  vas_amount_x2_1:                         {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x2_1']}
  vas_amount_x2_7:                         {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x2_7']}
  vas_amount_x5_1:                         {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x5_1']}
  vas_amount_x5_7:                         {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x5_7']}
  vas_amount_x10_1:                        {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x10_1']}
  vas_amount_x10_7:                        {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x10_7']}
  vas_amount_highlight:                    {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'Highlight']}
  vas_amount_highlight_start_date:         {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'Highlight', start_date.>=: $ab_start_date]}
  vas_amount_xl:                           {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'XL']}
  vas_amount_xl_start_date:                {obs: [amount],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'XL', start_date.>=: $ab_start_date]}
   #revenue (amount_net)
  vas_amount_net:                          {obs: [amount_net],  filter: [*revenue, product_type: 'vas']}
  vas_amount_net_visual:                   {obs: [amount_net],      filter: [*revenue, product_type: 'vas', product_subtype: 'visual']}
  vas_amount_net_performance:              {obs: [amount_net],      filter: [*revenue, product_type: 'vas', product_subtype: 'performance']}
  vas_amount_net_bundle:                   {obs: [amount_net],      filter: [*revenue, product_type: 'vas', product_subtype: 'bundle']}
  vas_amount_net_x2_1:                     {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x2_1']}
  vas_amount_net_x2_7:                     {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x2_7']}
  vas_amount_net_x5_1:                     {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x5_1']}
  vas_amount_net_x5_7:                     {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x5_7']}
  vas_amount_net_x10_1:                    {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x10_1']}
  vas_amount_net_x10_7:                    {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x10_7']}
  vas_amount_net_highlight:                {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'Highlight']}
  vas_amount_net_highlight_start_date:     {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'Highlight', start_date.>=: $ab_start_date]}
  vas_amount_net_start_date:               {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'Highlight']}
  vas_amount_net_xl:                       {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'XL']}
  vas_amount_net_xl_start_date:            {obs: [amount_net],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'XL', start_date.>=: $ab_start_date]}
 #clean reserved revenue (amount)
 vas_clean_reserved_amount:                              {obs: [amount],      filter: [*payment, product_type: 'vas']}
 vas_clean_reserved_amount_start_date:                   {obs: [amount],      filter: [*payment, product_type: 'vas', start_date.>=: $ab_start_date]}
 vas_clean_reserved_amount_visual:                       {obs: [amount],      filter: [*payment, product_type: 'vas', product_subtype: 'visual']}
 vas_clean_reserved_amount_performance:                  {obs: [amount],      filter: [*payment, product_type: 'vas', product_subtype: 'performance']}
 vas_clean_reserved_amount_bundle:                       {obs: [amount],      filter: [*payment, product_type: 'vas', product_subtype: 'bundle']}
 vas_clean_reserved_amount_x2_1:                         {obs: [amount],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x2_1']}
 vas_clean_reserved_amount_x2_7:                         {obs: [amount],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x2_7']}
 vas_clean_reserved_amount_x5_1:                         {obs: [amount],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x5_1']}
 vas_clean_reserved_amount_x5_7:                         {obs: [amount],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x5_7']}
 vas_clean_reserved_amount_x10_1:                        {obs: [amount],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x10_1']}
 vas_clean_reserved_amount_x10_7:                        {obs: [amount],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x10_7']}
 vas_clean_reserved_amount_highlight:                    {obs: [amount],      filter: [*payment, product_type: 'vas', transaction_subtype: 'Highlight']}
 vas_clean_reserved_amount_xl:                           {obs: [amount],      filter: [*payment, product_type: 'vas', transaction_subtype: 'XL']}
 #clean reserved revenue (amount_net)
 vas_clean_reserved_amount_net:                          {obs: [amount_net],      filter: [*payment, product_type: 'vas']}
 vas_clean_reserved_amount_net_visual:                   {obs: [amount_net],      filter: [*payment, product_type: 'vas', product_subtype: 'visual']}
 vas_clean_reserved_amount_net_performance:              {obs: [amount_net],      filter: [*payment, product_type: 'vas', product_subtype: 'performance']}
 vas_clean_reserved_amount_net_bundle:                   {obs: [amount_net],      filter: [*payment, product_type: 'vas', product_subtype: 'bundle']}
 vas_clean_reserved_amount_net_x2_1:                     {obs: [amount_net],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x2_1']}
 vas_clean_reserved_amount_net_x2_7:                     {obs: [amount_net],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x2_7']}
 vas_clean_reserved_amount_net_x5_1:                     {obs: [amount_net],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x5_1']}
 vas_clean_reserved_amount_net_x5_7:                     {obs: [amount_net],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x5_7']}
 vas_clean_reserved_amount_net_x10_1:                    {obs: [amount_net],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x10_1']}
 vas_clean_reserved_amount_net_x10_7:                    {obs: [amount_net],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x10_7']}
 vas_clean_reserved_amount_net_highlight:                {obs: [amount_net],      filter: [*payment, product_type: 'vas', transaction_subtype: 'Highlight']}
 vas_clean_reserved_amount_net_xl:                       {obs: [amount_net],      filter: [*payment, product_type: 'vas', transaction_subtype: 'XL']}
 #transactions (write off, burn)
  vas_transactions_mnz:                    {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas']}
  vas_transactions_mnz_visual:             {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', product_subtype: 'visual']}
  vas_transactions_mnz_performance:        {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', product_subtype: 'performance']}
  vas_transactions_mnz_bundle:             {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', product_subtype: 'bundle']}
  vas_transactions_mnz_x2_1:               {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x2_1']}
  vas_transactions_mnz_x2_7:               {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x2_7']}
  vas_transactions_mnz_x5_1:               {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x5_1']}
  vas_transactions_mnz_x5_7:               {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x5_7']}
  vas_transactions_mnz_x10_1:              {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x10_1']}
  vas_transactions_mnz_x10_7:              {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'x10_7']}
  vas_transactions_highlight:              {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'Highlight']}
  vas_transactions_highlight_start_date:   {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'Highlight', start_date.>=: $ab_start_date]}
  vas_transactions_start_date:             {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', start_date.>=: $ab_start_date]}
  vas_transactions_xl:                     {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'XL']}
  vas_transactions_xl_start_date:          {obs: [transaction_counter],      filter: [*revenue, product_type: 'vas', transaction_subtype: 'XL', start_date.>=: $ab_start_date]}
  # reserve transactions
  vas_reserve_transactions:                    {obs: [transaction_counter],      filter: [*payment, product_type: 'vas']}
  vas_reserve_transactions_visual:             {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', product_subtype: 'visual']}
  vas_reserve_transactions_performance:        {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', product_subtype: 'performance']}
  vas_reserve_transactions_bundle:             {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', product_subtype: 'bundle']}
  vas_reserve_transactions_x2_1:               {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x2_1']}
  vas_reserve_transactions_x2_7:               {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x2_7']}
  vas_reserve_transactions_x5_1:               {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x5_1']}
  vas_reserve_transactions_x5_7:               {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x5_7']}
  vas_reserve_transactions_x10_1:              {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x10_1']}
  vas_reserve_transactions_x10_7:              {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', transaction_subtype: 'x10_7']}
  vas_reserve_transactions_highlight:          {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', transaction_subtype: 'Highlight']}
  vas_reserve_transactions_xl:                 {obs: [transaction_counter],      filter: [*payment, product_type: 'vas', transaction_subtype: 'XL']}


metric.uniq:
  users_vas:                               {counter: vas_amount_net,                  key: [user]}
  users_vas_visual:                        {counter: vas_amount_net_visual,           key: [user]}
  users_vas_bundle:                        {counter: vas_amount_net_bundke,           key: [user]}
  users_vas_performance:                   {counter: vas_amount_net_performance,      key: [user]}
  users_vas_x2_1:                          {counter: vas_amount_net_x2_1,             key: [user]}
  users_vas_x2_7:                          {counter: vas_amount_net_x2_7,             key: [user]}
  users_vas_x5_1:                          {counter: vas_amount_net_x5_1,             key: [user]}
  users_vas_x5_7:                          {counter: vas_amount_net_x5_7,             key: [user]}
  users_vas_x10_1:                         {counter: vas_amount_net_x10_1,            key: [user]}
  users_vas_x10_7:                         {counter: vas_amount_net_x10_7,            key: [user]}
  users_vas_highlight:                     {counter: vas_amount_net_highlight,        key: [user]}
  users_vas_highlight_start_date:          {counter: vas_amount_net_highlight_start_date, key: [user]}
  users_vas_start_date:                    {counter: vas_amount_net_start_date,       key: [user]}
  users_vas_xl:                            {counter: vas_amount_net_xl,               key: [user]}
  users_vas_xl_start_date:                 {counter: vas_amount_net_xl_start_date,    key: [user]}

metric.ratio:
  vas_avo:                                 {num: vas_amount,                      den: vas_transactions_mnz}
  vas_avo_visual:                          {num: vas_amount_visual,               den: vas_transactions_mnz_visual}
  vas_avo_performance:                     {num: vas_amount_performance,          den: vas_transactions_mnz_performance}
  vas_avo_x2_1:                            {num: vas_amount_x2_1,                 den: vas_transactions_mnz_x2_1}
  vas_avo_x2_7:                            {num: vas_amount_x2_7,                 den: vas_transactions_mnz_x2_7}
  vas_avo_x5_1:                            {num: vas_amount_x5_1,                 den: vas_transactions_mnz_x5_1}
  vas_avo_x5_7:                            {num: vas_amount_x5_7,                 den: vas_transactions_mnz_x5_7}
  vas_avo_x10_1:                           {num: vas_amount_x10_1,                den: vas_transactions_mnz_x10_1}
  vas_avo_x10_7:                           {num: vas_amount_x10_7,                den: vas_transactions_mnz_x10_7}
  vas_avo_highlight:                       {num: vas_amount_highlight,            den: vas_transactions_highlight}
  vas_avo_highlight_start_date:            {num: vas_amount_highlight_start_date, den: vas_transactions_highlight_start_date}
  vas_avo_net:                             {num: vas_amount_net,                  den: vas_transactions_mnz}
  vas_avo_net_highlight:                   {num: vas_amount_net_highlight,        den: vas_transactions_highlight}
  vas_avo_net_highlight_start_date:        {num: vas_amount_net_highlight_start_date, den: vas_transactions_highlight_start_date}
  vas_avo_net_start_date:                  {num: vas_amount_net_start_date,       den: vas_transactions_start_date}
  vas_avo_net_xl:                          {num: vas_amount_net_xl,               den: vas_transactions_xl}
  vas_avo_net_xl_start_date:               {num: vas_amount_net_xl_start_date,    den: vas_transactions_xl_start_date}
  vas_avo_start_date:                      {num: vas_amount_start_date,           den: vas_transactions_start_date}
  vas_avo_xl:                              {num: vas_amount_xl,                   den: vas_transactions_xl}
  vas_avo_xl_start_date:                   {num: vas_amount_xl_start_date,        den: vas_transactions_xl_start_date}
