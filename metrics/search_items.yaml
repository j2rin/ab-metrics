definitions:
    - &eid_u2i      [30204750001]               # [2012]
    - &eid_i2i      [109161500001]              # [2437]
    - &eid_cv2vac   [290081000001]              # [4386]
    - &eid_serp     [10]                        # [300]
    - &is_u2i       {eventtype_id: *eid_u2i}
    - &is_i2i       {eventtype_id: *eid_i2i}
    - &is_cv2vac    {eventtype_id: *eid_cv2vac}
    - &is_serp      {eventtype_id: *eid_serp}
    - &collab       {item_engines.bit: 0}
    - &user2vec     {item_engines.bit: 1}
    - &similars     {item_engines.bit: 3}
    - &graph        {item_engines.bit: 4}

metric.counter:
    cnt_rec_score_u2i:                  {filter: [*is_u2i],             obs: [score],           }
    cnt_rec_score_i2i:                  {filter: [*is_i2i],             obs: [score],           }
    cnt_rec_items_u2i:                  {filter: [*is_u2i],             obs: [items_count],     }
    cnt_rec_items_i2i:                  {filter: [*is_i2i],             obs: [items_count],     }
    cnt_rec_items_cv2vac:               {filter: [*is_cv2vac],          obs: [items_count],     }
    show_u2i_collab:                    {filter: [*is_u2i, *collab],    obs: [items_count]}
    show_u2i_user2vec:                  {filter: [*is_u2i, *user2vec],  obs: [items_count]}
    show_u2i_similars:                  {filter: [*is_u2i, *similars],  obs: [items_count]}
    show_u2i_graph:                     {filter: [*is_u2i, *graph],     obs: [items_count]}
    cnt_serp_freshness:                 {filter: [*is_serp],            obs: [freshness],       }
    cnt_serp_items:                     {filter: [*is_serp],            obs: [items_count],     }
    seller_buyer_pair_with_show:        {                               obs: [ sellers_count ] }
    seller_buyer_pair_with_search:      {filter: [*is_serp],            obs: [ sellers_count ] }
    seller_buyer_pair_with_rec_u2i:     {filter: [*is_u2i],             obs: [ sellers_count ] }

metric.uniq:
    user_item_shows_u2i:                {counter: cnt_rec_items_u2i,    key: [cookie]}

metric.ratio:
    rec_score_u2i:                      {num: cnt_rec_score_u2i,                den: cnt_rec_items_u2i}
    rec_score_i2i:                      {num: cnt_rec_score_i2i,                den: cnt_rec_items_i2i}
    serp_freshness:                     {num: cnt_serp_freshness,               den: cnt_serp_items}
    seller_buyer_pair_per_serp_items:   {num: seller_buyer_pair_with_search,    den: cnt_serp_items}
    seller_buyer_pair_per_u2i_items:    {num: seller_buyer_pair_with_rec_u2i,   den: cnt_rec_items_u2i}
