definitions:
    - &eid_u2i      [30204750001]               # [2012]
    - &eid_i2i      [109161500001]              # [2437]
    - &eid_cv2vac   [290081000001]              # [4386]
    - &eid_serp     [10]                        # [300]
    - &eid_push     [389119750001]              # [5354]
    - &is_u2i       {eventtype_id: *eid_u2i     }
    - &is_i2i       {eventtype_id: *eid_i2i     }
    - &is_cv2vac    {eventtype_id: *eid_cv2vac  }
    - &is_serp      {eventtype_id: *eid_serp    }
    - &is_push      {eventtype_id: *eid_push    }
    - &collab       {item_engines.bit: 0        }
    - &user2vec     {item_engines.bit: 1        }
    - &similars     {item_engines.bit: 3        }
    - &graph        {item_engines.bit: 4        }
    - &crosscat     {item_engines.bit: 5        }
    - &is_serp_push {item_type.bit: [3]         }

metric.counter:
    cnt_rec_score_u2i:                  {filter: [*is_u2i],             obs: [score]            }
    cnt_rec_score_i2i:                  {filter: [*is_i2i],             obs: [score]            }
    cnt_rec_items_u2i:                  {filter: [*is_u2i],             obs: [items_count]      }
    rec_items_dedup_u2i:                {filter: [*is_u2i],             obs: [items_dedup_count]}
    cnt_rec_items_i2i:                  {filter: [*is_i2i],             obs: [items_count]      }
    cnt_rec_items_cv2vac:               {filter: [*is_cv2vac],          obs: [items_count]      }
    show_u2i_collab:                    {filter: [*is_u2i, *collab],    obs: [items_count]      }
    show_u2i_user2vec:                  {filter: [*is_u2i, *user2vec],  obs: [items_count]      }
    show_u2i_similars:                  {filter: [*is_u2i, *similars],  obs: [items_count]      }
    show_u2i_graph:                     {filter: [*is_u2i, *graph],     obs: [items_count]      }
    show_u2i_crosscat:                  {filter: [*is_u2i, *crosscat],  obs: [items_count]      }
    cnt_serp_freshness:                 {filter: [*is_serp],            obs: [freshness]        }
    cnt_serp_items:                     {filter: [*is_serp],            obs: [items_count]      }
    cnt_serp_push_rnk10:                {filter: [*is_serp_push, *is_serp],  obs: [items_count]      }
    cnt_serp_rnk10:                     {filter: [*is_serp],            obs: [items_count]      }
    serp_items_dedup:                   {filter: [*is_serp],            obs: [items_dedup_count]}
    serp_items_grouped:                 {filter: [*is_serp],            obs: [items_grouped_count]}
    push_items:                         {filter: [*is_push],            obs: [items_count]      }
    seller_buyer_pair_with_show:        {                               obs: [sellers_count]    }
    seller_buyer_pair_with_search:      {filter: [*is_serp],            obs: [sellers_count]    }
    seller_buyer_pair_with_rec_u2i:     {filter: [*is_u2i],             obs: [sellers_count]    }

metric.uniq:
    user_item_shows_u2i:                {counter: cnt_rec_items_u2i,    key: [cookie]}

metric.ratio:
    rec_score_u2i:                      {num: cnt_rec_score_u2i,                den: cnt_rec_items_u2i  }
    rec_score_i2i:                      {num: cnt_rec_score_i2i,                den: cnt_rec_items_i2i  }
    serp_freshness:                     {num: cnt_serp_freshness,               den: cnt_serp_items     }
    serp_push_ratio_rnk10:              {num: cnt_serp_push_rnk10,              den: cnt_serp_rnk10     }
    seller_buyer_pair_per_serp_items:   {num: seller_buyer_pair_with_search,    den: cnt_serp_items     }
    seller_buyer_pair_per_u2i_items:    {num: seller_buyer_pair_with_rec_u2i,   den: cnt_rec_items_u2i  }
    serp_items_dedup_ratio:             {num: serp_items_dedup,                 den: cnt_serp_items     }
    serp_items_grouped_ratio:           {num: serp_items_grouped,               den: cnt_serp_items     }
    rec_items_dedup_u2i_ratio:          {num: rec_items_dedup_u2i,              den: cnt_rec_items_u2i  }
