create fact buyer_stream as
        select
        t.platform_id,
        t.event_date::date as __date__,
        t.cookie_id as cookie,
        t.cookie_id,
        t.user_id,
        t.session_no,
        t.item_id,
        t.item_user_id,
        t.eid,
        t.x,
        t.query_id,
        t.q,
        t.item_count,
        t.base_item_count,
        t.page_no,
        t.from_page,
        t.item_vas_flags,
        t.phone_view_source,
        t.item_x_type % 2 as item_x_type,
        t.x_eid,
        t.search_flags,
        t.item_flags,
        t.other_flags,
        t.x_from_page,
        t.search_sort,
        t.search_query_type,
        t.item_serp_flags,
        t.is_human,
        t.search_radius,
        t.district_count,
        t.metro_count,
        t.location_id,
        t.microcat_id,
        t.item_engines,
        t.location_session_microcat,
        t.favorites_net,
        t.event_no,
        t.x_rec_engine_id,
        hash(t.cookie_id, t.item_id) as cookie_item,
        hash(t.item_id, t.x) as item_x,
        hash(t.cookie_id, t.session_no) as session
from dma.vo_buyer_stream_dimetra t;

create metrics buyer_stream as
select
    sum(case when (eid in (300, 2592) or platform_id in (1, 2) and eid = 2572 or platform_id = 1 and eid = 301) then 1 end) as advertisement_page_views,
    sum(case when eid in (2572, 2592) then 1 end) as all_main_pages,
    sum(case when page_no = 0 and base_item_count = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as base_serp_empty,
    sum(case when page_no = 0 and base_item_count >= 1 and base_item_count <= 9 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as base_serp_small,
    sum(case when page_no = 0 and base_item_count = 0 and eid = 300 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as base_serp_with_query_empty,
    sum(case when page_no = 0 and base_item_count >= 1 and base_item_count <= 9 and eid = 300 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as base_serp_with_query_small,
    sum(case when page_no = 0 and base_item_count = 0 and eid = 300 and q = '' and (onmap = 0 or platform_id != 1) then 1 end) as base_serp_without_query_empty,
    sum(case when page_no = 0 and base_item_count >= 1 and base_item_count <= 9 and eid = 300 and q = '' and (onmap = 0 or platform_id != 1) then 1 end) as base_serp_without_query_small,
    sum(case when eid = 2581 then 1 end) as booking_created_short_rent,
    sum(case when item_flags & 16777216 > 0 and eid = 2581 then 1 end) as booking_created_str_flat_verified_badge,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as bt_clicks,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and new_user_btc = True then 1 end) as bt_clicks_new,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and new_user_btc = False then 1 end) as bt_clicks_returned,
    sum(case when item_flags & 2 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_actual_calendar,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and SFAccount_Type = 'Девелопер' then 1 end) as btc_developer,
    sum(case when SFAccount_Type = 'Девелопер' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_developer_search,
    sum(case when item_flags & 4194304 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_in_stock,
    sum(case when item_flags & 16 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_leadgen_item,
    sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 2743 or x_eid = 300)) then 1 end) as btc_map_or_s,
    sum(case when item_serp_flags & 32768 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_multiloc,
    sum(case when item_serp_flags & 32768 > 0 and search_query_type = 9 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_multiloc_reg,
    sum(case when new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 2743 or x_eid = 300)) then 1 end) as btc_new_map_or_s,
    sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_not_actual_calendar,
    sum(case when item_flags & 16384 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_part_qual_compab,
    sum(case when item_flags & 8192 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_part_qual_exists,
    sum(case when item_flags & 32768 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_part_qual_unknown,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and item_vas_flags & 65536 > 0 then 1 end) as btc_perfvas_x10_1,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and item_vas_flags & 131072 > 0 then 1 end) as btc_perfvas_x10_7,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and item_vas_flags & 4096 > 0 then 1 end) as btc_perfvas_x2_1,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and item_vas_flags & 8192 > 0 then 1 end) as btc_perfvas_x2_7,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and item_vas_flags & 16384 > 0 then 1 end) as btc_perfvas_x5_1,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and item_vas_flags & 32768 > 0 then 1 end) as btc_perfvas_x5_7,
    sum(case when item_flags & 1 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_pro_image,
    sum(case when search_flags & 17179869184 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_s_multiloc,
    sum(case when item_flags & 16777216 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_str_flat_verified_badge,
    sum(case when item_flags & 32 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_str_online_booking_items,
    sum(case when item_flags & 8388608 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_to_order,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813, 5629) then 1 end) as btc_videocalls,
    sum(case when x_from_page in ('witcher-extra-delivery', 'witcher-extra-regions', 'witcher-marketplace', 'witcher-new-auto', 'witcher-new-flats') and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_any,
    sum(case when x_from_page = 'witcher-extra-delivery' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_delivery,
    sum(case when x_from_page = 'witcher-new-auto' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_new_auto,
    sum(case when x_from_page = 'witcher-new-flats' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_new_flats,
    sum(case when x_from_page = 'witcher-extra-regions' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_regions,
    sum(case when item_flags & 33554432 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_with_multilocs,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and item_vas_flags & 64 > 0 then 1 end) as btc_xl,
    sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743)) then 1 end) as buyer_target_clicks_metageo,
    sum(case when item_flags & 2 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_actual_calendar,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and SFAccount_Type = 'Девелопер' then 1 end) as c_developer,
    sum(case when SFAccount_Type = 'Девелопер' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_developer_search,
    sum(case when item_flags & 16 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_leadgen_item,
    sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 2743 or x_eid = 300)) then 1 end) as c_map_or_s,
    sum(case when item_flags & 32 > 0 and eid in (856, 857, 4066) then 1 end) as c_msg_str_online_booking_items,
    sum(case when item_serp_flags & 32768 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_multiloc,
    sum(case when item_serp_flags & 32768 > 0 and search_query_type = 9 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_multiloc_reg,
    sum(case when item_serp_flags & 32768 > 0 and x_vertical_id is not null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_multiloc_vertical_defined,
    sum(case when item_serp_flags & 32768 > 0 and x_vertical_id is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_multiloc_vertical_undefined,
    sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_not_actual_calendar,
    sum(case when item_flags & 1 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_pro_image,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and SFAccount_Type = 'Агентство Недвижимости' then 1 end) as c_re_agency,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and SFAccount_Type is null then 1 end) as c_re_private,
    sum(case when search_flags & 17179869184 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_s_multiloc,
    sum(case when x_eid = 300 and x_vertical_id is not null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_s_vertical_defined,
    sum(case when x_eid = 300 and x_vertical_id is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_s_vertical_undefined,
    sum(case when item_flags & 16777216 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_str_flat_verified_badge,
    sum(case when item_flags & 32 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_str_online_booking_items,
    sum(case when x_from_page in ('witcher-extra-delivery', 'witcher-extra-regions', 'witcher-marketplace', 'witcher-new-auto', 'witcher-new-flats') and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_any,
    sum(case when x_from_page = 'witcher-extra-delivery' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_delivery,
    sum(case when x_from_page = 'witcher-new-auto' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_new_auto,
    sum(case when x_from_page = 'witcher-new-flats' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_new_flats,
    sum(case when x_from_page = 'witcher-extra-regions' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_regions,
    sum(case when item_flags & 33554432 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_with_multilocs,
    sum(case when item_flags & 33554432 > 0 and x_vertical_id is not null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_with_multilocs_vertical_defined,
    sum(case when item_flags & 33554432 > 0 and x_vertical_id is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_with_multilocs_vertical_undefined,
    sum(case when location_level_id = 5 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as capital_city_level_searches,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (location_level_id = 4 or location_level_id in (5, 6))) then 1 end) as city_level_searches,
    sum(case when (page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) or eid in (301, 303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813)) then 1 end) as cnt_active,
    sum(1) as cnt_any_action,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as cnt_btc,
    sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_any_ext_block,
    sum(case when item_flags & 131072 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_cpa,
    sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2743 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_developer_from_map,
    sum(case when SFAccount_Type = 'Девелопер' and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_developer_rec,
    sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_developer_rec_i2i,
    sum(case when SFAccount_Type = 'Девелопер' and x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_developer_rec_u2i,
    sum(case when search_query_type = 10 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_dlv,
    sum(case when x_eid = 2743 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_from_map,
    sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_btc_from_map_s_area,
    sum(case when item_flags & 4194304 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as cnt_btc_in_stock,
    sum(case when x_eid = 4126 and from_page = 'assistant' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_job_ast,
    sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and new_user_btc = True then 1 end) as cnt_btc_new,
    sum(case when x_eid = 300 and new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_new_any_ext_block,
    sum(case when search_query_type = 10 and x_eid = 300 and new_user_btc = True and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_dlv,
    sum(case when x_eid = 2743 and new_user_btc = True and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_from_map,
    sum(case when new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_btc_new_from_map_s_area,
    sum(case when new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_new_rec,
    sum(case when new_user_btc = True and x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_rec_i2i,
    sum(case when new_user_btc = True and x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_rec_u2i,
    sum(case when new_user_btc = True and search_query_type = 9 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_reg,
    sum(case when new_user_btc = True and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_s_item_attr,
    sum(case when new_user_btc = True and search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_s_map_area,
    sum(case when x_eid is null and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_no,
    sum(case when x_eid = 300 and new_user_btc = False and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_old_any_ext_block,
    sum(case when new_user_btc = False and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_old_rec,
    sum(case when new_user_btc = False and x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_rec_i2i,
    sum(case when new_user_btc = False and x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_rec_u2i,
    sum(case when new_user_btc = False and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_s_item_attr,
    sum(case when item_flags & 16384 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as cnt_btc_part_qual_compab,
    sum(case when item_flags & 8192 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as cnt_btc_part_qual_exists,
    sum(case when item_flags & 32768 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as cnt_btc_part_qual_unknown,
    sum(case when search_query_type = 2 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_premium,
    sum(case when search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_push,
    sum(case when x_eid = 5354 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_push_land,
    sum(case when search_query_type = 15 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_qrm,
    sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec,
    sum(case when item_flags & 131072 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_cpa,
    sum(case when x_eid = 4386 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_cv2vac,
    sum(case when x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_i2i,
    sum(case when item_vas_flags & 65536 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x10_1,
    sum(case when item_vas_flags & 131072 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x10_7,
    sum(case when item_vas_flags & 4096 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x2_1,
    sum(case when item_vas_flags & 8192 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x2_7,
    sum(case when item_vas_flags & 16384 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x5_1,
    sum(case when item_vas_flags & 32768 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x5_7,
    sum(case when x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i,
    sum(case when x_eid in (2012, 2309) and item_engines & 1 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_collab,
    sum(case when x_eid in (2012, 2309) and item_engines & 16 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_graph,
    sum(case when x_eid in (2012, 2309) and item_engines & 8 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_similars,
    sum(case when x_eid in (2012, 2309) and item_engines & 2 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_user2vec,
    sum(case when item_vas_flags & 261231 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_vas,
    sum(case when search_query_type = 9 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_reg,
    sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 9 or search_query_type = 20)) then 1 end) as cnt_btc_reg_any,
    sum(case when search_query_type = 20 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_reg_mix,
    sum(case when x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s,
    sum(case when x_eid = 300 and item_flags & 131072 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_cpa,
    sum(case when search_flags & 2 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_distr,
    sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 8 > 0 or search_flags & 4 > 0)) then 1 end) as cnt_btc_s_distr_metro_radius_road,
    sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 4 > 0)) then 1 end) as cnt_btc_s_distr_metro_road,
    sum(case when x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_item_attr,
    sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_map_area,
    sum(case when search_flags & 1 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_metro,
    sum(case when q = '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_noquery,
    sum(case when q > '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_query,
    sum(case when search_flags & 8 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_radius,
    sum(case when search_flags & 4 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_road,
    sum(case when search_flags & 64 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_saved,
    sum(case when search_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_u2i,
    sum(case when search_flags & 16 = 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_wo_map_area,
    sum(case when item_serp_flags & 8192 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x10_1,
    sum(case when item_serp_flags & 16384 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x10_7,
    sum(case when item_serp_flags & 512 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x2_1,
    sum(case when item_serp_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x2_7,
    sum(case when item_serp_flags & 2048 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x5_1,
    sum(case when item_serp_flags & 4096 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x5_7,
    sum(case when item_serp_flags & 256 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_xl,
    sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_shopx,
    sum(case when item_flags & 8388608 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as cnt_btc_to_order,
    sum(case when item_serp_flags & 32527 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_vas,
    sum(case when search_query_type = 18 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_vec,
    sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as cnt_btc_views_s_filter_price,
    sum(case when search_query_type = 3 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_vip,
    sum(case when search_query_type = 12 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_dlv,
    sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 12 or search_query_type = 13 or search_query_type = 14 or search_query_type = 11)) then 1 end) as cnt_btc_wtc_dlv_new_auto_flats_reg,
    sum(case when search_query_type = 13 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_new_auto,
    sum(case when search_query_type = 14 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_new_flats,
    sum(case when search_query_type = 11 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_reg,
    sum(case when x_eid = 4126 and from_page = 'assistant' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_c_rec_job_ast,
    sum(case when location_level_id in (4, 5, 6) and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_cities_in_s,
    sum(case when eid = 2483 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_click_delivery_any_ext_block,
    sum(case when eid = 4675 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_contact_delivery_any_ext_block,
    sum(case when eid = 4675 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_contact_delivery_serp,
    sum(case when eid = 4675 then 1 end) as cnt_contacts_delivery,
    sum(case when eid = 4675 and x_eid = 400 then 1 end) as cnt_contacts_delivery_fav,
    sum(case when eid = 4675 and x_eid = 2437 then 1 end) as cnt_contacts_delivery_rec_i2i,
    sum(case when eid = 4675 and x_eid in (2012, 2309) then 1 end) as cnt_contacts_delivery_rec_u2i,
    sum(case when eid = 4675 and x_eid = 300 then 1 end) as cnt_contacts_delivery_serp,
    sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as cnt_contacts_s_filter_price,
    sum(case when eid = 2015 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_create_order_delivery_any_ext_block,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as cnt_cs,
    sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_cs_any_ext_block,
    sum(case when item_flags & 131072 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_cpa,
    sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_developer_from_map,
    sum(case when SFAccount_Type = 'Девелопер' and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_developer_rec,
    sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_developer_rec_i2i,
    sum(case when SFAccount_Type = 'Девелопер' and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_developer_rec_u2i,
    sum(case when search_query_type = 10 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_dlv,
    sum(case when x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_extended_profile,
    sum(case when x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_extended_profile_services,
    sum(case when x_eid = 400 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_fav_list,
    sum(case when x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_from_map,
    sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_cs_from_map_s_area,
    sum(case when eid in (856, 857, 4066) and x_eid = 400 then 1 end) as cnt_cs_msg_fav_list,
    sum(case when eid in (856, 857, 4066) and x_eid is null then 1 end) as cnt_cs_msg_no_item_attr,
    sum(case when eid in (856, 857, 4066) and x_eid = 4386 then 1 end) as cnt_cs_msg_rec_cv2vac,
    sum(case when eid in (856, 857, 4066) and x_eid = 2437 then 1 end) as cnt_cs_msg_rec_i2i,
    sum(case when eid in (856, 857, 4066) and x_eid in (2012, 2309) then 1 end) as cnt_cs_msg_rec_u2i,
    sum(case when eid in (856, 857, 4066) and x_eid = 300 then 1 end) as cnt_cs_msg_s_item_attr,
    sum(case when x_eid is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_no_item_attr,
    sum(case when x_eid = 300 and item_vas_flags & 258048 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then vas_power end) as cnt_cs_perfvas_w,
    sum(case when eid = 303 and x_eid = 400 then 1 end) as cnt_cs_ph_fav_list,
    sum(case when eid = 303 and x_eid is null then 1 end) as cnt_cs_ph_no_item_attr,
    sum(case when eid = 303 and x_eid = 4386 then 1 end) as cnt_cs_ph_rec_cv2vac,
    sum(case when eid = 303 and x_eid = 2437 then 1 end) as cnt_cs_ph_rec_i2i,
    sum(case when eid = 303 and x_eid in (2012, 2309) then 1 end) as cnt_cs_ph_rec_u2i,
    sum(case when eid = 303 and x_eid = 300 then 1 end) as cnt_cs_ph_s_item_attr,
    sum(case when search_query_type = 2 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_premium,
    sum(case when (x_eid = 2017 and from_page = 'public_profile' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) or x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) or x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0)) then 1 end) as cnt_cs_profile_shop,
    sum(case when x_eid = 2017 and from_page = 'public_profile' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_public_profile,
    sum(case when search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_push,
    sum(case when x_eid = 5354 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_push_land,
    sum(case when search_query_type = 15 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_qrm,
    sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec,
    sum(case when item_flags & 131072 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_cpa,
    sum(case when x_eid = 4386 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_cv2vac,
    sum(case when x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i,
    sum(case when item_vas_flags & 40 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_premium,
    sum(case when item_vas_flags & 4 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_push,
    sum(case when item_vas_flags & 261231 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_vas,
    sum(case when item_vas_flags & 1 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_vip,
    sum(case when item_vas_flags & 65536 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x10_1,
    sum(case when item_vas_flags & 131072 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x10_7,
    sum(case when item_vas_flags & 4096 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x2_1,
    sum(case when item_vas_flags & 8192 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x2_7,
    sum(case when item_vas_flags & 16384 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x5_1,
    sum(case when item_vas_flags & 32768 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x5_7,
    sum(case when item_vas_flags & 40 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_premium,
    sum(case when item_vas_flags & 4 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_push,
    sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and ((search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) or x_eid = 300)) then 1 end) as cnt_cs_rec_s,
    sum(case when x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i,
    sum(case when x_eid in (2012, 2309) and item_engines & 1 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_collab,
    sum(case when x_eid in (2012, 2309) and item_engines & 16 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_graph,
    sum(case when item_vas_flags & 40 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_premium,
    sum(case when item_vas_flags & 4 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_push,
    sum(case when x_eid in (2012, 2309) and item_engines & 8 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_similars,
    sum(case when x_eid in (2012, 2309) and item_engines & 2 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_user2vec,
    sum(case when item_vas_flags & 261231 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_vas,
    sum(case when item_vas_flags & 1 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_vip,
    sum(case when item_vas_flags & 261231 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_vas,
    sum(case when item_vas_flags & 1 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_vip,
    sum(case when search_query_type = 9 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_reg,
    sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 9 or search_query_type = 20)) then 1 end) as cnt_cs_reg_any,
    sum(case when search_query_type = 20 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_reg_mix,
    sum(case when x_eid = 300 and item_flags & 131072 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_cpa,
    sum(case when search_flags & 2 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_distr,
    sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 4 > 0)) then 1 end) as cnt_cs_s_distr_metro_road,
    sum(case when region_id in (697, 4181) and x_from_page = 'items_ungrouped' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_grouped_doubles,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and x_eid = 300 and item_flags & 4194304 > 0 then 1 end) as cnt_cs_s_in_stock,
    sum(case when x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_item_attr,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and x_eid = 300 and item_flags & 16384 > 0 then 1 end) as cnt_cs_s_item_part_qual_compab,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and x_eid = 300 and item_flags & 8192 > 0 then 1 end) as cnt_cs_s_item_part_qual_exists,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and x_eid = 300 and item_flags & 32768 > 0 then 1 end) as cnt_cs_s_item_part_qual_unknown,
    sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_map_area,
    sum(case when search_flags & 1 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_metro,
    sum(case when search_flags & 8 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_radius,
    sum(case when search_flags & 4 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_road,
    sum(case when search_flags & 64 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_saved,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and x_eid = 300 and item_flags & 8388608 > 0 then 1 end) as cnt_cs_s_to_order,
    sum(case when search_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_u2i,
    sum(case when search_flags & 16 = 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_wo_map_area,
    sum(case when item_serp_flags & 8192 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x10_1,
    sum(case when item_serp_flags & 16384 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x10_7,
    sum(case when item_serp_flags & 512 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x2_1,
    sum(case when item_serp_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x2_7,
    sum(case when item_serp_flags & 2048 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x5_1,
    sum(case when item_serp_flags & 4096 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x5_7,
    sum(case when item_serp_flags & 256 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_xl,
    sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_shopx,
    sum(case when item_serp_flags & 32527 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vas,
    sum(case when search_query_type = 18 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vec,
    sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and ((x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null)) or x_eid = 5516)) then 1 end) as cnt_cs_vertical_main,
    sum(case when x_rec_engine_id = 320590750001 and x_eid = 5516 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vertical_main_featured,
    sum(case when x_rec_engine_id = 320585250001 and x_eid = 5516 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vertical_main_rec,
    sum(case when search_query_type = 3 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vip,
    sum(case when search_query_type = 12 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_dlv,
    sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 12 or search_query_type = 13 or search_query_type = 14 or search_query_type = 11)) then 1 end) as cnt_cs_wtc_dlv_new_auto_flats_reg,
    sum(case when search_query_type = 13 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_new_auto,
    sum(case when search_query_type = 14 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_new_flats,
    sum(case when search_query_type = 11 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_reg,
    sum(case when other_flags & 1 > 0 and eid = 2483 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_click_serp,
    sum(case when eid = 2749 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_confirm_serp,
    sum(case when eid = 301 and item_x_type = 0 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_iv_serp,
    sum(case when eid = 2015 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_order_create_serp,
    sum(case when eid = 2013 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_widget_serp,
    sum(case when eid = 2013 then 1 end) as cnt_dlv_flow_beginings,
    sum(case when eid = 3456 then 1 end) as cnt_fatal_app_errors,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 10 and x_eid = 300 then 1 end) as cnt_fav_dlv,
    sum(case when eid in (401, 2574, 2732) and x_eid = 2743 then 1 end) as cnt_fav_from_map,
    sum(case when eid in (401, 2574, 2732) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as cnt_fav_from_map_s_area,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 400 then 1 end) as cnt_fav_list_iv,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 2 and x_eid = 300 then 1 end) as cnt_fav_premium,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_fav_push,
    sum(case when eid in (401, 2574, 2732) and x_eid = 5354 then 1 end) as cnt_fav_push_land,
    sum(case when eid in (401, 2574, 2732) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec,
    sum(case when eid in (401, 2574, 2732) and x_eid = 4386 then 1 end) as cnt_fav_rec_cv2vac,
    sum(case when eid in (401, 2574, 2732) and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 40 > 0 and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i_premium,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 4 > 0 and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i_push,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 261231 > 0 and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i_vas,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 1 > 0 and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i_vip,
    sum(case when eid in (401, 2574, 2732) and x_eid = 4126 and from_page = 'assistant' then 1 end) as cnt_fav_rec_job_ast,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 40 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec_premium,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 4 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec_push,
    sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i,
    sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 1 > 0 then 1 end) as cnt_fav_rec_u2i_collab,
    sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 16 > 0 then 1 end) as cnt_fav_rec_u2i_graph,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 40 > 0 and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i_premium,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 4 > 0 and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i_push,
    sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 8 > 0 then 1 end) as cnt_fav_rec_u2i_similars,
    sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 2 > 0 then 1 end) as cnt_fav_rec_u2i_user2vec,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 261231 > 0 and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i_vas,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 1 > 0 and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i_vip,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 261231 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec_vas,
    sum(case when eid in (401, 2574, 2732) and item_vas_flags & 1 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec_vip,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 9 and x_eid = 300 then 1 end) as cnt_fav_reg,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 and (search_query_type in (9, 20)) then 1 end) as cnt_fav_reg_any,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 20 and x_eid = 300 then 1 end) as cnt_fav_reg_mix,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 then 1 end) as cnt_fav_s,
    sum(case when eid in (401, 2574, 2732) and search_flags & 2 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_distr,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 and item_flags & 4194304 > 0 then 1 end) as cnt_fav_s_in_stock,
    sum(case when eid in (401, 2574, 2732) and search_flags & 16 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_map_area,
    sum(case when eid in (401, 2574, 2732) and search_flags & 1 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_metro,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 and item_flags & 16384 > 0 then 1 end) as cnt_fav_s_part_qual_compab,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 and item_flags & 8192 > 0 then 1 end) as cnt_fav_s_part_qual_exists,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 and item_flags & 32768 > 0 then 1 end) as cnt_fav_s_part_qual_unknown,
    sum(case when eid in (401, 2574, 2732) and search_flags & 8 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_radius,
    sum(case when eid in (401, 2574, 2732) and search_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_road,
    sum(case when eid in (401, 2574, 2732) and search_flags & 64 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_saved,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 and item_flags & 8388608 > 0 then 1 end) as cnt_fav_s_to_order,
    sum(case when eid in (401, 2574, 2732) and search_flags & 1024 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_u2i,
    sum(case when eid in (401, 2574, 2732) and search_flags & 16 = 0 and x_eid = 300 then 1 end) as cnt_fav_s_wo_map_area,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 and search_flags & 128 > 0 then 1 end) as cnt_fav_shopx,
    sum(case when eid in (401, 2574, 2732) and item_serp_flags & 32527 > 0 and x_eid = 300 then 1 end) as cnt_fav_vas,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 3 and x_eid = 300 then 1 end) as cnt_fav_vip,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 12 and x_eid = 300 then 1 end) as cnt_fav_wtc_dlv,
    sum(case when eid in (401, 2574, 2732) and x_eid = 300 and (search_query_type in (11, 12, 13, 14)) then 1 end) as cnt_fav_wtc_dlv_new_auto_flats_reg,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 13 and x_eid = 300 then 1 end) as cnt_fav_wtc_new_auto,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 14 and x_eid = 300 then 1 end) as cnt_fav_wtc_new_flats,
    sum(case when eid in (401, 2574, 2732) and search_query_type = 11 and x_eid = 300 then 1 end) as cnt_fav_wtc_reg,
    sum(favorites_net) as cnt_favorites_net,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_iv_any_ext_block,
    sum(case when eid = 301 and item_x_type = 0 and item_flags & 131072 > 0 then 1 end) as cnt_iv_cpa,
    sum(case when eid = 301 and item_x_type = 0 and item_flags & 65536 > 0 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_iv_delivery_any_ext_block,
    sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_developer_from_map,
    sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_developer_rec,
    sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_developer_rec_i2i,
    sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_developer_rec_u2i,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 10 and x_eid = 300 then 1 end) as cnt_iv_dlv,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' then 1 end) as cnt_iv_extended_profile,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' then 1 end) as cnt_iv_extended_profile_services,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_from_map,
    sum(case when eid = 301 and item_x_type = 0 and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as cnt_iv_from_map_s_area,
    sum(case when eid = 301 and item_x_type = 0 and x_from_page = 'items_ungrouped' and x_eid = 300 then 1 end) as cnt_iv_grouped,
    sum(case when eid = 301 and item_x_type = 0 and region_id in (697, 4181) and x_from_page = 'items_ungrouped' and x_eid = 300 then 1 end) as cnt_iv_grouped_doubles,
    sum(case when eid = 301 and item_x_type = 0 and x_eid is null then 1 end) as cnt_iv_no_item_attr,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 2 and x_eid = 300 then 1 end) as cnt_iv_premium,
    sum(case when (eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'public_profile' or eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' or eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 128 > 0) then 1 end) as cnt_iv_profile_shop,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'public_profile' then 1 end) as cnt_iv_public_profile,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_iv_push,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 5354 then 1 end) as cnt_iv_push_land,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 15 and x_eid = 300 then 1 end) as cnt_iv_qrm,
    sum(case when eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec,
    sum(case when eid = 301 and item_x_type = 0 and item_flags & 131072 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_cpa,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 4386 then 1 end) as cnt_iv_rec_cv2vac,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i,
    sum(case when item_vas_flags & 40 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_premium,
    sum(case when item_vas_flags & 4 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_push,
    sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_vas,
    sum(case when item_vas_flags & 1 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_vip,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 4126 and from_page = 'assistant' then 1 end) as cnt_iv_rec_job_ast,
    sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 65536 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x10_1,
    sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 131072 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x10_7,
    sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 4096 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x2_1,
    sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 8192 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x2_7,
    sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 16384 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x5_1,
    sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 32768 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x5_7,
    sum(case when item_vas_flags & 40 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_premium,
    sum(case when item_vas_flags & 4 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_push,
    sum(case when eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (300, 2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_s,
    sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i,
    sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 1 > 0 then 1 end) as cnt_iv_rec_u2i_collab,
    sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 16 > 0 then 1 end) as cnt_iv_rec_u2i_graph,
    sum(case when item_vas_flags & 40 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_premium,
    sum(case when item_vas_flags & 4 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_push,
    sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 8 > 0 then 1 end) as cnt_iv_rec_u2i_similars,
    sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 2 > 0 then 1 end) as cnt_iv_rec_u2i_user2vec,
    sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_vas,
    sum(case when item_vas_flags & 1 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_vip,
    sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_vas,
    sum(case when item_vas_flags & 1 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_vip,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 9 and x_eid = 300 then 1 end) as cnt_iv_reg,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (9, 20)) then 1 end) as cnt_iv_reg_any,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 20 and x_eid = 300 then 1 end) as cnt_iv_reg_mix,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and item_flags & 131072 > 0 then 1 end) as cnt_iv_s_cpa,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 2 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_distr,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_flags & 768 > 0) then 1 end) as cnt_iv_s_filter_price,
    sum(case when eid = 301 and x_eid = 300 and item_flags & 4194304 > 0 then 1 end) as cnt_iv_s_in_stock,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 then 1 end) as cnt_iv_s_item_attr,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_map_area,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 1 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_metro,
    sum(case when eid = 301 and x_eid = 300 and item_flags & 16384 > 0 then 1 end) as cnt_iv_s_part_qual_compab,
    sum(case when eid = 301 and x_eid = 300 and item_flags & 8192 > 0 then 1 end) as cnt_iv_s_part_qual_exists,
    sum(case when eid = 301 and x_eid = 300 and item_flags & 32768 > 0 then 1 end) as cnt_iv_s_part_qual_unknown,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 8 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_radius,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_road,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 64 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_saved,
    sum(case when eid = 301 and x_eid = 300 and item_flags & 8388608 > 0 then 1 end) as cnt_iv_s_to_order,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 1024 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_u2i,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 = 0 and x_eid = 300 then 1 end) as cnt_iv_s_wo_map_area,
    sum(case when eid = 301 and from_page = 'witcher-seen-items' then 1 end) as cnt_iv_seen,
    sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 8192 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x10_1,
    sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 16384 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x10_7,
    sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 512 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x2_1,
    sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 1024 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x2_7,
    sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 2048 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x5_1,
    sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 4096 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x5_7,
    sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 256 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_xl,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 128 > 0 then 1 end) as cnt_iv_shopx,
    sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 32527 > 0 and x_eid = 300 then 1 end) as cnt_iv_vas,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 18 and x_eid = 300 then 1 end) as cnt_iv_vec,
    sum(case when eid = 301 and (x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) or x_eid = 5516) then 1 end) as cnt_iv_vertical_main,
    sum(case when eid = 301 and x_rec_engine_id = 320590750001 and x_eid = 5516 then 1 end) as cnt_iv_vertical_main_featured,
    sum(case when eid = 301 and x_rec_engine_id = 320585250001 and x_eid = 5516 then 1 end) as cnt_iv_vertical_main_rec,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 3 and x_eid = 300 then 1 end) as cnt_iv_vip,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300 then 1 end) as cnt_iv_wtc_dlv,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (11, 12, 13, 14, 16)) then 1 end) as cnt_iv_wtc_dlv_new_auto_flats_reg,
    sum(case when (from_page = 'witcher-extra-delivery' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-new-auto' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-new-flats' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-extra-regions' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 16 and x_eid = 300) then 1 end) as cnt_iv_wtc_dlv_new_auto_flats_reg_s_from,
    sum(case when (from_page = 'witcher-extra-delivery' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300) then 1 end) as cnt_iv_wtc_dlv_s_from,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300 then 1 end) as cnt_iv_wtc_new_auto,
    sum(case when (from_page = 'witcher-new-auto' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300) then 1 end) as cnt_iv_wtc_new_auto_s_from,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300 then 1 end) as cnt_iv_wtc_new_flats,
    sum(case when (from_page = 'witcher-new-flats' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300) then 1 end) as cnt_iv_wtc_new_flats_s_from,
    sum(case when eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300 then 1 end) as cnt_iv_wtc_reg,
    sum(case when (from_page = 'witcher-extra-regions' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300) then 1 end) as cnt_iv_wtc_reg_s_from,
    sum(case when eid = 303 and (phone_view_source is null or phone_view_source in ('r', 's', 't', 'xs')) then 1 end) as cnt_ph_item_right_top_snippet_xlvas,
    sum(case when eid in (303, 3005, 3461, 3461, 4600) then 1 end) as cnt_ph_realty_development,
    sum(case when location_level_id in (2, 3) and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_reg_in_s,
    sum(case when search_sort in (1, 2) and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_btc_date_sort,
    sum(case when search_sort = 5 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_btc_default_sort,
    sum(case when search_sort in (3, 4) and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_btc_price_sort,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_flags & 7 > 0) then 1 end) as cnt_s_distr_with_iv_metro_road,
    sum(case when eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 4096 > 0 or search_flags & 2048 > 0 or search_flags & 4194304 > 0 or search_flags & 262144 > 0 or search_flags & 524288 > 0)) then 1 end) as cnt_s_extra_any_ext_block,
    sum(case when eid = 301 and item_x_type = 0 and search_sort in (1, 2) and x_eid = 300 then 1 end) as cnt_s_iv_date_sort,
    sum(case when eid = 301 and item_x_type = 0 and search_sort = 5 and x_eid = 300 then 1 end) as cnt_s_iv_default_sort,
    sum(case when eid = 301 and item_x_type = 0 and search_sort in (3, 4) and x_eid = 300 then 1 end) as cnt_s_iv_price_sort,
    sum(case when q = '' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_noquery_c,
    sum(case when eid = 301 and item_x_type = 0 and q = '' and x_eid = 300 then 1 end) as cnt_s_noquery_iv,
    sum(case when q > '' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_query_c,
    sum(case when eid = 301 and item_x_type = 0 and q > '' and x_eid = 300 then 1 end) as cnt_s_query_iv,
    sum(case when x_eid = 300 and search_flags & 1024 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_u2i_btc,
    sum(case when x_eid = 300 and search_flags & 1024 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_u2i_c,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 1024 > 0 then 1 end) as cnt_s_u2i_iv,
    sum(case when eid = 300 and q = '' and (onmap = 0 or platform_id != 1) then 1 end) as cnt_s_without_query,
    sum(case when page_no = 0 and eid = 300 and search_flags & 16384 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_s_wtc_dlv,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 16384 > 0 or search_flags & 32768 > 0 or search_flags & 65536 > 0 or search_flags & 8192 > 0)) then 1 end) as cnt_s_wtc_dlv_new_auto_flats_reg,
    sum(case when eid = 308 then 1 end) as cnt_soc_btn,
    sum(case when eid = 301 and logical_category_id = 24144500001 then 1 end) as cnt_used_cars_views,
    sum(case when item_flags & 64 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_imv_re_good,
    sum(case when item_flags & 256 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_imv_re_high,
    sum(case when item_flags & 128 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_imv_re_low,
    sum(case when item_flags & 512 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_imv_re_no_label,
    sum(case when item_flags & 4194304 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_in_stock,
    sum(case when item_flags & 16384 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_part_qual_compab,
    sum(case when item_flags & 8192 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_part_qual_exists,
    sum(case when item_flags & 32768 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_part_qual_unknown,
    sum(case when item_flags & 8388608 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_to_order,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contacts,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and search_flags & 2097152 > 0 then 1 end) as contacts_from_suggest,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_flags & 2048 > 0 then 1 end) as contacts_item_pessimized,
    sum(case when x_eid = 2743 and item_flags & 2048 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_item_pessimized_map,
    sum(case when search_flags & 16 > 0 and x_eid = 300 and item_flags & 2048 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_item_pessimized_map_serp,
    sum(case when item_flags & 2048 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as contacts_item_pessimized_map_total,
    sum(case when item_flags & 2048 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as contacts_item_pessimized_rec,
    sum(case when x_eid = 300 and item_flags & 2048 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_item_pessimized_serp,
    sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743)) then 1 end) as contacts_metageo,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_vas_flags & 65536 > 0 then 1 end) as contacts_perfvas_x10_1,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_vas_flags & 131072 > 0 then 1 end) as contacts_perfvas_x10_7,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_vas_flags & 4096 > 0 then 1 end) as contacts_perfvas_x2_1,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_vas_flags & 8192 > 0 then 1 end) as contacts_perfvas_x2_7,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_vas_flags & 16384 > 0 then 1 end) as contacts_perfvas_x5_1,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_vas_flags & 32768 > 0 then 1 end) as contacts_perfvas_x5_7,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and (item_flags & 6144 > 0) then 1 end) as contacts_pessimized,
    sum(case when x_eid = 2743 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_map,
    sum(case when search_flags & 16 > 0 and x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_map_serp,
    sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_map_total,
    sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_rec,
    sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_serp,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_flags & 4096 > 0 then 1 end) as contacts_seller_pessimized,
    sum(case when x_eid = 2743 and item_flags & 4096 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_seller_pessimized_map,
    sum(case when search_flags & 16 > 0 and x_eid = 300 and item_flags & 4096 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_seller_pessimized_map_serp,
    sum(case when item_flags & 4096 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as contacts_seller_pessimized_map_total,
    sum(case when item_flags & 4096 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as contacts_seller_pessimized_rec,
    sum(case when x_eid = 300 and item_flags & 4096 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_seller_pessimized_serp,
    sum(case when item_vas_flags & 261231 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contacts_total_vas,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813, 5629) then 1 end) as contacts_videocalls,
    sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_vas_flags & 64 > 0 then 1 end) as contacts_xl,
    sum(case when page_no = 0 and search_flags & 1073741824 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as default_radius_searches,
    sum(case when eid = 2015 then 1 end) as delivery_orders_created,
    sum(case when item_flags & 65536 > 0 and eid = 301 then 1 end) as delivery_total_item_view,
    sum(case when SFAccount_Type = 'Девелопер' and eid in (401, 2574, 2732) then 1 end) as fav_added_developer,
    sum(case when eid in (401, 2574, 2732) and (x_eid in (300, 2743)) then 1 end) as fav_map_or_s,
    sum(case when item_serp_flags & 32768 > 0 and eid in (401, 2574, 2732) then 1 end) as fav_multiloc,
    sum(case when item_serp_flags & 32768 > 0 and search_query_type = 9 and eid in (401, 2574, 2732) then 1 end) as fav_multiloc_reg,
    sum(case when search_flags & 17179869184 > 0 and eid in (401, 2574, 2732) then 1 end) as fav_s_multiloc,
    sum(case when x_from_page in ('witcher-extra-delivery', 'witcher-extra-regions', 'witcher-marketplace', 'witcher-new-auto', 'witcher-new-flats') and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_any,
    sum(case when x_from_page = 'witcher-extra-delivery' and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_delivery,
    sum(case when x_from_page = 'witcher-new-auto' and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_new_auto,
    sum(case when x_from_page = 'witcher-new-flats' and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_new_flats,
    sum(case when x_from_page = 'witcher-extra-regions' and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_regions,
    sum(case when item_flags & 33554432 > 0 and eid in (401, 2574, 2732) then 1 end) as fav_with_multilocs,
    sum(case when eid in (401, 2574, 2732) then 1 end) as favorites_added,
    sum(case when eid in (401, 2574, 2732) and from_page = 'catalog_jk_card' then 1 end) as favorites_added_from_jk_card,
    sum(case when item_flags & 4194304 > 0 and eid in (401, 2574, 2732) then 1 end) as favorites_added_in_stock,
    sum(case when item_flags & 16384 > 0 and eid in (401, 2574, 2732) then 1 end) as favorites_added_part_qual_compab,
    sum(case when item_flags & 8192 > 0 and eid in (401, 2574, 2732) then 1 end) as favorites_added_part_qual_exists,
    sum(case when item_flags & 32768 > 0 and eid in (401, 2574, 2732) then 1 end) as favorites_added_part_qual_unknown,
    sum(case when item_flags & 8388608 > 0 and eid in (401, 2574, 2732) then 1 end) as favorites_added_to_order,
    sum(case when eid = 400 then 1 end) as favorites_list_views,
    sum(case when eid = 402 then 1 end) as favorites_removed,
    sum(case when location_level_id = 4 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as federal_city_level_searches,
    sum(case when eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as filters_pr_rubr_searches,
    sum(case when eid = 300 and search_flags & 512 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as filters_price_searches,
    sum(case when eid = 300 and search_flags & 256 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as filters_rubricator_searches,
    sum(case when eid in (856, 857, 4066) then 1 end) as first_messages,
    sum(case when item_flags & 4194304 > 0 and eid in (856, 857, 4066) then 1 end) as first_messages_in_stock,
    sum(case when item_flags & 16384 > 0 and eid in (856, 857, 4066) then 1 end) as first_messages_part_qual_compab,
    sum(case when item_flags & 8192 > 0 and eid in (856, 857, 4066) then 1 end) as first_messages_part_qual_exists,
    sum(case when item_flags & 32768 > 0 and eid in (856, 857, 4066) then 1 end) as first_messages_part_qual_unknown,
    sum(case when item_flags & 8388608 > 0 and eid in (856, 857, 4066) then 1 end) as first_messages_to_order,
    sum(case when item_vas_flags & 261231 > 0 and eid in (856, 857, 4066) then 1 end) as first_messages_vas,
    sum(case when eid = 2572 then 1 end) as head_main_pages,
    sum(case when eid = 301 then 1 end) as item_views,
    sum(case when eid = 2649 then 1 end) as item_views_client,
    sum(case when eid = 2649 and x_from_page = 'msg_recommendations' then 1 end) as item_views_client_rec_from_msg,
    sum(case when eid = 301 and from_page = 'fs' then 1 end) as item_views_from_fs,
    sum(case when eid = 301 and from_page = 'catalog_jk_card' then 1 end) as item_views_from_jk_card,
    sum(case when eid = 301 and search_flags & 2097152 > 0 then 1 end) as item_views_from_suggest,
    sum(case when item_flags & 4194304 > 0 and eid = 301 then 1 end) as item_views_in_stock,
    sum(case when item_flags & 2048 > 0 and eid = 301 then 1 end) as item_views_item_pessimized,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 and item_flags & 2048 > 0 then 1 end) as item_views_item_pessimized_map,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 and item_flags & 2048 > 0 then 1 end) as item_views_item_pessimized_map_serp,
    sum(case when eid = 301 and item_x_type = 0 and item_flags & 2048 > 0 and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as item_views_item_pessimized_map_total,
    sum(case when eid = 301 and item_x_type = 0 and item_flags & 2048 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as item_views_item_pessimized_rec,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and item_flags & 2048 > 0 then 1 end) as item_views_item_pessimized_serp,
    sum(case when eid = 301 and item_x_type = 0 and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743) then 1 end) as item_views_metageo,
    sum(case when item_flags & 16384 > 0 and eid = 301 then 1 end) as item_views_part_qual_compab,
    sum(case when item_flags & 8192 > 0 and eid = 301 then 1 end) as item_views_part_qual_exists,
    sum(case when item_flags & 32768 > 0 and eid = 301 then 1 end) as item_views_part_qual_unknown,
    sum(case when eid = 301 and item_vas_flags & 65536 > 0 then 1 end) as item_views_perfvas_x10_1,
    sum(case when eid = 301 and item_vas_flags & 131072 > 0 then 1 end) as item_views_perfvas_x10_7,
    sum(case when eid = 301 and item_vas_flags & 4096 > 0 then 1 end) as item_views_perfvas_x2_1,
    sum(case when eid = 301 and item_vas_flags & 8192 > 0 then 1 end) as item_views_perfvas_x2_7,
    sum(case when eid = 301 and item_vas_flags & 16384 > 0 then 1 end) as item_views_perfvas_x5_1,
    sum(case when eid = 301 and item_vas_flags & 32768 > 0 then 1 end) as item_views_perfvas_x5_7,
    sum(case when eid = 301 and (item_flags & 6144 > 0) then 1 end) as item_views_pessimized,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 and (item_flags & 6144 > 0) then 1 end) as item_views_pessimized_map,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 and (item_flags & 6144 > 0) then 1 end) as item_views_pessimized_map_serp,
    sum(case when eid = 301 and item_x_type = 0 and ((search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as item_views_pessimized_map_total,
    sum(case when eid = 301 and item_x_type = 0 and ((search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as item_views_pessimized_rec,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (item_flags & 6144 > 0) then 1 end) as item_views_pessimized_serp,
    sum(case when item_flags & 4096 > 0 and eid = 301 then 1 end) as item_views_seller_pessimized,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 and item_flags & 4096 > 0 then 1 end) as item_views_seller_pessimized_map,
    sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 and item_flags & 4096 > 0 then 1 end) as item_views_seller_pessimized_map_serp,
    sum(case when eid = 301 and item_x_type = 0 and item_flags & 4096 > 0 and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as item_views_seller_pessimized_map_total,
    sum(case when eid = 301 and item_x_type = 0 and item_flags & 4096 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as item_views_seller_pessimized_rec,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and item_flags & 4096 > 0 then 1 end) as item_views_seller_pessimized_serp,
    sum(case when item_flags & 8388608 > 0 and eid = 301 then 1 end) as item_views_to_order,
    sum(case when item_vas_flags & 40 > 0 and eid = 301 then 1 end) as item_views_total_premium,
    sum(case when item_vas_flags & 4 > 0 and eid = 301 then 1 end) as item_views_total_push,
    sum(case when item_vas_flags & 261231 > 0 and eid = 301 then 1 end) as item_views_total_vas,
    sum(case when item_vas_flags & 1 > 0 and eid = 301 then 1 end) as item_views_total_vip,
    sum(case when item_flags & 8 = 0 and eid = 301 then 1 end) as item_views_with_available_msg,
    sum(case when eid = 301 and item_vas_flags & 64 > 0 then 1 end) as item_views_xl,
    sum(case when item_flags & 2 > 0 and eid = 301 then 1 end) as iv_actual_calendar,
    sum(case when SFAccount_Type = 'Девелопер' and eid = 301 then 1 end) as iv_developer,
    sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid = 300 then 1 end) as iv_developer_search,
    sum(case when item_flags & 64 > 0 and eid = 301 then 1 end) as iv_imv_re_good,
    sum(case when item_flags & 256 > 0 and eid = 301 then 1 end) as iv_imv_re_high,
    sum(case when item_flags & 128 > 0 and eid = 301 then 1 end) as iv_imv_re_low,
    sum(case when item_flags & 512 > 0 and eid = 301 then 1 end) as iv_imv_re_no_label,
    sum(case when item_flags & 16 > 0 and eid = 301 then 1 end) as iv_leadgen_item,
    sum(case when eid = 301 and item_x_type = 0 and (x_eid in (300, 2743)) then 1 end) as iv_map_or_s,
    sum(case when item_serp_flags & 32768 > 0 and eid = 301 and item_x_type = 0 then 1 end) as iv_multiloc,
    sum(case when item_serp_flags & 32768 > 0 and search_query_type = 9 and eid = 301 and item_x_type = 0 then 1 end) as iv_multiloc_reg,
    sum(case when item_serp_flags & 32768 > 0 and eid = 301 and item_x_type = 0 and x_vertical_id is not null then 1 end) as iv_multiloc_vertical_defined,
    sum(case when item_serp_flags & 32768 > 0 and eid = 301 and item_x_type = 0 and x_vertical_id is null then 1 end) as iv_multiloc_vertical_undefined,
    sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid = 301 then 1 end) as iv_not_actual_calendar,
    sum(case when item_flags & 1 > 0 and eid = 301 then 1 end) as iv_pro_image,
    sum(case when SFAccount_Type = 'Агентство Недвижимости' and eid = 301 then 1 end) as iv_re_agency,
    sum(case when SFAccount_Type is null and eid = 301 then 1 end) as iv_re_private,
    sum(case when search_flags & 17179869184 > 0 and eid = 301 and item_x_type = 0 then 1 end) as iv_s_multiloc,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and x_vertical_id is not null then 1 end) as iv_s_vertical_defined,
    sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and x_vertical_id is null then 1 end) as iv_s_vertical_undefined,
    sum(case when item_flags & 16777216 > 0 and eid = 301 then 1 end) as iv_str_flat_verified_badge,
    sum(case when item_flags & 32 > 0 and eid = 301 then 1 end) as iv_str_online_booking_items,
    sum(case when x_from_page in ('witcher-extra-delivery', 'witcher-extra-regions', 'witcher-marketplace', 'witcher-new-auto', 'witcher-new-flats') and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_any,
    sum(case when x_from_page = 'witcher-extra-delivery' and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_delivery,
    sum(case when x_from_page = 'witcher-new-auto' and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_new_auto,
    sum(case when x_from_page = 'witcher-new-flats' and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_new_flats,
    sum(case when x_from_page = 'witcher-extra-regions' and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_regions,
    sum(case when item_flags & 33554432 > 0 and eid = 301 and item_x_type = 0 then 1 end) as iv_with_multilocs,
    sum(case when item_flags & 33554432 > 0 and eid = 301 and item_x_type = 0 and x_vertical_id is not null then 1 end) as iv_with_multilocs_vertical_defined,
    sum(case when item_flags & 33554432 > 0 and eid = 301 and item_x_type = 0 and x_vertical_id is null then 1 end) as iv_with_multilocs_vertical_undefined,
    sum(case when eid = 4126 and from_page = 'assistant' then 1 end) as job_ast_shows,
    sum(case when location_level_id = 2 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as meta_regions_level_searches,
    sum(case when location_level_id = 6 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as noncapital_city_level_searches,
    sum(case when page_no = 0 and eid = 300 and ((search_flags & 1073741824 = 0 or search_radius is not null) and (onmap = 0 or platform_id != 1)) then 1 end) as not_default_radius_searches,
    sum(case when eid in (2216, 2650) then 1 end) as phone_view_button_clicks,
    sum(case when eid = 303 and (phone_view_source is null or phone_view_source in ('r', 't')) then 1 end) as phone_views,
    sum(case when eid = 3005 then 1 end) as phone_views_in_chat,
    sum(case when item_flags & 4194304 > 0 and eid = 303 and (phone_view_source is null or phone_view_source in ('r', 't')) then 1 end) as phone_views_in_stock,
    sum(case when item_flags & 16384 > 0 and eid = 303 and (phone_view_source is null or phone_view_source in ('r', 't')) then 1 end) as phone_views_part_qual_compab,
    sum(case when item_flags & 8192 > 0 and eid = 303 and (phone_view_source is null or phone_view_source in ('r', 't')) then 1 end) as phone_views_part_qual_exists,
    sum(case when item_flags & 32768 > 0 and eid = 303 and (phone_view_source is null or phone_view_source in ('r', 't')) then 1 end) as phone_views_part_qual_unknown,
    sum(case when eid = 303 and (phone_view_source in ('s', 'xs')) then 1 end) as phone_views_snippet,
    sum(case when item_flags & 8388608 > 0 and eid = 303 and (phone_view_source is null or phone_view_source in ('r', 't')) then 1 end) as phone_views_to_order,
    sum(case when eid in (303, 3005, 3461) then 1 end) as phone_views_total,
    sum(case when item_vas_flags & 40 > 0 and eid in (303, 3005, 3461) then 1 end) as phone_views_total_premium,
    sum(case when item_vas_flags & 4 > 0 and eid in (303, 3005, 3461) then 1 end) as phone_views_total_push,
    sum(case when item_vas_flags & 261231 > 0 and eid in (303, 3005, 3461) then 1 end) as phone_views_total_vas,
    sum(case when item_vas_flags & 1 > 0 and eid in (303, 3005, 3461) then 1 end) as phone_views_total_vip,
    sum(case when eid = 5354 then 1 end) as push_land_shows,
    sum(case when search_radius = '0' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_0_searches,
    sum(case when search_radius = '1000' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_1000_searches,
    sum(case when search_radius = '100' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_100_searches,
    sum(case when search_radius = '10' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_10_searches,
    sum(case when search_radius = '150' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_150_searches,
    sum(case when search_radius = '15' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_15_searches,
    sum(case when search_radius = '1' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_1_searches,
    sum(case when search_radius = '2000' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_2000_searches,
    sum(case when search_radius = '200' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_200_searches,
    sum(case when search_radius = '25' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_25_searches,
    sum(case when search_radius = '3000' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_3000_searches,
    sum(case when search_radius = '300' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_300_searches,
    sum(case when search_radius = '3' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_3_searches,
    sum(case when search_radius = '400' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_400_searches,
    sum(case when search_radius = '500' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_500_searches,
    sum(case when search_radius = '50' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_50_searches,
    sum(case when search_radius = '5' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_5_searches,
    sum(case when search_radius = '75' and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as radius_75_searches,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_radius = '100' or search_radius = '1000' or search_radius = '200' or search_radius = '300' or search_radius = '400' or search_radius = '500' or search_radius = '2000' or search_radius = '3000')) then 1 end) as radius_big_searches,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_radius = '1' or search_radius = '10' or search_radius = '100' or search_radius = '25' or search_radius = '5' or search_radius = '50' or search_radius = '3' or search_radius = '15' or search_radius = '150')) then 1 end) as radius_short_searches,
    sum(case when eid = 2592 and microcat_id = 2605 then 1 end) as re_main_pages,
    sum(case when eid in (3461, 4600) then 1 end) as realty_dev_phone_views,
    sum(case when eid = 3459 then 1 end) as realty_dev_views,
    sum(case when eid = 3459 and from_page = 'catalog_jk_serp' then 1 end) as realty_dev_views_cat_jk_serp,
    sum(case when eid = 3459 and from_page in ('item_jk_button', 'item_jk_name') then 1 end) as realty_dev_views_item,
    sum(case when eid = 3459 and from_page = 'item_jk_button' then 1 end) as realty_dev_views_item_button,
    sum(case when eid = 3459 and from_page = 'item_jk_name' then 1 end) as realty_dev_views_item_name,
    sum(case when eid = 3459 and from_page = 'map' then 1 end) as realty_dev_views_map,
    sum(case when eid = 3459 and from_page = 'jk_card_rec' then 1 end) as realty_dev_views_rec,
    sum(case when eid = 3461 then 1 end) as realty_development_phone_views,
    sum(case when (eid in (2012, 2309, 2437, 4126, 4386) or search_flags & 1024 > 0) then 1 end) as recblock_shows,
    sum(case when eid = 4386 then 1 end) as recblock_shows_cv2vac,
    sum(case when eid = 2437 then 1 end) as recblock_shows_i2i,
    sum(case when eid in (2012, 2309) then 1 end) as recblock_shows_u2i,
    sum(case when location_level_id = 3 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as regions_level_searches,
    sum(case when location_level_id = 1 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as russia_level_searches,
    sum(case when eid = 300 and search_flags & 8589934592 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as s_localpriority,
    sum(case when (eid = 300 and page_no = 0 and (onmap = 0 or platform_id != 1) or eid = 2743) then 1 end) as s_map_or_s,
    sum(case when eid = 300 and search_flags & 17179869184 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as s_multiloc,
    sum(case when page_no = 0 and search_flags & 64 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as saved_searches,
    sum(case when eid = 2071 then 1 end) as saved_searches_added,
    sum(case when eid = 300 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as search_q,
    sum(case when eid = 300 and search_flags & 1024 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as search_u2i,
    sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches,
    sum(case when eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 4096 > 0 or search_flags & 2048 > 0 or search_flags & 4194304 > 0 or search_flags & 262144 > 0 or search_flags & 524288 > 0)) then 1 end) as searches_any_ext_block,
    sum(case when page_no = 0 and search_sort in (1, 2) and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_date_sort,
    sum(case when page_no = 0 and search_sort = 5 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_default_sort,
    sum(case when page_no = 0 and search_flags & 2 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_district,
    sum(case when eid = 300 and search_flags & 4096 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_delivery,
    sum(case when eid = 300 and search_flags & 262144 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_quorum,
    sum(case when eid = 300 and search_flags & 2048 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_regions,
    sum(case when eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 4194304 > 0 or search_flags & 2048 > 0)) then 1 end) as searches_extra_regions_any,
    sum(case when eid = 300 and search_flags & 4194304 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_regions_mix,
    sum(case when eid = 300 and search_flags & 524288 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_vector,
    sum(case when page_no = 0 and eid = 300 and search_flags & 2097152 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_suggest,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (from_page = 'witcher-extra-delivery' or from_page = 'witcher-new-auto' or from_page = 'witcher-new-flats' or from_page = 'witcher-extra-regions')) then 1 end) as searches_from_witcher_any,
    sum(case when page_no = 0 and from_page = 'witcher-extra-delivery' and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_witcher_delivery,
    sum(case when page_no = 0 and from_page = 'witcher-new-auto' and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_witcher_new_auto,
    sum(case when page_no = 0 and from_page = 'witcher-new-flats' and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_witcher_new_flats,
    sum(case when page_no = 0 and from_page = 'witcher-extra-regions' and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_witcher_regions,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 8 > 0 or search_flags & 4 > 0)) then 1 end) as searches_geo,
    sum(case when eid = 300 and x_from_page = 'items_ungrouped' and (onmap = 0 or platform_id != 1) then 1 end) as searches_group,
    sum(case when region_id in (697, 4181) and eid = 300 and x_from_page = 'items_ungrouped' and (onmap = 0 or platform_id != 1) then 1 end) as searches_group_doubles,
    sum(case when item_flags & 4194304 > 0 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_in_stock,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 4 > 0)) then 1 end) as searches_local_geo,
    sum(case when page_no = 0 and search_flags & 16 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_map_area,
    sum(case when (eid = 300 and page_no = 0 and search_flags & 4196383 > 0 and (onmap = 0 or platform_id != 1) or eid = 2743) then 1 end) as searches_metageo,
    sum(case when page_no = 0 and search_flags & 1 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_metro,
    sum(case when item_flags & 16384 > 0 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_part_qual_compab,
    sum(case when item_flags & 8192 > 0 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_part_qual_exists,
    sum(case when item_flags & 32768 > 0 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_part_qual_unknown,
    sum(case when page_no = 0 and search_sort in (3, 4) and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_price_sort,
    sum(case when page_no = 0 and search_flags & 8 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_radius,
    sum(case when page_no = 0 and search_flags & 4 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_road,
    sum(case when eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_serp,
    sum(case when eid = 300 and search_flags & 4096 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_serp_extra_delivery,
    sum(case when eid = 300 and search_flags & 262144 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_serp_extra_quorum,
    sum(case when eid = 300 and search_flags & 2048 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_serp_extra_regions,
    sum(case when eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 2048 > 0 or search_flags & 4194304 > 0)) then 1 end) as searches_serp_extra_regions_any,
    sum(case when eid = 300 and search_flags & 4194304 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_serp_extra_regions_mix,
    sum(case when eid = 300 and search_flags & 524288 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_serp_extra_vector,
    sum(case when page_no = 0 and eid = 300 and search_flags & 128 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_shop,
    sum(case when page_no = 0 and eid = 300 and item_count = 0 and search_flags & 128 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_shop_empty,
    sum(case when page_no = 0 and eid = 300 and item_count >= 1 and item_count <= 9 and search_flags & 128 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_shop_small,
    sum(case when item_flags & 8388608 > 0 and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_to_order,
    sum(case when eid = 300 and search_flags & 32768 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_witcher_new_auto,
    sum(case when eid = 300 and search_flags & 65536 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_witcher_new_flats,
    sum(case when eid = 300 and search_flags & 8192 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_witcher_regions,
    sum(case when page_no = 0 and eid = 300 and search_flags & 256 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_with_filter,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as searches_with_filter_any,
    sum(case when page_no = 0 and eid = 300 and search_flags & 512 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_with_price_filter,
    sum(case when page_no = 0 and eid = 300 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as searches_with_query,
    sum(case when page_no = 0 and search_sort in (1, 2) and eid = 300 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as searches_with_query_date_sort,
    sum(case when page_no = 0 and eid = 300 and q = '' and (onmap = 0 or platform_id != 1) then 1 end) as searches_without_query,
    sum(case when page_no = 0 and eid = 300 and item_count = 0 and (onmap = 0 or platform_id != 1) then 1 end) as serp_empty,
    sum(case when page_no = 0 and eid = 300 and item_count >= 1 and item_count <= 9 and (onmap = 0 or platform_id != 1) then 1 end) as serp_small,
    sum(case when page_no = 0 and eid = 300 and item_count = 0 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as serp_with_query_empty,
    sum(case when page_no = 0 and eid = 300 and item_count >= 1 and item_count <= 9 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as serp_with_query_small,
    sum(case when page_no = 0 and eid = 300 and item_count = 0 and q = '' and (onmap = 0 or platform_id != 1) then 1 end) as serp_without_query_empty,
    sum(case when page_no = 0 and eid = 300 and item_count >= 1 and item_count <= 9 and q = '' and (onmap = 0 or platform_id != 1) then 1 end) as serp_without_query_small,
    sum(case when eid = 2592 and microcat_id in (1741, 1748) then 1 end) as services_main_pages,
    sum(case when eid = 2664 then 1 end) as shortcut_clicks,
    sum(case when (eid in (4033, 4035) or other_flags & 4 > 0 and eid = 2483) then 1 end) as total_courier_btc,
    sum(case when other_flags & 4 > 0 and eid = 2483 then 1 end) as total_courier_click,
    sum(case when eid = 4035 then 1 end) as total_courier_contact,
    sum(case when eid = 4033 then 1 end) as total_courier_widget,
    sum(case when (eid in (2013, 2015, 2749) or other_flags & 1 > 0 and eid = 2483) then 1 end) as total_delivery_btc,
    sum(case when other_flags & 1 > 0 and item_flags & 4 = 0 and eid = 2483 then 1 end) as total_delivery_click,
    sum(case when eid = 2483 then 1 end) as total_delivery_click_all_services,
    sum(case when x_eid = 400 and eid = 2483 then 1 end) as total_delivery_click_all_services_fav,
    sum(case when x_eid = 2437 and eid = 2483 then 1 end) as total_delivery_click_all_services_rec_i2i,
    sum(case when x_eid in (2012, 2309) and eid = 2483 then 1 end) as total_delivery_click_all_services_rec_u2i,
    sum(case when x_eid = 300 and eid = 2483 then 1 end) as total_delivery_click_all_services_serp,
    sum(case when other_flags & 1 > 0 and item_flags & 4 = 0 and eid = 2483 then 1 end) as total_delivery_click_wo_messenger,
    sum(case when item_flags & 4 = 0 and eid = 2749 then 1 end) as total_delivery_confirm,
    sum(case when item_flags & 4 = 0 and eid = 2015 then 1 end) as total_delivery_contact,
    sum(case when eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services,
    sum(case when x_eid = 400 and eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services_fav,
    sum(case when x_eid = 2437 and eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services_rec_i2i,
    sum(case when x_eid in (2012, 2309) and eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services_rec_u2i,
    sum(case when x_eid = 300 and eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services_serp,
    sum(case when item_flags & 4 = 0 and item_flags & 65536 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as total_delivery_item_contact,
    sum(case when item_flags & 4 = 0 and eid = 2013 then 1 end) as total_delivery_widget,
    sum(case when (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and SFAccount_Type = 'Девелопер' or eid in (3461, 4600)) then 1 end) as total_developer_contacts,
    sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then district_count end) as total_districts_in_searches,
    sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then metro_count end) as total_metros_in_searches,
    sum(case when eid = 300 and search_flags & 2097152 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as total_searches_from_suggest,
    sum(case when eid = 2592 and microcat_id = 7096 then 1 end) as transport_main_pages,
    sum(case when eid = 2592 and (eid = 300 and (onmap = 0 or platform_id != 1) or x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) or eid in (2012, 2309)) then 1 end) as vertical_main,
    sum(case when eid = 2592 and x_rec_engine_id = 320590750001 then 1 end) as vertical_main_featured,
    sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null))) then 1 end) as vertical_main_first_page,
    sum(case when eid = 2592 then 1 end) as vertical_main_pages,
    sum(case when eid = 2592 and x_rec_engine_id = 320585250001 then 1 end) as vertical_main_rec,
    sum(case when eid = 2654 then 1 end) as write_button_clicks
from buyer_stream t
;

create metrics buyer_stream_cookie_item as
select
    sum(case when booking_created_short_rent > 0 then 1 end) as booking_created_short_rent_grouped,
    sum(case when bt_clicks > 0 then 1 end) as bt_clicks_grouped,
    sum(case when cnt_btc_from_map > 0 then 1 end) as buyer_target_clicks_from_map_grouped,
    sum(case when cnt_contacts_delivery > 0 then 1 end) as contacts_delivery_grouped,
    sum(case when cnt_cs_extended_profile_services > 0 then 1 end) as contacts_extended_profile_services_uniq,
    sum(case when cnt_cs_extended_profile > 0 then 1 end) as contacts_extended_profile_uniq,
    sum(case when cnt_cs_from_map > 0 then 1 end) as contacts_from_map_grouped,
    sum(case when contacts > 0 then 1 end) as contacts_grouped,
    sum(case when cnt_cs_profile_shop > 0 then 1 end) as contacts_profile_shop_uniq,
    sum(case when cnt_cs_public_profile > 0 then 1 end) as contacts_public_profile_uniq,
    sum(case when cnt_cs_shopx > 0 then 1 end) as contacts_shop_uniq,
    sum(case when total_courier_click > 0 then 1 end) as courier_click,
    sum(case when total_courier_contact > 0 then 1 end) as courier_contact,
    sum(case when total_courier_widget > 0 then 1 end) as courier_widget,
    sum(case when total_delivery_click > 0 then 1 end) as delivery_click,
    sum(case when total_delivery_click_all_services > 0 then 1 end) as delivery_click_all_services,
    sum(case when total_delivery_click_wo_messenger > 0 then 1 end) as delivery_click_wo_messenger,
    sum(case when total_delivery_confirm > 0 then 1 end) as delivery_confirm,
    sum(case when total_delivery_contact > 0 then 1 end) as delivery_contact,
    sum(case when total_delivery_contact_all_services > 0 then 1 end) as delivery_contact_all_services,
    sum(case when total_delivery_item_contact > 0 then 1 end) as delivery_item_contact,
    sum(case when delivery_total_item_view > 0 then 1 end) as delivery_item_view,
    sum(case when delivery_orders_created > 0 then 1 end) as delivery_orders_created_grouped,
    sum(case when total_delivery_widget > 0 then 1 end) as delivery_widget,
    sum(case when cnt_fav_from_map > 0 then 1 end) as fav_added_from_map_grouped,
    sum(case when favorites_added > 0 then 1 end) as favorites_added_grouped,
    sum(case when cnt_favorites_net > 0 then 1 end) as favorites_net,
    sum(case when item_views_client > 0 then 1 end) as item_views_client_grouped,
    sum(case when cnt_iv_extended_profile_services > 0 then 1 end) as item_views_extended_profile_services_uniq,
    sum(case when cnt_iv_extended_profile > 0 then 1 end) as item_views_extended_profile_uniq,
    sum(case when cnt_iv_from_map > 0 then 1 end) as item_views_from_map_grouped,
    sum(case when item_views > 0 then 1 end) as item_views_grouped,
    sum(case when cnt_iv_profile_shop > 0 then 1 end) as item_views_profile_shop_uniq,
    sum(case when cnt_iv_public_profile > 0 then 1 end) as item_views_public_profile_uniq,
    sum(case when cnt_iv_shopx > 0 then 1 end) as item_views_shop_uniq,
    sum(case when phone_views_total > 0 then 1 end) as phone_views_grouped,
    sum(case when phone_views_in_chat > 0 then 1 end) as phone_views_in_chat_grouped,
    sum(case when phone_view_button_clicks > 0 then 1 end) as unq_item_ph_button_clicks,
    sum(case when btc_str_flat_verified_badge > 0 then 1 end) as user_btc_str_flat_verified_badge_uniq,
    sum(case when c_str_flat_verified_badge > 0 then 1 end) as user_c_str_flat_verified_badge_uniq,
    sum(case when iv_str_flat_verified_badge > 0 then 1 end) as user_iv_str_flat_verified_badge_uniq,
    sum(case when write_button_clicks > 0 then 1 end) as write_button_clicks_grouped
from (
    select
        cookie_id, cookie_item,
        sum(case when eid = 2581 then 1 end) as booking_created_short_rent,
        sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as bt_clicks,
        sum(case when item_flags & 16777216 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_str_flat_verified_badge,
        sum(case when item_flags & 16777216 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_str_flat_verified_badge,
        sum(case when x_eid = 2743 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_from_map,
        sum(case when eid = 4675 then 1 end) as cnt_contacts_delivery,
        sum(case when x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_extended_profile,
        sum(case when x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_extended_profile_services,
        sum(case when x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_from_map,
        sum(case when (x_eid = 2017 and from_page = 'public_profile' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) or x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) or x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0)) then 1 end) as cnt_cs_profile_shop,
        sum(case when x_eid = 2017 and from_page = 'public_profile' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_public_profile,
        sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_shopx,
        sum(case when eid in (401, 2574, 2732) and x_eid = 2743 then 1 end) as cnt_fav_from_map,
        sum(favorites_net) as cnt_favorites_net,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' then 1 end) as cnt_iv_extended_profile,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' then 1 end) as cnt_iv_extended_profile_services,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_from_map,
        sum(case when (eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'public_profile' or eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' or eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 128 > 0) then 1 end) as cnt_iv_profile_shop,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'public_profile' then 1 end) as cnt_iv_public_profile,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 128 > 0 then 1 end) as cnt_iv_shopx,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contacts,
        sum(case when eid = 2015 then 1 end) as delivery_orders_created,
        sum(case when item_flags & 65536 > 0 and eid = 301 then 1 end) as delivery_total_item_view,
        sum(case when eid in (401, 2574, 2732) then 1 end) as favorites_added,
        sum(case when eid = 301 then 1 end) as item_views,
        sum(case when eid = 2649 then 1 end) as item_views_client,
        sum(case when item_flags & 16777216 > 0 and eid = 301 then 1 end) as iv_str_flat_verified_badge,
        sum(case when eid in (2216, 2650) then 1 end) as phone_view_button_clicks,
        sum(case when eid = 3005 then 1 end) as phone_views_in_chat,
        sum(case when eid in (303, 3005, 3461) then 1 end) as phone_views_total,
        sum(case when other_flags & 4 > 0 and eid = 2483 then 1 end) as total_courier_click,
        sum(case when eid = 4035 then 1 end) as total_courier_contact,
        sum(case when eid = 4033 then 1 end) as total_courier_widget,
        sum(case when other_flags & 1 > 0 and item_flags & 4 = 0 and eid = 2483 then 1 end) as total_delivery_click,
        sum(case when eid = 2483 then 1 end) as total_delivery_click_all_services,
        sum(case when other_flags & 1 > 0 and item_flags & 4 = 0 and eid = 2483 then 1 end) as total_delivery_click_wo_messenger,
        sum(case when item_flags & 4 = 0 and eid = 2749 then 1 end) as total_delivery_confirm,
        sum(case when item_flags & 4 = 0 and eid = 2015 then 1 end) as total_delivery_contact,
        sum(case when eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services,
        sum(case when item_flags & 4 = 0 and item_flags & 65536 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as total_delivery_item_contact,
        sum(case when item_flags & 4 = 0 and eid = 2013 then 1 end) as total_delivery_widget,
        sum(case when eid = 2654 then 1 end) as write_button_clicks
    from buyer_stream t
    group by cookie_id, cookie_item
) _
;

create metrics buyer_stream_item_x as
select
    sum(case when cnt_btc_developer_from_map > 0 then 1 end) as btc_developer_map,
    sum(case when cnt_btc_developer_rec > 0 then 1 end) as btc_developer_rec,
    sum(case when cnt_btc_developer_rec_i2i > 0 then 1 end) as btc_developer_rec_i2i,
    sum(case when cnt_btc_developer_rec_u2i > 0 then 1 end) as btc_developer_rec_u2i,
    sum(case when cnt_btc_views_s_filter_price > 0 then 1 end) as btc_from_search_filter_any,
    sum(case when cnt_btc_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as btc_from_witcher_any,
    sum(case when cnt_btc_wtc_dlv > 0 then 1 end) as btc_from_witcher_delivery,
    sum(case when cnt_btc_wtc_new_auto > 0 then 1 end) as btc_from_witcher_new_auto,
    sum(case when cnt_btc_wtc_new_flats > 0 then 1 end) as btc_from_witcher_new_flats,
    sum(case when cnt_btc_wtc_reg > 0 then 1 end) as btc_from_witcher_regions,
    sum(case when cnt_btc_s_noquery > 0 then 1 end) as btc_serp_noquery,
    sum(case when cnt_btc_s_query > 0 then 1 end) as btc_serp_query,
    sum(case when cnt_btc_any_ext_block > 0 then 1 end) as buyer_target_clicks_any_ext_block,
    sum(case when cnt_btc_cpa > 0 then 1 end) as buyer_target_clicks_cpa,
    sum(case when cnt_btc_dlv > 0 then 1 end) as buyer_target_clicks_delivery,
    sum(case when cnt_btc_from_map > 0 then 1 end) as buyer_target_clicks_from_map,
    sum(case when cnt_btc_s_map_area > 0 then 1 end) as buyer_target_clicks_from_map_area,
    sum(case when cnt_btc_from_map_s_area > 0 then 1 end) as buyer_target_clicks_from_map_total,
    sum(case when cnt_btc_new_any_ext_block > 0 then 1 end) as buyer_target_clicks_new_any_ext_block,
    sum(case when cnt_btc_new_dlv > 0 then 1 end) as buyer_target_clicks_new_delivery,
    sum(case when cnt_btc_new_from_map > 0 then 1 end) as buyer_target_clicks_new_from_map,
    sum(case when cnt_btc_new_s_map_area > 0 then 1 end) as buyer_target_clicks_new_from_map_area,
    sum(case when cnt_btc_new_from_map_s_area > 0 then 1 end) as buyer_target_clicks_new_from_map_total,
    sum(case when cnt_btc_new_rec > 0 then 1 end) as buyer_target_clicks_new_rec,
    sum(case when cnt_btc_new_rec_i2i > 0 then 1 end) as buyer_target_clicks_new_rec_i2i,
    sum(case when cnt_btc_new_rec_u2i > 0 then 1 end) as buyer_target_clicks_new_rec_u2i,
    sum(case when cnt_btc_new_reg > 0 then 1 end) as buyer_target_clicks_new_regions,
    sum(case when cnt_btc_new_s_item_attr > 0 then 1 end) as buyer_target_clicks_new_serp,
    sum(case when cnt_btc_no > 0 then 1 end) as buyer_target_clicks_nox,
    sum(case when cnt_btc_premium > 0 then 1 end) as buyer_target_clicks_premium,
    sum(case when cnt_btc_push > 0 then 1 end) as buyer_target_clicks_push,
    sum(case when cnt_btc_push_land > 0 then 1 end) as buyer_target_clicks_push_land,
    sum(case when cnt_btc_qrm > 0 then 1 end) as buyer_target_clicks_quorum,
    sum(case when cnt_btc_rec > 0 then 1 end) as buyer_target_clicks_rec,
    sum(case when cnt_btc_rec_cpa > 0 then 1 end) as buyer_target_clicks_rec_cpa,
    sum(case when cnt_btc_rec_cv2vac > 0 then 1 end) as buyer_target_clicks_rec_cv2vac,
    sum(case when cnt_btc_rec_i2i > 0 then 1 end) as buyer_target_clicks_rec_i2i,
    sum(case when cnt_btc_job_ast > 0 then 1 end) as buyer_target_clicks_rec_job_ast,
    sum(case when cnt_btc_rec_perfvas_x10_1 > 0 then 1 end) as buyer_target_clicks_rec_perfvas_x10_1,
    sum(case when cnt_btc_rec_perfvas_x10_7 > 0 then 1 end) as buyer_target_clicks_rec_perfvas_x10_7,
    sum(case when cnt_btc_rec_perfvas_x2_1 > 0 then 1 end) as buyer_target_clicks_rec_perfvas_x2_1,
    sum(case when cnt_btc_rec_perfvas_x2_7 > 0 then 1 end) as buyer_target_clicks_rec_perfvas_x2_7,
    sum(case when cnt_btc_rec_perfvas_x5_1 > 0 then 1 end) as buyer_target_clicks_rec_perfvas_x5_1,
    sum(case when cnt_btc_rec_perfvas_x5_7 > 0 then 1 end) as buyer_target_clicks_rec_perfvas_x5_7,
    sum(case when cnt_btc_rec_u2i > 0 then 1 end) as buyer_target_clicks_rec_u2i,
    sum(case when cnt_btc_rec_u2i_collab > 0 then 1 end) as buyer_target_clicks_rec_u2i_collab,
    sum(case when cnt_btc_rec_u2i_graph > 0 then 1 end) as buyer_target_clicks_rec_u2i_graph,
    sum(case when cnt_btc_rec_u2i_similars > 0 then 1 end) as buyer_target_clicks_rec_u2i_similars,
    sum(case when cnt_btc_rec_u2i_user2vec > 0 then 1 end) as buyer_target_clicks_rec_u2i_user2vec,
    sum(case when cnt_btc_reg > 0 then 1 end) as buyer_target_clicks_regions,
    sum(case when cnt_btc_reg_any > 0 then 1 end) as buyer_target_clicks_regions_any,
    sum(case when cnt_btc_reg_mix > 0 then 1 end) as buyer_target_clicks_regions_mix,
    sum(case when cnt_btc_old_any_ext_block > 0 then 1 end) as buyer_target_clicks_returned_any_ext_block,
    sum(case when cnt_btc_old_rec > 0 then 1 end) as buyer_target_clicks_returned_rec,
    sum(case when cnt_btc_old_rec_i2i > 0 then 1 end) as buyer_target_clicks_returned_rec_i2i,
    sum(case when cnt_btc_old_rec_u2i > 0 then 1 end) as buyer_target_clicks_returned_rec_u2i,
    sum(case when cnt_btc_old_s_item_attr > 0 then 1 end) as buyer_target_clicks_returned_serp,
    sum(case when cnt_btc_s_cpa > 0 then 1 end) as buyer_target_clicks_s_cpa,
    sum(case when cnt_btc_s_u2i > 0 then 1 end) as buyer_target_clicks_searches_u2i,
    sum(case when cnt_btc_s_item_attr > 0 then 1 end) as buyer_target_clicks_serp,
    sum(case when cnt_btc_s_distr > 0 then 1 end) as buyer_target_clicks_serp_district,
    sum(case when cnt_btc_s_metro > 0 then 1 end) as buyer_target_clicks_serp_metro,
    sum(case when cnt_btc_serp_perfvas_x10_1 > 0 then 1 end) as buyer_target_clicks_serp_perfvas_x10_1,
    sum(case when cnt_btc_serp_perfvas_x10_7 > 0 then 1 end) as buyer_target_clicks_serp_perfvas_x10_7,
    sum(case when cnt_btc_serp_perfvas_x2_1 > 0 then 1 end) as buyer_target_clicks_serp_perfvas_x2_1,
    sum(case when cnt_btc_serp_perfvas_x2_7 > 0 then 1 end) as buyer_target_clicks_serp_perfvas_x2_7,
    sum(case when cnt_btc_serp_perfvas_x5_1 > 0 then 1 end) as buyer_target_clicks_serp_perfvas_x5_1,
    sum(case when cnt_btc_serp_perfvas_x5_7 > 0 then 1 end) as buyer_target_clicks_serp_perfvas_x5_7,
    sum(case when cnt_btc_s_radius > 0 then 1 end) as buyer_target_clicks_serp_radius,
    sum(case when cnt_btc_s_road > 0 then 1 end) as buyer_target_clicks_serp_road,
    sum(case when cnt_btc_s_saved > 0 then 1 end) as buyer_target_clicks_serp_saved,
    sum(case when cnt_btc_s_wo_map_area > 0 then 1 end) as buyer_target_clicks_serp_wo_map_area,
    sum(case when cnt_btc_serp_xl > 0 then 1 end) as buyer_target_clicks_serp_xl,
    sum(case when cnt_btc_shopx > 0 then 1 end) as buyer_target_clicks_shop,
    sum(case when cnt_btc_vas > 0 then 1 end) as buyer_target_clicks_vas,
    sum(case when cnt_btc_vec > 0 then 1 end) as buyer_target_clicks_vector,
    sum(case when cnt_btc_vip > 0 then 1 end) as buyer_target_clicks_vip,
    sum(case when cnt_cs_developer_from_map > 0 then 1 end) as c_developer_map,
    sum(case when cnt_cs_developer_rec > 0 then 1 end) as c_developer_rec,
    sum(case when cnt_cs_developer_rec_i2i > 0 then 1 end) as c_developer_rec_i2i,
    sum(case when cnt_cs_developer_rec_u2i > 0 then 1 end) as c_developer_rec_u2i,
    sum(case when cnt_cs_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as c_from_witcher_any,
    sum(case when cnt_cs_wtc_dlv > 0 then 1 end) as c_from_witcher_delivery,
    sum(case when cnt_cs_wtc_new_auto > 0 then 1 end) as c_from_witcher_new_auto,
    sum(case when cnt_cs_wtc_new_flats > 0 then 1 end) as c_from_witcher_new_flats,
    sum(case when cnt_cs_wtc_reg > 0 then 1 end) as c_from_witcher_regions,
    sum(case when cnt_cs_s_grouped_doubles > 0 then 1 end) as c_serp_grouped_doubles,
    sum(case when cnt_click_delivery_any_ext_block > 0 then 1 end) as click_delivery_any_ext_block,
    sum(case when cnt_contact_delivery_any_ext_block > 0 then 1 end) as contact_delivery_any_ext_block,
    sum(case when cnt_contact_delivery_serp > 0 then 1 end) as contact_delivery_serp,
    sum(case when cnt_cs_any_ext_block > 0 then 1 end) as contacts_any_ext_block,
    sum(case when cnt_cs_cpa > 0 then 1 end) as contacts_cpa,
    sum(case when cnt_cs_dlv > 0 then 1 end) as contacts_delivery,
    sum(case when cnt_contacts_delivery_fav > 0 then 1 end) as contacts_delivery_fav,
    sum(case when cnt_contacts_delivery_rec_i2i > 0 then 1 end) as contacts_delivery_rec_i2i,
    sum(case when cnt_contacts_delivery_rec_u2i > 0 then 1 end) as contacts_delivery_rec_u2i,
    sum(case when cnt_contacts_delivery_serp > 0 then 1 end) as contacts_delivery_serp,
    sum(case when cnt_cs_extended_profile > 0 then 1 end) as contacts_extended_profile,
    sum(case when cnt_cs_extended_profile_services > 0 then 1 end) as contacts_extended_profile_services,
    sum(case when cnt_cs_fav_list > 0 then 1 end) as contacts_fav_list,
    sum(case when cnt_cs_from_map > 0 then 1 end) as contacts_from_map,
    sum(case when cnt_contacts_s_filter_price > 0 then 1 end) as contacts_from_searches_with_filters,
    sum(case when cnt_cs_msg_fav_list > 0 then 1 end) as contacts_msg_fav_list,
    sum(case when cnt_cs_msg_no_item_attr > 0 then 1 end) as contacts_msg_nox,
    sum(case when cnt_cs_msg_rec_cv2vac > 0 then 1 end) as contacts_msg_rec_cv2vac,
    sum(case when cnt_cs_msg_rec_i2i > 0 then 1 end) as contacts_msg_rec_i2i,
    sum(case when cnt_cs_msg_rec_u2i > 0 then 1 end) as contacts_msg_rec_u2i,
    sum(case when cnt_cs_msg_s_item_attr > 0 then 1 end) as contacts_msg_serp,
    sum(case when cnt_cs_no_item_attr > 0 then 1 end) as contacts_nox,
    sum(case when cnt_cs_perfvas_w > 0 then 1 end) as contacts_perfvas_weighted,
    sum(case when cnt_cs_ph_fav_list > 0 then 1 end) as contacts_ph_fav_list,
    sum(case when cnt_cs_ph_no_item_attr > 0 then 1 end) as contacts_ph_nox,
    sum(case when cnt_cs_ph_rec_cv2vac > 0 then 1 end) as contacts_ph_rec_cv2vac,
    sum(case when cnt_cs_ph_rec_i2i > 0 then 1 end) as contacts_ph_rec_i2i,
    sum(case when cnt_cs_ph_rec_u2i > 0 then 1 end) as contacts_ph_rec_u2i,
    sum(case when cnt_cs_ph_s_item_attr > 0 then 1 end) as contacts_ph_serp,
    sum(case when cnt_cs_premium > 0 then 1 end) as contacts_premium,
    sum(case when cnt_cs_profile_shop > 0 then 1 end) as contacts_profile_shop,
    sum(case when cnt_cs_public_profile > 0 then 1 end) as contacts_public_profile,
    sum(case when cnt_cs_push > 0 then 1 end) as contacts_push,
    sum(case when cnt_cs_push_land > 0 then 1 end) as contacts_push_land,
    sum(case when cnt_cs_qrm > 0 then 1 end) as contacts_quorum,
    sum(case when cnt_cs_rec > 0 then 1 end) as contacts_rec,
    sum(case when cnt_cs_rec_cpa > 0 then 1 end) as contacts_rec_cpa,
    sum(case when cnt_cs_rec_cv2vac > 0 then 1 end) as contacts_rec_cv2vac,
    sum(case when cnt_cs_rec_i2i > 0 then 1 end) as contacts_rec_i2i,
    sum(case when cnt_cs_rec_i2i_premium > 0 then 1 end) as contacts_rec_i2i_premium,
    sum(case when cnt_cs_rec_i2i_push > 0 then 1 end) as contacts_rec_i2i_push,
    sum(case when cnt_cs_rec_i2i_vas > 0 then 1 end) as contacts_rec_i2i_vas,
    sum(case when cnt_cs_rec_i2i_vip > 0 then 1 end) as contacts_rec_i2i_vip,
    sum(case when cnt_c_rec_job_ast > 0 then 1 end) as contacts_rec_job_ast,
    sum(case when cnt_cs_rec_perfvas_x10_1 > 0 then 1 end) as contacts_rec_perfvas_x10_1,
    sum(case when cnt_cs_rec_perfvas_x10_7 > 0 then 1 end) as contacts_rec_perfvas_x10_7,
    sum(case when cnt_cs_rec_perfvas_x2_1 > 0 then 1 end) as contacts_rec_perfvas_x2_1,
    sum(case when cnt_cs_rec_perfvas_x2_7 > 0 then 1 end) as contacts_rec_perfvas_x2_7,
    sum(case when cnt_cs_rec_perfvas_x5_1 > 0 then 1 end) as contacts_rec_perfvas_x5_1,
    sum(case when cnt_cs_rec_perfvas_x5_7 > 0 then 1 end) as contacts_rec_perfvas_x5_7,
    sum(case when cnt_cs_rec_premium > 0 then 1 end) as contacts_rec_premium,
    sum(case when cnt_cs_rec_push > 0 then 1 end) as contacts_rec_push,
    sum(case when cnt_cs_rec_u2i > 0 then 1 end) as contacts_rec_u2i,
    sum(case when cnt_cs_rec_u2i_collab > 0 then 1 end) as contacts_rec_u2i_collab,
    sum(case when cnt_cs_rec_u2i_graph > 0 then 1 end) as contacts_rec_u2i_graph,
    sum(case when cnt_cs_rec_u2i_premium > 0 then 1 end) as contacts_rec_u2i_premium,
    sum(case when cnt_cs_rec_u2i_push > 0 then 1 end) as contacts_rec_u2i_push,
    sum(case when cnt_cs_rec_u2i_similars > 0 then 1 end) as contacts_rec_u2i_similars,
    sum(case when cnt_cs_rec_u2i_user2vec > 0 then 1 end) as contacts_rec_u2i_user2vec,
    sum(case when cnt_cs_rec_u2i_vas > 0 then 1 end) as contacts_rec_u2i_vas,
    sum(case when cnt_cs_rec_u2i_vip > 0 then 1 end) as contacts_rec_u2i_vip,
    sum(case when cnt_cs_rec_vas > 0 then 1 end) as contacts_rec_vas,
    sum(case when cnt_cs_rec_vip > 0 then 1 end) as contacts_rec_vip,
    sum(case when cnt_cs_reg > 0 then 1 end) as contacts_regions,
    sum(case when cnt_cs_reg_any > 0 then 1 end) as contacts_regions_any,
    sum(case when cnt_cs_reg_mix > 0 then 1 end) as contacts_regions_mix,
    sum(case when cnt_cs_s_cpa > 0 then 1 end) as contacts_s_cpa,
    sum(case when cnt_cs_s_u2i > 0 then 1 end) as contacts_searches_u2i,
    sum(case when cnt_cs_s_item_attr > 0 then 1 end) as contacts_serp,
    sum(case when cnt_cs_s_distr > 0 then 1 end) as contacts_serp_district,
    sum(case when cnt_cs_s_distr_metro_road > 0 then 1 end) as contacts_serp_local_geo,
    sum(case when cnt_cs_s_map_area > 0 then 1 end) as contacts_serp_map_area,
    sum(case when cnt_cs_from_map_s_area > 0 then 1 end) as contacts_serp_map_total,
    sum(case when cnt_cs_s_metro > 0 then 1 end) as contacts_serp_metro,
    sum(case when cnt_cs_serp_perfvas_x10_1 > 0 then 1 end) as contacts_serp_perfvas_x10_1,
    sum(case when cnt_cs_serp_perfvas_x10_7 > 0 then 1 end) as contacts_serp_perfvas_x10_7,
    sum(case when cnt_cs_serp_perfvas_x2_1 > 0 then 1 end) as contacts_serp_perfvas_x2_1,
    sum(case when cnt_cs_serp_perfvas_x2_7 > 0 then 1 end) as contacts_serp_perfvas_x2_7,
    sum(case when cnt_cs_serp_perfvas_x5_1 > 0 then 1 end) as contacts_serp_perfvas_x5_1,
    sum(case when cnt_cs_serp_perfvas_x5_7 > 0 then 1 end) as contacts_serp_perfvas_x5_7,
    sum(case when cnt_cs_s_radius > 0 then 1 end) as contacts_serp_radius,
    sum(case when cnt_cs_s_road > 0 then 1 end) as contacts_serp_road,
    sum(case when cnt_cs_s_saved > 0 then 1 end) as contacts_serp_saved,
    sum(case when cnt_cs_s_wo_map_area > 0 then 1 end) as contacts_serp_wo_map_area,
    sum(case when cnt_cs_serp_xl > 0 then 1 end) as contacts_serp_xl,
    sum(case when cnt_cs_shopx > 0 then 1 end) as contacts_shop,
    sum(case when cnt_cs_vas > 0 then 1 end) as contacts_vas,
    sum(case when cnt_cs_vec > 0 then 1 end) as contacts_vector,
    sum(case when cnt_cs_vertical_main > 0 then 1 end) as contacts_vertical_main,
    sum(case when cnt_cs_vertical_main_rec > 0 then 1 end) as contacts_vertical_main_rec,
    sum(case when cnt_cs_vip > 0 then 1 end) as contacts_vip,
    sum(case when cnt_create_order_delivery_any_ext_block > 0 then 1 end) as create_order_delivery_any_ext_block,
    sum(case when total_delivery_click_all_services_fav > 0 then 1 end) as delivery_click_all_services_fav,
    sum(case when total_delivery_click_all_services_rec_i2i > 0 then 1 end) as delivery_click_all_services_rec_i2i,
    sum(case when total_delivery_click_all_services_rec_u2i > 0 then 1 end) as delivery_click_all_services_rec_u2i,
    sum(case when total_delivery_click_all_services_serp > 0 then 1 end) as delivery_click_all_services_serp,
    sum(case when cnt_delivery_click_serp > 0 then 1 end) as delivery_click_serp,
    sum(case when cnt_delivery_confirm_serp > 0 then 1 end) as delivery_confirm_serp,
    sum(case when total_delivery_contact_all_services_fav > 0 then 1 end) as delivery_contact_all_services_fav,
    sum(case when total_delivery_contact_all_services_rec_i2i > 0 then 1 end) as delivery_contact_all_services_rec_i2i,
    sum(case when total_delivery_contact_all_services_rec_u2i > 0 then 1 end) as delivery_contact_all_services_rec_u2i,
    sum(case when total_delivery_contact_all_services_serp > 0 then 1 end) as delivery_contact_all_services_serp,
    sum(case when cnt_delivery_iv_serp > 0 then 1 end) as delivery_iv_serp,
    sum(case when cnt_delivery_order_create_serp > 0 then 1 end) as delivery_order_create_serp,
    sum(case when cnt_delivery_widget_serp > 0 then 1 end) as delivery_widget_serp,
    sum(case when cnt_fav_dlv > 0 then 1 end) as fav_added_delivery,
    sum(case when cnt_fav_from_map > 0 then 1 end) as fav_added_from_map,
    sum(case when cnt_fav_premium > 0 then 1 end) as fav_added_premium,
    sum(case when cnt_fav_push > 0 then 1 end) as fav_added_push,
    sum(case when cnt_fav_push_land > 0 then 1 end) as fav_added_push_land,
    sum(case when cnt_fav_rec > 0 then 1 end) as fav_added_rec,
    sum(case when cnt_fav_rec_cv2vac > 0 then 1 end) as fav_added_rec_cv2vac,
    sum(case when cnt_fav_rec_i2i > 0 then 1 end) as fav_added_rec_i2i,
    sum(case when cnt_fav_rec_i2i_premium > 0 then 1 end) as fav_added_rec_i2i_premium,
    sum(case when cnt_fav_rec_i2i_push > 0 then 1 end) as fav_added_rec_i2i_push,
    sum(case when cnt_fav_rec_i2i_vas > 0 then 1 end) as fav_added_rec_i2i_vas,
    sum(case when cnt_fav_rec_i2i_vip > 0 then 1 end) as fav_added_rec_i2i_vip,
    sum(case when cnt_fav_rec_job_ast > 0 then 1 end) as fav_added_rec_job_ast,
    sum(case when cnt_fav_rec_premium > 0 then 1 end) as fav_added_rec_premium,
    sum(case when cnt_fav_rec_push > 0 then 1 end) as fav_added_rec_push,
    sum(case when cnt_fav_rec_u2i > 0 then 1 end) as fav_added_rec_u2i,
    sum(case when cnt_fav_rec_u2i_collab > 0 then 1 end) as fav_added_rec_u2i_collab,
    sum(case when cnt_fav_rec_u2i_graph > 0 then 1 end) as fav_added_rec_u2i_graph,
    sum(case when cnt_fav_rec_u2i_premium > 0 then 1 end) as fav_added_rec_u2i_premium,
    sum(case when cnt_fav_rec_u2i_push > 0 then 1 end) as fav_added_rec_u2i_push,
    sum(case when cnt_fav_rec_u2i_similars > 0 then 1 end) as fav_added_rec_u2i_similars,
    sum(case when cnt_fav_rec_u2i_user2vec > 0 then 1 end) as fav_added_rec_u2i_user2vec,
    sum(case when cnt_fav_rec_u2i_vas > 0 then 1 end) as fav_added_rec_u2i_vas,
    sum(case when cnt_fav_rec_u2i_vip > 0 then 1 end) as fav_added_rec_u2i_vip,
    sum(case when cnt_fav_rec_vas > 0 then 1 end) as fav_added_rec_vas,
    sum(case when cnt_fav_rec_vip > 0 then 1 end) as fav_added_rec_vip,
    sum(case when cnt_fav_reg > 0 then 1 end) as fav_added_regions,
    sum(case when cnt_fav_reg_any > 0 then 1 end) as fav_added_regions_any,
    sum(case when cnt_fav_reg_mix > 0 then 1 end) as fav_added_regions_mix,
    sum(case when cnt_fav_s_u2i > 0 then 1 end) as fav_added_searches_u2i,
    sum(case when cnt_fav_s > 0 then 1 end) as fav_added_serp,
    sum(case when cnt_fav_s_distr > 0 then 1 end) as fav_added_serp_district,
    sum(case when cnt_fav_s_map_area > 0 then 1 end) as fav_added_serp_map_area,
    sum(case when cnt_fav_from_map_s_area > 0 then 1 end) as fav_added_serp_map_total,
    sum(case when cnt_fav_s_metro > 0 then 1 end) as fav_added_serp_metro,
    sum(case when cnt_fav_s_radius > 0 then 1 end) as fav_added_serp_radius,
    sum(case when cnt_fav_s_road > 0 then 1 end) as fav_added_serp_road,
    sum(case when cnt_fav_s_saved > 0 then 1 end) as fav_added_serp_saved,
    sum(case when cnt_fav_s_wo_map_area > 0 then 1 end) as fav_added_serp_wo_map_area,
    sum(case when cnt_fav_shopx > 0 then 1 end) as fav_added_shop,
    sum(case when cnt_fav_vas > 0 then 1 end) as fav_added_vas,
    sum(case when cnt_fav_vip > 0 then 1 end) as fav_added_vip,
    sum(case when cnt_fav_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as fav_from_witcher_any,
    sum(case when cnt_fav_wtc_dlv > 0 then 1 end) as fav_from_witcher_delivery,
    sum(case when cnt_fav_wtc_new_auto > 0 then 1 end) as fav_from_witcher_new_auto,
    sum(case when cnt_fav_wtc_new_flats > 0 then 1 end) as fav_from_witcher_new_flats,
    sum(case when cnt_fav_wtc_reg > 0 then 1 end) as fav_from_witcher_regions,
    sum(case when cnt_iv_any_ext_block > 0 then 1 end) as item_views_any_ext_block,
    sum(case when cnt_iv_cpa > 0 then 1 end) as item_views_cpa,
    sum(case when cnt_iv_dlv > 0 then 1 end) as item_views_delivery,
    sum(case when cnt_iv_delivery_any_ext_block > 0 then 1 end) as item_views_delivery_any_ext_block,
    sum(case when cnt_iv_extended_profile > 0 then 1 end) as item_views_extended_profile,
    sum(case when cnt_iv_extended_profile_services > 0 then 1 end) as item_views_extended_profile_services,
    sum(case when cnt_fav_list_iv > 0 then 1 end) as item_views_fav_list,
    sum(case when cnt_iv_from_map > 0 then 1 end) as item_views_from_map,
    sum(case when cnt_iv_s_map_area > 0 then 1 end) as item_views_from_map_area,
    sum(case when cnt_iv_from_map_s_area > 0 then 1 end) as item_views_from_map_total,
    sum(case when cnt_iv_s_filter_price > 0 then 1 end) as item_views_from_search_filter_any,
    sum(case when cnt_iv_s_wo_map_area > 0 then 1 end) as item_views_from_wo_map_area,
    sum(case when cnt_iv_no_item_attr > 0 then 1 end) as item_views_nox,
    sum(case when cnt_iv_premium > 0 then 1 end) as item_views_premium,
    sum(case when cnt_iv_profile_shop > 0 then 1 end) as item_views_profile_shop,
    sum(case when cnt_iv_public_profile > 0 then 1 end) as item_views_public_profile,
    sum(case when cnt_iv_push > 0 then 1 end) as item_views_push,
    sum(case when cnt_iv_push_land > 0 then 1 end) as item_views_push_land,
    sum(case when cnt_iv_qrm > 0 then 1 end) as item_views_quorum,
    sum(case when cnt_iv_rec > 0 then 1 end) as item_views_rec,
    sum(case when cnt_iv_rec_cpa > 0 then 1 end) as item_views_rec_cpa,
    sum(case when cnt_iv_rec_cv2vac > 0 then 1 end) as item_views_rec_cv2vac,
    sum(case when cnt_iv_rec_i2i > 0 then 1 end) as item_views_rec_i2i,
    sum(case when cnt_iv_rec_i2i_premium > 0 then 1 end) as item_views_rec_i2i_premium,
    sum(case when cnt_iv_rec_i2i_push > 0 then 1 end) as item_views_rec_i2i_push,
    sum(case when cnt_iv_rec_i2i_vas > 0 then 1 end) as item_views_rec_i2i_vas,
    sum(case when cnt_iv_rec_i2i_vip > 0 then 1 end) as item_views_rec_i2i_vip,
    sum(case when cnt_iv_rec_job_ast > 0 then 1 end) as item_views_rec_job_ast,
    sum(case when cnt_iv_rec_perfvas_x10_1 > 0 then 1 end) as item_views_rec_perfvas_x10_1,
    sum(case when cnt_iv_rec_perfvas_x10_7 > 0 then 1 end) as item_views_rec_perfvas_x10_7,
    sum(case when cnt_iv_rec_perfvas_x2_1 > 0 then 1 end) as item_views_rec_perfvas_x2_1,
    sum(case when cnt_iv_rec_perfvas_x2_7 > 0 then 1 end) as item_views_rec_perfvas_x2_7,
    sum(case when cnt_iv_rec_perfvas_x5_1 > 0 then 1 end) as item_views_rec_perfvas_x5_1,
    sum(case when cnt_iv_rec_perfvas_x5_7 > 0 then 1 end) as item_views_rec_perfvas_x5_7,
    sum(case when cnt_iv_rec_premium > 0 then 1 end) as item_views_rec_premium,
    sum(case when cnt_iv_rec_push > 0 then 1 end) as item_views_rec_push,
    sum(case when cnt_iv_rec_u2i > 0 then 1 end) as item_views_rec_u2i,
    sum(case when cnt_iv_rec_u2i_collab > 0 then 1 end) as item_views_rec_u2i_collab,
    sum(case when cnt_iv_rec_u2i_graph > 0 then 1 end) as item_views_rec_u2i_graph,
    sum(case when cnt_iv_rec_u2i_premium > 0 then 1 end) as item_views_rec_u2i_premium,
    sum(case when cnt_iv_rec_u2i_push > 0 then 1 end) as item_views_rec_u2i_push,
    sum(case when cnt_iv_rec_u2i_similars > 0 then 1 end) as item_views_rec_u2i_similars,
    sum(case when cnt_iv_rec_u2i_user2vec > 0 then 1 end) as item_views_rec_u2i_user2vec,
    sum(case when cnt_iv_rec_u2i_vas > 0 then 1 end) as item_views_rec_u2i_vas,
    sum(case when cnt_iv_rec_u2i_vip > 0 then 1 end) as item_views_rec_u2i_vip,
    sum(case when cnt_iv_rec_vas > 0 then 1 end) as item_views_rec_vas,
    sum(case when cnt_iv_rec_vip > 0 then 1 end) as item_views_rec_vip,
    sum(case when cnt_iv_reg > 0 then 1 end) as item_views_regions,
    sum(case when cnt_iv_reg_any > 0 then 1 end) as item_views_regions_any,
    sum(case when cnt_iv_reg_mix > 0 then 1 end) as item_views_regions_mix,
    sum(case when cnt_iv_s_cpa > 0 then 1 end) as item_views_s_cpa,
    sum(case when cnt_iv_s_item_attr > 0 then 1 end) as item_views_serp,
    sum(case when cnt_iv_s_distr > 0 then 1 end) as item_views_serp_district,
    sum(case when cnt_iv_s_metro > 0 then 1 end) as item_views_serp_metro,
    sum(case when cnt_iv_serp_perfvas_x10_1 > 0 then 1 end) as item_views_serp_perfvas_x10_1,
    sum(case when cnt_iv_serp_perfvas_x10_7 > 0 then 1 end) as item_views_serp_perfvas_x10_7,
    sum(case when cnt_iv_serp_perfvas_x2_1 > 0 then 1 end) as item_views_serp_perfvas_x2_1,
    sum(case when cnt_iv_serp_perfvas_x2_7 > 0 then 1 end) as item_views_serp_perfvas_x2_7,
    sum(case when cnt_iv_serp_perfvas_x5_1 > 0 then 1 end) as item_views_serp_perfvas_x5_1,
    sum(case when cnt_iv_serp_perfvas_x5_7 > 0 then 1 end) as item_views_serp_perfvas_x5_7,
    sum(case when cnt_iv_s_radius > 0 then 1 end) as item_views_serp_radius,
    sum(case when cnt_iv_s_road > 0 then 1 end) as item_views_serp_road,
    sum(case when cnt_iv_s_saved > 0 then 1 end) as item_views_serp_saved,
    sum(case when cnt_iv_grouped > 0 then 1 end) as item_views_serp_similar,
    sum(case when cnt_iv_serp_xl > 0 then 1 end) as item_views_serp_xl,
    sum(case when cnt_iv_shopx > 0 then 1 end) as item_views_shop,
    sum(case when cnt_iv_vas > 0 then 1 end) as item_views_vas,
    sum(case when cnt_iv_vec > 0 then 1 end) as item_views_vector,
    sum(case when cnt_iv_vip > 0 then 1 end) as item_views_vip,
    sum(case when cnt_iv_developer_from_map > 0 then 1 end) as iv_developer_map,
    sum(case when cnt_iv_developer_rec > 0 then 1 end) as iv_developer_rec,
    sum(case when cnt_iv_developer_rec_i2i > 0 then 1 end) as iv_developer_rec_i2i,
    sum(case when cnt_iv_developer_rec_u2i > 0 then 1 end) as iv_developer_rec_u2i,
    sum(case when cnt_iv_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as iv_from_witcher_any,
    sum(case when cnt_iv_wtc_dlv > 0 then 1 end) as iv_from_witcher_delivery,
    sum(case when cnt_iv_wtc_new_auto > 0 then 1 end) as iv_from_witcher_new_auto,
    sum(case when cnt_iv_wtc_new_flats > 0 then 1 end) as iv_from_witcher_new_flats,
    sum(case when cnt_iv_wtc_reg > 0 then 1 end) as iv_from_witcher_regions,
    sum(case when cnt_iv_grouped_doubles > 0 then 1 end) as iv_grouped_doubles,
    sum(case when cnt_iv_s_u2i > 0 then 1 end) as iv_searches_u2i,
    sum(case when cnt_iv_seen > 0 then 1 end) as iv_seen,
    sum(case when cnt_iv_vertical_main > 0 then 1 end) as iv_vertical_main,
    sum(case when cnt_iv_vertical_main_featured > 0 then 1 end) as iv_vertical_main_featured,
    sum(case when cnt_iv_vertical_main_rec > 0 then 1 end) as iv_vertical_main_rec,
    sum(case when cnt_soc_btn > 0 then 1 end) as soc_btn,
    sum(case when cnt_btc_s_distr_metro_radius_road > 0 then 1 end) as unq_item_x_btc_s_distr_metro_radius_road,
    sum(case when cnt_btc_s_distr_metro_road > 0 then 1 end) as unq_item_x_btc_s_distr_metro_road,
    sum(case when cnt_iv_wtc_dlv_new_auto_flats_reg_s_from > 0 then 1 end) as wtc_from_witcher_any,
    sum(case when cnt_iv_wtc_dlv_s_from > 0 then 1 end) as wtc_from_witcher_delivery,
    sum(case when cnt_iv_wtc_new_auto_s_from > 0 then 1 end) as wtc_from_witcher_new_auto,
    sum(case when cnt_iv_wtc_new_flats_s_from > 0 then 1 end) as wtc_from_witcher_new_flats,
    sum(case when cnt_iv_wtc_reg_s_from > 0 then 1 end) as wtc_from_witcher_regions
from (
    select
        cookie_id, item_x,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_any_ext_block,
        sum(case when item_flags & 131072 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_cpa,
        sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2743 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_developer_from_map,
        sum(case when SFAccount_Type = 'Девелопер' and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_developer_rec,
        sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_developer_rec_i2i,
        sum(case when SFAccount_Type = 'Девелопер' and x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_developer_rec_u2i,
        sum(case when search_query_type = 10 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_dlv,
        sum(case when x_eid = 2743 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_from_map,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_btc_from_map_s_area,
        sum(case when x_eid = 4126 and from_page = 'assistant' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_job_ast,
        sum(case when x_eid = 300 and new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_new_any_ext_block,
        sum(case when search_query_type = 10 and x_eid = 300 and new_user_btc = True and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_dlv,
        sum(case when x_eid = 2743 and new_user_btc = True and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_from_map,
        sum(case when new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_btc_new_from_map_s_area,
        sum(case when new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_new_rec,
        sum(case when new_user_btc = True and x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_rec_i2i,
        sum(case when new_user_btc = True and x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_rec_u2i,
        sum(case when new_user_btc = True and search_query_type = 9 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_reg,
        sum(case when new_user_btc = True and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_s_item_attr,
        sum(case when new_user_btc = True and search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_s_map_area,
        sum(case when x_eid is null and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_no,
        sum(case when x_eid = 300 and new_user_btc = False and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_old_any_ext_block,
        sum(case when new_user_btc = False and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_old_rec,
        sum(case when new_user_btc = False and x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_rec_i2i,
        sum(case when new_user_btc = False and x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_rec_u2i,
        sum(case when new_user_btc = False and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_s_item_attr,
        sum(case when search_query_type = 2 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_premium,
        sum(case when search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_push,
        sum(case when x_eid = 5354 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_push_land,
        sum(case when search_query_type = 15 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_qrm,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec,
        sum(case when item_flags & 131072 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_cpa,
        sum(case when x_eid = 4386 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_cv2vac,
        sum(case when x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_i2i,
        sum(case when item_vas_flags & 65536 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x10_1,
        sum(case when item_vas_flags & 131072 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x10_7,
        sum(case when item_vas_flags & 4096 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x2_1,
        sum(case when item_vas_flags & 8192 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x2_7,
        sum(case when item_vas_flags & 16384 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x5_1,
        sum(case when item_vas_flags & 32768 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_perfvas_x5_7,
        sum(case when x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i,
        sum(case when x_eid in (2012, 2309) and item_engines & 1 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_collab,
        sum(case when x_eid in (2012, 2309) and item_engines & 16 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_graph,
        sum(case when x_eid in (2012, 2309) and item_engines & 8 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_similars,
        sum(case when x_eid in (2012, 2309) and item_engines & 2 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_user2vec,
        sum(case when search_query_type = 9 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_reg,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 9 or search_query_type = 20)) then 1 end) as cnt_btc_reg_any,
        sum(case when search_query_type = 20 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_reg_mix,
        sum(case when x_eid = 300 and item_flags & 131072 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_cpa,
        sum(case when search_flags & 2 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_distr,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 8 > 0 or search_flags & 4 > 0)) then 1 end) as cnt_btc_s_distr_metro_radius_road,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 4 > 0)) then 1 end) as cnt_btc_s_distr_metro_road,
        sum(case when x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_item_attr,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_map_area,
        sum(case when search_flags & 1 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_metro,
        sum(case when q = '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_noquery,
        sum(case when q > '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_query,
        sum(case when search_flags & 8 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_radius,
        sum(case when search_flags & 4 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_road,
        sum(case when search_flags & 64 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_saved,
        sum(case when search_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_u2i,
        sum(case when search_flags & 16 = 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_wo_map_area,
        sum(case when item_serp_flags & 8192 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x10_1,
        sum(case when item_serp_flags & 16384 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x10_7,
        sum(case when item_serp_flags & 512 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x2_1,
        sum(case when item_serp_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x2_7,
        sum(case when item_serp_flags & 2048 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x5_1,
        sum(case when item_serp_flags & 4096 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_perfvas_x5_7,
        sum(case when item_serp_flags & 256 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_serp_xl,
        sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_shopx,
        sum(case when item_serp_flags & 32527 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_vas,
        sum(case when search_query_type = 18 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_vec,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as cnt_btc_views_s_filter_price,
        sum(case when search_query_type = 3 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_vip,
        sum(case when search_query_type = 12 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_dlv,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 12 or search_query_type = 13 or search_query_type = 14 or search_query_type = 11)) then 1 end) as cnt_btc_wtc_dlv_new_auto_flats_reg,
        sum(case when search_query_type = 13 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_new_auto,
        sum(case when search_query_type = 14 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_new_flats,
        sum(case when search_query_type = 11 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_reg,
        sum(case when x_eid = 4126 and from_page = 'assistant' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_c_rec_job_ast,
        sum(case when eid = 2483 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_click_delivery_any_ext_block,
        sum(case when eid = 4675 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_contact_delivery_any_ext_block,
        sum(case when eid = 4675 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_contact_delivery_serp,
        sum(case when eid = 4675 and x_eid = 400 then 1 end) as cnt_contacts_delivery_fav,
        sum(case when eid = 4675 and x_eid = 2437 then 1 end) as cnt_contacts_delivery_rec_i2i,
        sum(case when eid = 4675 and x_eid in (2012, 2309) then 1 end) as cnt_contacts_delivery_rec_u2i,
        sum(case when eid = 4675 and x_eid = 300 then 1 end) as cnt_contacts_delivery_serp,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as cnt_contacts_s_filter_price,
        sum(case when eid = 2015 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_create_order_delivery_any_ext_block,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_cs_any_ext_block,
        sum(case when item_flags & 131072 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_cpa,
        sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_developer_from_map,
        sum(case when SFAccount_Type = 'Девелопер' and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_developer_rec,
        sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_developer_rec_i2i,
        sum(case when SFAccount_Type = 'Девелопер' and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_developer_rec_u2i,
        sum(case when search_query_type = 10 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_dlv,
        sum(case when x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_extended_profile,
        sum(case when x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_extended_profile_services,
        sum(case when x_eid = 400 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_fav_list,
        sum(case when x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_from_map,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_cs_from_map_s_area,
        sum(case when eid in (856, 857, 4066) and x_eid = 400 then 1 end) as cnt_cs_msg_fav_list,
        sum(case when eid in (856, 857, 4066) and x_eid is null then 1 end) as cnt_cs_msg_no_item_attr,
        sum(case when eid in (856, 857, 4066) and x_eid = 4386 then 1 end) as cnt_cs_msg_rec_cv2vac,
        sum(case when eid in (856, 857, 4066) and x_eid = 2437 then 1 end) as cnt_cs_msg_rec_i2i,
        sum(case when eid in (856, 857, 4066) and x_eid in (2012, 2309) then 1 end) as cnt_cs_msg_rec_u2i,
        sum(case when eid in (856, 857, 4066) and x_eid = 300 then 1 end) as cnt_cs_msg_s_item_attr,
        sum(case when x_eid is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_no_item_attr,
        sum(case when x_eid = 300 and item_vas_flags & 258048 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then vas_power end) as cnt_cs_perfvas_w,
        sum(case when eid = 303 and x_eid = 400 then 1 end) as cnt_cs_ph_fav_list,
        sum(case when eid = 303 and x_eid is null then 1 end) as cnt_cs_ph_no_item_attr,
        sum(case when eid = 303 and x_eid = 4386 then 1 end) as cnt_cs_ph_rec_cv2vac,
        sum(case when eid = 303 and x_eid = 2437 then 1 end) as cnt_cs_ph_rec_i2i,
        sum(case when eid = 303 and x_eid in (2012, 2309) then 1 end) as cnt_cs_ph_rec_u2i,
        sum(case when eid = 303 and x_eid = 300 then 1 end) as cnt_cs_ph_s_item_attr,
        sum(case when search_query_type = 2 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_premium,
        sum(case when (x_eid = 2017 and from_page = 'public_profile' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) or x_eid = 2017 and from_page = 'profile_services' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) or x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0)) then 1 end) as cnt_cs_profile_shop,
        sum(case when x_eid = 2017 and from_page = 'public_profile' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_public_profile,
        sum(case when search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_push,
        sum(case when x_eid = 5354 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_push_land,
        sum(case when search_query_type = 15 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_qrm,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec,
        sum(case when item_flags & 131072 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_cpa,
        sum(case when x_eid = 4386 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_cv2vac,
        sum(case when x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i,
        sum(case when item_vas_flags & 40 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_premium,
        sum(case when item_vas_flags & 4 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_push,
        sum(case when item_vas_flags & 261231 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_vas,
        sum(case when item_vas_flags & 1 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_vip,
        sum(case when item_vas_flags & 65536 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x10_1,
        sum(case when item_vas_flags & 131072 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x10_7,
        sum(case when item_vas_flags & 4096 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x2_1,
        sum(case when item_vas_flags & 8192 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x2_7,
        sum(case when item_vas_flags & 16384 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x5_1,
        sum(case when item_vas_flags & 32768 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_perfvas_x5_7,
        sum(case when item_vas_flags & 40 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_premium,
        sum(case when item_vas_flags & 4 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_push,
        sum(case when x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i,
        sum(case when x_eid in (2012, 2309) and item_engines & 1 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_collab,
        sum(case when x_eid in (2012, 2309) and item_engines & 16 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_graph,
        sum(case when item_vas_flags & 40 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_premium,
        sum(case when item_vas_flags & 4 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_push,
        sum(case when x_eid in (2012, 2309) and item_engines & 8 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_similars,
        sum(case when x_eid in (2012, 2309) and item_engines & 2 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_user2vec,
        sum(case when item_vas_flags & 261231 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_vas,
        sum(case when item_vas_flags & 1 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_vip,
        sum(case when item_vas_flags & 261231 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_vas,
        sum(case when item_vas_flags & 1 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_vip,
        sum(case when search_query_type = 9 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_reg,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 9 or search_query_type = 20)) then 1 end) as cnt_cs_reg_any,
        sum(case when search_query_type = 20 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_reg_mix,
        sum(case when x_eid = 300 and item_flags & 131072 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_cpa,
        sum(case when search_flags & 2 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_distr,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 4 > 0)) then 1 end) as cnt_cs_s_distr_metro_road,
        sum(case when region_id in (697, 4181) and x_from_page = 'items_ungrouped' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_grouped_doubles,
        sum(case when x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_item_attr,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_map_area,
        sum(case when search_flags & 1 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_metro,
        sum(case when search_flags & 8 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_radius,
        sum(case when search_flags & 4 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_road,
        sum(case when search_flags & 64 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_saved,
        sum(case when search_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_u2i,
        sum(case when search_flags & 16 = 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_wo_map_area,
        sum(case when item_serp_flags & 8192 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x10_1,
        sum(case when item_serp_flags & 16384 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x10_7,
        sum(case when item_serp_flags & 512 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x2_1,
        sum(case when item_serp_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x2_7,
        sum(case when item_serp_flags & 2048 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x5_1,
        sum(case when item_serp_flags & 4096 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_perfvas_x5_7,
        sum(case when item_serp_flags & 256 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_serp_xl,
        sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_shopx,
        sum(case when item_serp_flags & 32527 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vas,
        sum(case when search_query_type = 18 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vec,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and ((x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null)) or x_eid = 5516)) then 1 end) as cnt_cs_vertical_main,
        sum(case when x_rec_engine_id = 320585250001 and x_eid = 5516 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vertical_main_rec,
        sum(case when search_query_type = 3 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vip,
        sum(case when search_query_type = 12 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_dlv,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 12 or search_query_type = 13 or search_query_type = 14 or search_query_type = 11)) then 1 end) as cnt_cs_wtc_dlv_new_auto_flats_reg,
        sum(case when search_query_type = 13 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_new_auto,
        sum(case when search_query_type = 14 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_new_flats,
        sum(case when search_query_type = 11 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_reg,
        sum(case when other_flags & 1 > 0 and eid = 2483 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_click_serp,
        sum(case when eid = 2749 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_confirm_serp,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_iv_serp,
        sum(case when eid = 2015 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_order_create_serp,
        sum(case when eid = 2013 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_widget_serp,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 10 and x_eid = 300 then 1 end) as cnt_fav_dlv,
        sum(case when eid in (401, 2574, 2732) and x_eid = 2743 then 1 end) as cnt_fav_from_map,
        sum(case when eid in (401, 2574, 2732) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as cnt_fav_from_map_s_area,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 400 then 1 end) as cnt_fav_list_iv,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 2 and x_eid = 300 then 1 end) as cnt_fav_premium,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_fav_push,
        sum(case when eid in (401, 2574, 2732) and x_eid = 5354 then 1 end) as cnt_fav_push_land,
        sum(case when eid in (401, 2574, 2732) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec,
        sum(case when eid in (401, 2574, 2732) and x_eid = 4386 then 1 end) as cnt_fav_rec_cv2vac,
        sum(case when eid in (401, 2574, 2732) and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 40 > 0 and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i_premium,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 4 > 0 and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i_push,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 261231 > 0 and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i_vas,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 1 > 0 and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i_vip,
        sum(case when eid in (401, 2574, 2732) and x_eid = 4126 and from_page = 'assistant' then 1 end) as cnt_fav_rec_job_ast,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 40 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec_premium,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 4 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec_push,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 1 > 0 then 1 end) as cnt_fav_rec_u2i_collab,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 16 > 0 then 1 end) as cnt_fav_rec_u2i_graph,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 40 > 0 and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i_premium,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 4 > 0 and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i_push,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 8 > 0 then 1 end) as cnt_fav_rec_u2i_similars,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 2 > 0 then 1 end) as cnt_fav_rec_u2i_user2vec,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 261231 > 0 and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i_vas,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 1 > 0 and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i_vip,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 261231 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec_vas,
        sum(case when eid in (401, 2574, 2732) and item_vas_flags & 1 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec_vip,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 9 and x_eid = 300 then 1 end) as cnt_fav_reg,
        sum(case when eid in (401, 2574, 2732) and x_eid = 300 and (search_query_type in (9, 20)) then 1 end) as cnt_fav_reg_any,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 20 and x_eid = 300 then 1 end) as cnt_fav_reg_mix,
        sum(case when eid in (401, 2574, 2732) and x_eid = 300 then 1 end) as cnt_fav_s,
        sum(case when eid in (401, 2574, 2732) and search_flags & 2 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_distr,
        sum(case when eid in (401, 2574, 2732) and search_flags & 16 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_map_area,
        sum(case when eid in (401, 2574, 2732) and search_flags & 1 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_metro,
        sum(case when eid in (401, 2574, 2732) and search_flags & 8 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_radius,
        sum(case when eid in (401, 2574, 2732) and search_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_road,
        sum(case when eid in (401, 2574, 2732) and search_flags & 64 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_saved,
        sum(case when eid in (401, 2574, 2732) and search_flags & 1024 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_u2i,
        sum(case when eid in (401, 2574, 2732) and search_flags & 16 = 0 and x_eid = 300 then 1 end) as cnt_fav_s_wo_map_area,
        sum(case when eid in (401, 2574, 2732) and x_eid = 300 and search_flags & 128 > 0 then 1 end) as cnt_fav_shopx,
        sum(case when eid in (401, 2574, 2732) and item_serp_flags & 32527 > 0 and x_eid = 300 then 1 end) as cnt_fav_vas,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 3 and x_eid = 300 then 1 end) as cnt_fav_vip,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 12 and x_eid = 300 then 1 end) as cnt_fav_wtc_dlv,
        sum(case when eid in (401, 2574, 2732) and x_eid = 300 and (search_query_type in (11, 12, 13, 14)) then 1 end) as cnt_fav_wtc_dlv_new_auto_flats_reg,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 13 and x_eid = 300 then 1 end) as cnt_fav_wtc_new_auto,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 14 and x_eid = 300 then 1 end) as cnt_fav_wtc_new_flats,
        sum(case when eid in (401, 2574, 2732) and search_query_type = 11 and x_eid = 300 then 1 end) as cnt_fav_wtc_reg,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_iv_any_ext_block,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 131072 > 0 then 1 end) as cnt_iv_cpa,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 65536 > 0 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_iv_delivery_any_ext_block,
        sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_developer_from_map,
        sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_developer_rec,
        sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_developer_rec_i2i,
        sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_developer_rec_u2i,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 10 and x_eid = 300 then 1 end) as cnt_iv_dlv,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' then 1 end) as cnt_iv_extended_profile,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' then 1 end) as cnt_iv_extended_profile_services,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_from_map,
        sum(case when eid = 301 and item_x_type = 0 and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as cnt_iv_from_map_s_area,
        sum(case when eid = 301 and item_x_type = 0 and x_from_page = 'items_ungrouped' and x_eid = 300 then 1 end) as cnt_iv_grouped,
        sum(case when eid = 301 and item_x_type = 0 and region_id in (697, 4181) and x_from_page = 'items_ungrouped' and x_eid = 300 then 1 end) as cnt_iv_grouped_doubles,
        sum(case when eid = 301 and item_x_type = 0 and x_eid is null then 1 end) as cnt_iv_no_item_attr,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 2 and x_eid = 300 then 1 end) as cnt_iv_premium,
        sum(case when (eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'public_profile' or eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'profile_services' or eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 128 > 0) then 1 end) as cnt_iv_profile_shop,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2017 and from_page = 'public_profile' then 1 end) as cnt_iv_public_profile,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_iv_push,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 5354 then 1 end) as cnt_iv_push_land,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 15 and x_eid = 300 then 1 end) as cnt_iv_qrm,
        sum(case when eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 131072 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_cpa,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 4386 then 1 end) as cnt_iv_rec_cv2vac,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i,
        sum(case when item_vas_flags & 40 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_premium,
        sum(case when item_vas_flags & 4 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_push,
        sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_vas,
        sum(case when item_vas_flags & 1 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_vip,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 4126 and from_page = 'assistant' then 1 end) as cnt_iv_rec_job_ast,
        sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 65536 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x10_1,
        sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 131072 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x10_7,
        sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 4096 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x2_1,
        sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 8192 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x2_7,
        sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 16384 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x5_1,
        sum(case when eid = 301 and item_x_type = 0 and item_vas_flags & 32768 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_perfvas_x5_7,
        sum(case when item_vas_flags & 40 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_premium,
        sum(case when item_vas_flags & 4 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_push,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 1 > 0 then 1 end) as cnt_iv_rec_u2i_collab,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 16 > 0 then 1 end) as cnt_iv_rec_u2i_graph,
        sum(case when item_vas_flags & 40 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_premium,
        sum(case when item_vas_flags & 4 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_push,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 8 > 0 then 1 end) as cnt_iv_rec_u2i_similars,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 2 > 0 then 1 end) as cnt_iv_rec_u2i_user2vec,
        sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_vas,
        sum(case when item_vas_flags & 1 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_vip,
        sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_vas,
        sum(case when item_vas_flags & 1 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_vip,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 9 and x_eid = 300 then 1 end) as cnt_iv_reg,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (9, 20)) then 1 end) as cnt_iv_reg_any,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 20 and x_eid = 300 then 1 end) as cnt_iv_reg_mix,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and item_flags & 131072 > 0 then 1 end) as cnt_iv_s_cpa,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 2 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_distr,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_flags & 768 > 0) then 1 end) as cnt_iv_s_filter_price,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 then 1 end) as cnt_iv_s_item_attr,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_map_area,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 1 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_metro,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 8 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_radius,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_road,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 64 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_saved,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 1024 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_u2i,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 = 0 and x_eid = 300 then 1 end) as cnt_iv_s_wo_map_area,
        sum(case when eid = 301 and from_page = 'witcher-seen-items' then 1 end) as cnt_iv_seen,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 8192 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x10_1,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 16384 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x10_7,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 512 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x2_1,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 1024 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x2_7,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 2048 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x5_1,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 4096 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_perfvas_x5_7,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 256 > 0 and x_eid = 300 then 1 end) as cnt_iv_serp_xl,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 128 > 0 then 1 end) as cnt_iv_shopx,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 32527 > 0 and x_eid = 300 then 1 end) as cnt_iv_vas,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 18 and x_eid = 300 then 1 end) as cnt_iv_vec,
        sum(case when eid = 301 and (x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) or x_eid = 5516) then 1 end) as cnt_iv_vertical_main,
        sum(case when eid = 301 and x_rec_engine_id = 320590750001 and x_eid = 5516 then 1 end) as cnt_iv_vertical_main_featured,
        sum(case when eid = 301 and x_rec_engine_id = 320585250001 and x_eid = 5516 then 1 end) as cnt_iv_vertical_main_rec,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 3 and x_eid = 300 then 1 end) as cnt_iv_vip,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300 then 1 end) as cnt_iv_wtc_dlv,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (11, 12, 13, 14, 16)) then 1 end) as cnt_iv_wtc_dlv_new_auto_flats_reg,
        sum(case when (from_page = 'witcher-extra-delivery' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-new-auto' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-new-flats' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-extra-regions' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 16 and x_eid = 300) then 1 end) as cnt_iv_wtc_dlv_new_auto_flats_reg_s_from,
        sum(case when (from_page = 'witcher-extra-delivery' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300) then 1 end) as cnt_iv_wtc_dlv_s_from,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300 then 1 end) as cnt_iv_wtc_new_auto,
        sum(case when (from_page = 'witcher-new-auto' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300) then 1 end) as cnt_iv_wtc_new_auto_s_from,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300 then 1 end) as cnt_iv_wtc_new_flats,
        sum(case when (from_page = 'witcher-new-flats' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300) then 1 end) as cnt_iv_wtc_new_flats_s_from,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300 then 1 end) as cnt_iv_wtc_reg,
        sum(case when (from_page = 'witcher-extra-regions' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300) then 1 end) as cnt_iv_wtc_reg_s_from,
        sum(case when eid = 308 then 1 end) as cnt_soc_btn,
        sum(case when x_eid = 400 and eid = 2483 then 1 end) as total_delivery_click_all_services_fav,
        sum(case when x_eid = 2437 and eid = 2483 then 1 end) as total_delivery_click_all_services_rec_i2i,
        sum(case when x_eid in (2012, 2309) and eid = 2483 then 1 end) as total_delivery_click_all_services_rec_u2i,
        sum(case when x_eid = 300 and eid = 2483 then 1 end) as total_delivery_click_all_services_serp,
        sum(case when x_eid = 400 and eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services_fav,
        sum(case when x_eid = 2437 and eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services_rec_i2i,
        sum(case when x_eid in (2012, 2309) and eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services_rec_u2i,
        sum(case when x_eid = 300 and eid in (2015, 4035) then 1 end) as total_delivery_contact_all_services_serp
    from buyer_stream t
    group by cookie_id, item_x
) _
;

create metrics buyer_stream_item_user_id as
select
    sum(case when bt_clicks > 0 then 1 end) as btclicked_users,
    sum(case when cnt_btc_rec > 0 then 1 end) as btclicked_users_rec,
    sum(case when cnt_btc_s > 0 then 1 end) as btclicked_users_s,
    sum(case when cnt_btc_s_noquery > 0 then 1 end) as btclicked_users_s_noq,
    sum(case when cnt_btc_s_query > 0 then 1 end) as btclicked_users_s_q
from (
    select
        cookie_id, item_user_id,
        sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as bt_clicks,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec,
        sum(case when x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s,
        sum(case when q = '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_noquery,
        sum(case when q > '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_query
    from buyer_stream t
    group by cookie_id, item_user_id
) _
;

create metrics buyer_stream_session as
select
    sum(case when cnt_btc_from_map > 0 then 1 end) as btc_sessions_from_map,
    sum(case when cnt_btc_s_map_area > 0 then 1 end) as btc_sessions_from_map_area,
    sum(case when cnt_btc_s_distr_metro_radius_road > 0 then 1 end) as buyer_target_clicks_geo_sess,
    sum(case when cnt_cs_from_map > 0 then 1 end) as contact_sessions_from_map,
    sum(case when cnt_cs_s_map_area > 0 then 1 end) as contact_sessions_from_map_area,
    sum(case when cnt_iv_from_map > 0 then 1 end) as iv_sessions_from_map,
    sum(case when cnt_iv_s_map_area > 0 then 1 end) as iv_sessions_from_map_area,
    sum(case when searches_map_area > 0 then 1 end) as map_area_sessions,
    sum(case when cnt_any_action > 0 then 1 end) as sess_any_action,
    sum(case when btc_actual_calendar > 0 then 1 end) as sess_btc_actual_calendar,
    sum(case when btc_not_actual_calendar > 0 then 1 end) as sess_btc_not_actual_calendar,
    sum(case when btc_pro_image > 0 then 1 end) as sess_btc_pro_image,
    sum(case when btc_str_flat_verified_badge > 0 then 1 end) as sess_btc_str_flat_verified_badge,
    sum(case when c_actual_calendar > 0 then 1 end) as sess_c_actual_calendar,
    sum(case when c_not_actual_calendar > 0 then 1 end) as sess_c_not_actual_calendar,
    sum(case when c_pro_image > 0 then 1 end) as sess_c_pro_image,
    sum(case when c_str_flat_verified_badge > 0 then 1 end) as sess_c_str_flat_verified_badge,
    sum(case when cnt_fatal_app_errors > 0 then 1 end) as sess_fatal_app_errors,
    sum(case when iv_actual_calendar > 0 then 1 end) as sess_iv_actual_calendar,
    sum(case when iv_not_actual_calendar > 0 then 1 end) as sess_iv_not_actual_calendar,
    sum(case when iv_pro_image > 0 then 1 end) as sess_iv_pro_image,
    sum(case when iv_str_flat_verified_badge > 0 then 1 end) as sess_iv_str_flat_verified_badge,
    sum(case when searches_metro > 0 then 1 end) as sess_metro,
    sum(case when searches_district > 0 then 1 end) as sess_searches_district,
    sum(case when searches_radius > 0 then 1 end) as sess_searches_radius,
    sum(case when searches_road > 0 then 1 end) as sess_searches_road,
    sum(case when cnt_active > 0 then 1 end) as sessions_active,
    sum(case when bt_clicks > 0 then 1 end) as sessions_btc,
    sum(case when cnt_btc_push_land > 0 then 1 end) as sessions_btc_push_land,
    sum(case when cnt_btc_rec > 0 then 1 end) as sessions_btc_r,
    sum(case when cnt_btc_rec_cv2vac > 0 then 1 end) as sessions_btc_r_cv2vac,
    sum(case when cnt_btc_rec_i2i > 0 then 1 end) as sessions_btc_r_i2i,
    sum(case when cnt_btc_job_ast > 0 then 1 end) as sessions_btc_r_job_ast,
    sum(case when cnt_btc_rec_u2i > 0 then 1 end) as sessions_btc_r_u2i,
    sum(case when cnt_btc_s_item_attr > 0 then 1 end) as sessions_btc_s,
    sum(case when cnt_btc_s_noquery > 0 then 1 end) as sessions_btc_s_noq,
    sum(case when cnt_btc_s_query > 0 then 1 end) as sessions_btc_s_q,
    sum(case when contacts > 0 then 1 end) as sessions_c,
    sum(case when cnt_cs_push_land > 0 then 1 end) as sessions_c_push_land,
    sum(case when cnt_cs_rec > 0 then 1 end) as sessions_c_r,
    sum(case when cnt_cs_rec_cv2vac > 0 then 1 end) as sessions_c_r_cv2vac,
    sum(case when cnt_cs_rec_i2i > 0 then 1 end) as sessions_c_r_i2i,
    sum(case when cnt_c_rec_job_ast > 0 then 1 end) as sessions_c_r_job_ast,
    sum(case when cnt_cs_rec_u2i > 0 then 1 end) as sessions_c_r_u2i,
    sum(case when cnt_cs_s_item_attr > 0 then 1 end) as sessions_c_s,
    sum(case when cnt_s_noquery_c > 0 then 1 end) as sessions_c_s_noq,
    sum(case when cnt_s_query_c > 0 then 1 end) as sessions_c_s_q,
    sum(case when item_views > 0 then 1 end) as sessions_iv,
    sum(case when cnt_iv_push_land > 0 then 1 end) as sessions_iv_push_land,
    sum(case when cnt_iv_rec > 0 then 1 end) as sessions_iv_r,
    sum(case when cnt_iv_rec_cv2vac > 0 then 1 end) as sessions_iv_r_cv2vac,
    sum(case when cnt_iv_rec_i2i > 0 then 1 end) as sessions_iv_r_i2i,
    sum(case when cnt_iv_rec_job_ast > 0 then 1 end) as sessions_iv_r_job_ast,
    sum(case when cnt_iv_rec_u2i > 0 then 1 end) as sessions_iv_r_u2i,
    sum(case when cnt_iv_s_item_attr > 0 then 1 end) as sessions_iv_s,
    sum(case when cnt_s_noquery_iv > 0 then 1 end) as sessions_iv_s_noq,
    sum(case when cnt_s_query_iv > 0 then 1 end) as sessions_iv_s_q,
    sum(case when searches > 0 then 1 end) as sessions_s,
    sum(case when cnt_cs_from_map_s_area > 0 then 1 end) as unq_session_cs_from_map_s_area,
    sum(case when cnt_cs_rec_s > 0 then 1 end) as unq_session_cs_rec_s,
    sum(case when cnt_iv_from_map_s_area > 0 then 1 end) as unq_session_iv_from_map_s_area,
    sum(case when cnt_iv_rec_s > 0 then 1 end) as unq_session_iv_rec_s,
    sum(case when push_land_shows > 0 then 1 end) as unq_session_push_land_shows,
    sum(case when recblock_shows > 0 then 1 end) as unq_session_recblock_shows,
    sum(case when recblock_shows_cv2vac > 0 then 1 end) as unq_session_recblock_shows_cv2vac,
    sum(case when recblock_shows_i2i > 0 then 1 end) as unq_session_recblock_shows_i2i,
    sum(case when recblock_shows_u2i > 0 then 1 end) as unq_session_recblock_shows_u2i,
    sum(case when searches_geo > 0 then 1 end) as unq_session_s_distr_metro_radius_road,
    sum(case when search_q > 0 then 1 end) as unq_session_s_query,
    sum(case when cnt_s_without_query > 0 then 1 end) as unq_session_s_without_query
from (
    select
        cookie_id, session,
        sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as bt_clicks,
        sum(case when item_flags & 2 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_actual_calendar,
        sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_not_actual_calendar,
        sum(case when item_flags & 1 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_pro_image,
        sum(case when item_flags & 16777216 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_str_flat_verified_badge,
        sum(case when item_flags & 2 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_actual_calendar,
        sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_not_actual_calendar,
        sum(case when item_flags & 1 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_pro_image,
        sum(case when item_flags & 16777216 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_str_flat_verified_badge,
        sum(case when (page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) or eid in (301, 303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813)) then 1 end) as cnt_active,
        sum(1) as cnt_any_action,
        sum(case when x_eid = 2743 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_from_map,
        sum(case when x_eid = 4126 and from_page = 'assistant' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_job_ast,
        sum(case when x_eid = 5354 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_push_land,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec,
        sum(case when x_eid = 4386 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_cv2vac,
        sum(case when x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_i2i,
        sum(case when x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 8 > 0 or search_flags & 4 > 0)) then 1 end) as cnt_btc_s_distr_metro_radius_road,
        sum(case when x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_item_attr,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_map_area,
        sum(case when q = '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_noquery,
        sum(case when q > '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_query,
        sum(case when x_eid = 4126 and from_page = 'assistant' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_c_rec_job_ast,
        sum(case when x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_from_map,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_cs_from_map_s_area,
        sum(case when x_eid = 5354 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_push_land,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec,
        sum(case when x_eid = 4386 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_cv2vac,
        sum(case when x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and ((search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) or x_eid = 300)) then 1 end) as cnt_cs_rec_s,
        sum(case when x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i,
        sum(case when x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_item_attr,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_map_area,
        sum(case when eid = 3456 then 1 end) as cnt_fatal_app_errors,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_from_map,
        sum(case when eid = 301 and item_x_type = 0 and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as cnt_iv_from_map_s_area,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 5354 then 1 end) as cnt_iv_push_land,
        sum(case when eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 4386 then 1 end) as cnt_iv_rec_cv2vac,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 4126 and from_page = 'assistant' then 1 end) as cnt_iv_rec_job_ast,
        sum(case when eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (300, 2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_s,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 then 1 end) as cnt_iv_s_item_attr,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_map_area,
        sum(case when q = '' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_noquery_c,
        sum(case when eid = 301 and item_x_type = 0 and q = '' and x_eid = 300 then 1 end) as cnt_s_noquery_iv,
        sum(case when q > '' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_query_c,
        sum(case when eid = 301 and item_x_type = 0 and q > '' and x_eid = 300 then 1 end) as cnt_s_query_iv,
        sum(case when eid = 300 and q = '' and (onmap = 0 or platform_id != 1) then 1 end) as cnt_s_without_query,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contacts,
        sum(case when eid = 301 then 1 end) as item_views,
        sum(case when item_flags & 2 > 0 and eid = 301 then 1 end) as iv_actual_calendar,
        sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid = 301 then 1 end) as iv_not_actual_calendar,
        sum(case when item_flags & 1 > 0 and eid = 301 then 1 end) as iv_pro_image,
        sum(case when item_flags & 16777216 > 0 and eid = 301 then 1 end) as iv_str_flat_verified_badge,
        sum(case when eid = 5354 then 1 end) as push_land_shows,
        sum(case when (eid in (2012, 2309, 2437, 4126, 4386) or search_flags & 1024 > 0) then 1 end) as recblock_shows,
        sum(case when eid = 4386 then 1 end) as recblock_shows_cv2vac,
        sum(case when eid = 2437 then 1 end) as recblock_shows_i2i,
        sum(case when eid in (2012, 2309) then 1 end) as recblock_shows_u2i,
        sum(case when eid = 300 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as search_q,
        sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches,
        sum(case when page_no = 0 and search_flags & 2 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_district,
        sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 8 > 0 or search_flags & 4 > 0)) then 1 end) as searches_geo,
        sum(case when page_no = 0 and search_flags & 16 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_map_area,
        sum(case when page_no = 0 and search_flags & 1 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_metro,
        sum(case when page_no = 0 and search_flags & 8 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_radius,
        sum(case when page_no = 0 and search_flags & 4 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_road
    from buyer_stream t
    group by cookie_id, session
) _
;

create metrics buyer_stream_cookie as
select
    sum(case when contacts > 0 then 1 end) as buyers,
    sum(case when cnt_cs_from_map > 0 then 1 end) as buyers_from_map,
    sum(case when cnt_cs_s_map_area > 0 then 1 end) as buyers_from_map_area,
    sum(case when cnt_cs_from_map_s_area > 0 then 1 end) as buyers_from_map_total,
    sum(case when cnt_cs_s_wo_map_area > 0 then 1 end) as buyers_from_serp_wo_map_area,
    sum(case when contact_imv_re_good > 0 then 1 end) as buyers_imv_re_good,
    sum(case when contact_imv_re_high > 0 then 1 end) as buyers_imv_re_high,
    sum(case when contact_imv_re_low > 0 then 1 end) as buyers_imv_re_low,
    sum(case when contact_imv_re_no_label > 0 then 1 end) as buyers_imv_re_no_label,
    sum(case when contact_in_stock > 0 then 1 end) as buyers_in_stock,
    sum(case when contact_part_qual_compab > 0 then 1 end) as buyers_part_qual_compab,
    sum(case when contact_part_qual_exists > 0 then 1 end) as buyers_part_qual_exists,
    sum(case when contact_part_qual_unknown > 0 then 1 end) as buyers_part_qual_unknown,
    sum(case when contact_to_order > 0 then 1 end) as buyers_to_order,
    sum(case when contacts_total_vas > 0 then 1 end) as buyers_vas,
    sum(case when contacts_videocalls > 0 then 1 end) as buyers_videocalls,
    sum(case when searches_map_area > 0 then 1 end) as map_area_users,
    sum(case when shortcut_clicks > 0 then 1 end) as shortcut_users,
    sum(case when phone_views_total > 0 then 1 end) as unq_ph,
    sum(case when booking_created_short_rent > 0 then 1 end) as user_booking_created_short_rent,
    sum(case when btc_actual_calendar > 0 then 1 end) as user_btc_actual_calendar,
    sum(case when btc_developer > 0 then 1 end) as user_btc_developer,
    sum(case when cnt_btc_from_map_s_area > 0 then 1 end) as user_btc_from_map_total,
    sum(case when cnt_btc_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as user_btc_from_witcher_any,
    sum(case when cnt_btc_wtc_new_auto > 0 then 1 end) as user_btc_from_witcher_auto,
    sum(case when cnt_btc_wtc_dlv > 0 then 1 end) as user_btc_from_witcher_del,
    sum(case when cnt_btc_wtc_new_flats > 0 then 1 end) as user_btc_from_witcher_flats,
    sum(case when cnt_btc_wtc_reg > 0 then 1 end) as user_btc_from_witcher_reg,
    sum(case when btc_leadgen_item > 0 then 1 end) as user_btc_leadgen_item,
    sum(case when btc_map_or_s > 0 then 1 end) as user_btc_map_or_s,
    sum(case when btc_multiloc > 0 then 1 end) as user_btc_multiloc,
    sum(case when btc_multiloc_reg > 0 then 1 end) as user_btc_multiloc_reg,
    sum(case when cnt_btc_new_from_map_s_area > 0 then 1 end) as user_btc_new_from_map_total,
    sum(case when btc_new_map_or_s > 0 then 1 end) as user_btc_new_map_or_s,
    sum(case when cnt_btc_new_rec_i2i > 0 then 1 end) as user_btc_new_rec_i2i,
    sum(case when cnt_btc_new_rec_u2i > 0 then 1 end) as user_btc_new_rec_u2i,
    sum(case when cnt_btc_s_noquery > 0 then 1 end) as user_btc_noq,
    sum(case when btc_not_actual_calendar > 0 then 1 end) as user_btc_not_actual_calendar,
    sum(case when btc_pro_image > 0 then 1 end) as user_btc_pro_image,
    sum(case when cnt_btc_push_land > 0 then 1 end) as user_btc_push_land,
    sum(case when cnt_btc_rec_cv2vac > 0 then 1 end) as user_btc_rec_cv2vac,
    sum(case when cnt_btc_rec_i2i > 0 then 1 end) as user_btc_rec_i2i,
    sum(case when cnt_btc_rec_u2i > 0 then 1 end) as user_btc_rec_u2i,
    sum(case when cnt_btc_rec_u2i_collab > 0 then 1 end) as user_btc_rec_u2i_collab,
    sum(case when cnt_btc_rec_u2i_graph > 0 then 1 end) as user_btc_rec_u2i_graph,
    sum(case when cnt_btc_rec_u2i_similars > 0 then 1 end) as user_btc_rec_u2i_similars,
    sum(case when cnt_btc_rec_u2i_user2vec > 0 then 1 end) as user_btc_rec_u2i_user2vec,
    sum(case when cnt_btc_old_rec_i2i > 0 then 1 end) as user_btc_returned_rec_i2i,
    sum(case when cnt_btc_old_rec_u2i > 0 then 1 end) as user_btc_returned_rec_u2i,
    sum(case when btc_s_multiloc > 0 then 1 end) as user_btc_s_multiloc,
    sum(case when cnt_btc_s_query > 0 then 1 end) as user_btc_sq,
    sum(case when btc_str_flat_verified_badge > 0 then 1 end) as user_btc_str_flat_verified_badge,
    sum(case when btc_str_online_booking_items > 0 then 1 end) as user_btc_str_online_booking_items,
    sum(case when btc_witcher_funnel_any > 0 then 1 end) as user_btc_witcher_funnel_any,
    sum(case when btc_witcher_funnel_delivery > 0 then 1 end) as user_btc_witcher_funnel_delivery,
    sum(case when btc_witcher_funnel_new_auto > 0 then 1 end) as user_btc_witcher_funnel_new_auto,
    sum(case when btc_witcher_funnel_new_flats > 0 then 1 end) as user_btc_witcher_funnel_new_flats,
    sum(case when btc_witcher_funnel_regions > 0 then 1 end) as user_btc_witcher_funnel_regions,
    sum(case when fav_with_multilocs > 0 then 1 end) as user_btc_with_multilocs,
    sum(case when cnt_btc_any_ext_block > 0 then 1 end) as user_buyer_target_clicks_any_ext_block,
    sum(case when cnt_btc_cpa > 0 then 1 end) as user_buyer_target_clicks_cpa,
    sum(case when cnt_btc_dlv > 0 then 1 end) as user_buyer_target_clicks_delivery,
    sum(case when cnt_btc_new_any_ext_block > 0 then 1 end) as user_buyer_target_clicks_new_any_ext_block,
    sum(case when cnt_btc_new_dlv > 0 then 1 end) as user_buyer_target_clicks_new_delivery,
    sum(case when cnt_btc_new_reg > 0 then 1 end) as user_buyer_target_clicks_new_regions,
    sum(case when cnt_btc_qrm > 0 then 1 end) as user_buyer_target_clicks_quorum,
    sum(case when cnt_btc_rec_cpa > 0 then 1 end) as user_buyer_target_clicks_rec_cpa,
    sum(case when cnt_btc_reg > 0 then 1 end) as user_buyer_target_clicks_regions,
    sum(case when cnt_btc_reg_any > 0 then 1 end) as user_buyer_target_clicks_regions_any,
    sum(case when cnt_btc_reg_mix > 0 then 1 end) as user_buyer_target_clicks_regions_mix,
    sum(case when cnt_btc_old_any_ext_block > 0 then 1 end) as user_buyer_target_clicks_returned_any_ext_block,
    sum(case when cnt_btc_s_cpa > 0 then 1 end) as user_buyer_target_clicks_s_cpa,
    sum(case when cnt_btc_s_saved > 0 then 1 end) as user_buyer_target_clicks_serp_saved,
    sum(case when cnt_btc_shopx > 0 then 1 end) as user_buyer_target_clicks_shop,
    sum(case when cnt_btc_vec > 0 then 1 end) as user_buyer_target_clicks_vector,
    sum(case when c_actual_calendar > 0 then 1 end) as user_c_actual_calendar,
    sum(case when c_developer > 0 then 1 end) as user_c_developer,
    sum(case when cnt_cs_developer_from_map > 0 then 1 end) as user_c_developer_map,
    sum(case when cnt_cs_developer_rec > 0 then 1 end) as user_c_developer_rec,
    sum(case when c_developer_search > 0 then 1 end) as user_c_developer_search,
    sum(case when contacts_from_suggest > 0 then 1 end) as user_c_from_suggest,
    sum(case when cnt_cs_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as user_c_from_witcher_any,
    sum(case when cnt_cs_wtc_new_auto > 0 then 1 end) as user_c_from_witcher_auto,
    sum(case when cnt_cs_wtc_dlv > 0 then 1 end) as user_c_from_witcher_del,
    sum(case when cnt_cs_wtc_new_flats > 0 then 1 end) as user_c_from_witcher_flats,
    sum(case when cnt_cs_wtc_reg > 0 then 1 end) as user_c_from_witcher_reg,
    sum(case when contacts_item_pessimized > 0 then 1 end) as user_c_item_pessimized,
    sum(case when contacts_item_pessimized_map > 0 then 1 end) as user_c_item_pessimized_map,
    sum(case when contacts_item_pessimized_map_serp > 0 then 1 end) as user_c_item_pessimized_map_serp,
    sum(case when contacts_item_pessimized_map_total > 0 then 1 end) as user_c_item_pessimized_map_total,
    sum(case when contacts_item_pessimized_rec > 0 then 1 end) as user_c_item_pessimized_rec,
    sum(case when contacts_item_pessimized_serp > 0 then 1 end) as user_c_item_pessimized_serp,
    sum(case when c_leadgen_item > 0 then 1 end) as user_c_leadgen_item,
    sum(case when c_map_or_s > 0 then 1 end) as user_c_map_or_s,
    sum(case when c_msg_str_online_booking_items > 0 then 1 end) as user_c_msg_str_online_booking_items,
    sum(case when c_multiloc > 0 then 1 end) as user_c_multiloc,
    sum(case when c_multiloc_reg > 0 then 1 end) as user_c_multiloc_reg,
    sum(case when c_multiloc_vertical_defined > 0 then 1 end) as user_c_multiloc_vertical_defined,
    sum(case when c_multiloc_vertical_undefined > 0 then 1 end) as user_c_multiloc_vertical_undefined,
    sum(case when c_not_actual_calendar > 0 then 1 end) as user_c_not_actual_calendar,
    sum(case when contacts_pessimized > 0 then 1 end) as user_c_pessimized,
    sum(case when contacts_pessimized_map > 0 then 1 end) as user_c_pessimized_map,
    sum(case when contacts_pessimized_map_serp > 0 then 1 end) as user_c_pessimized_map_serp,
    sum(case when contacts_pessimized_map_total > 0 then 1 end) as user_c_pessimized_map_total,
    sum(case when contacts_pessimized_rec > 0 then 1 end) as user_c_pessimized_rec,
    sum(case when contacts_pessimized_serp > 0 then 1 end) as user_c_pessimized_serp,
    sum(case when c_pro_image > 0 then 1 end) as user_c_pro_image,
    sum(case when c_s_multiloc > 0 then 1 end) as user_c_s_multiloc,
    sum(case when c_s_vertical_defined > 0 then 1 end) as user_c_s_vertical_defined,
    sum(case when c_s_vertical_undefined > 0 then 1 end) as user_c_s_vertical_undefined,
    sum(case when contacts_seller_pessimized > 0 then 1 end) as user_c_seller_pessimized,
    sum(case when contacts_seller_pessimized_map > 0 then 1 end) as user_c_seller_pessimized_map,
    sum(case when contacts_seller_pessimized_map_serp > 0 then 1 end) as user_c_seller_pessimized_map_serp,
    sum(case when contacts_seller_pessimized_map_total > 0 then 1 end) as user_c_seller_pessimized_map_total,
    sum(case when contacts_seller_pessimized_rec > 0 then 1 end) as user_c_seller_pessimized_rec,
    sum(case when contacts_seller_pessimized_serp > 0 then 1 end) as user_c_seller_pessimized_serp,
    sum(case when c_str_flat_verified_badge > 0 then 1 end) as user_c_str_flat_verified_badge,
    sum(case when c_str_online_booking_items > 0 then 1 end) as user_c_str_online_booking_items,
    sum(case when c_witcher_funnel_any > 0 then 1 end) as user_c_witcher_funnel_any,
    sum(case when c_witcher_funnel_delivery > 0 then 1 end) as user_c_witcher_funnel_delivery,
    sum(case when c_witcher_funnel_new_auto > 0 then 1 end) as user_c_witcher_funnel_new_auto,
    sum(case when c_witcher_funnel_new_flats > 0 then 1 end) as user_c_witcher_funnel_new_flats,
    sum(case when c_witcher_funnel_regions > 0 then 1 end) as user_c_witcher_funnel_regions,
    sum(case when c_with_multilocs > 0 then 1 end) as user_c_with_multilocs,
    sum(case when c_with_multilocs_vertical_defined > 0 then 1 end) as user_c_with_multilocs_vertical_defined,
    sum(case when c_with_multilocs_vertical_undefined > 0 then 1 end) as user_c_with_multilocs_vertical_undefined,
    sum(case when cnt_cs_any_ext_block > 0 then 1 end) as user_contacts_any_ext_block,
    sum(case when cnt_cs_cpa > 0 then 1 end) as user_contacts_cpa,
    sum(case when cnt_cs_dlv > 0 then 1 end) as user_contacts_delivery,
    sum(case when cnt_cs_qrm > 0 then 1 end) as user_contacts_quorum,
    sum(case when cnt_cs_rec_cpa > 0 then 1 end) as user_contacts_rec_cpa,
    sum(case when cnt_cs_reg > 0 then 1 end) as user_contacts_regions,
    sum(case when cnt_cs_reg_any > 0 then 1 end) as user_contacts_regions_any,
    sum(case when cnt_cs_reg_mix > 0 then 1 end) as user_contacts_regions_mix,
    sum(case when cnt_cs_s_cpa > 0 then 1 end) as user_contacts_s_cpa,
    sum(case when cnt_cs_s_saved > 0 then 1 end) as user_contacts_serp_saved,
    sum(case when cnt_cs_shopx > 0 then 1 end) as user_contacts_shop,
    sum(case when cnt_cs_vec > 0 then 1 end) as user_contacts_vector,
    sum(case when total_courier_btc > 0 then 1 end) as user_courier_btc,
    sum(case when total_delivery_btc > 0 then 1 end) as user_delivery_btc,
    sum(case when total_delivery_click > 0 then 1 end) as user_delivery_click,
    sum(case when total_delivery_click_wo_messenger > 0 then 1 end) as user_delivery_click_wo_messenger,
    sum(case when total_delivery_confirm > 0 then 1 end) as user_delivery_confirm,
    sum(case when total_delivery_contact > 0 then 1 end) as user_delivery_contact,
    sum(case when total_delivery_item_contact > 0 then 1 end) as user_delivery_item_contact,
    sum(case when delivery_total_item_view > 0 then 1 end) as user_delivery_item_view,
    sum(case when cnt_delivery_order_create_serp > 0 then 1 end) as user_delivery_order_create_serp,
    sum(case when total_delivery_widget > 0 then 1 end) as user_delivery_widget,
    sum(case when cnt_fav_push_land > 0 then 1 end) as user_fav_added_push_land,
    sum(case when cnt_fav_rec > 0 then 1 end) as user_fav_added_rec,
    sum(case when cnt_fav_rec_cv2vac > 0 then 1 end) as user_fav_added_rec_cv2vac,
    sum(case when cnt_fav_rec_i2i > 0 then 1 end) as user_fav_added_rec_i2i,
    sum(case when cnt_fav_rec_job_ast > 0 then 1 end) as user_fav_added_rec_job_ast,
    sum(case when cnt_fav_rec_u2i > 0 then 1 end) as user_fav_added_rec_u2i,
    sum(case when cnt_fav_rec_u2i_collab > 0 then 1 end) as user_fav_added_rec_u2i_collab,
    sum(case when cnt_fav_rec_u2i_graph > 0 then 1 end) as user_fav_added_rec_u2i_graph,
    sum(case when cnt_fav_rec_u2i_similars > 0 then 1 end) as user_fav_added_rec_u2i_similars,
    sum(case when cnt_fav_rec_u2i_user2vec > 0 then 1 end) as user_fav_added_rec_u2i_user2vec,
    sum(case when cnt_fav_s > 0 then 1 end) as user_fav_added_serp,
    sum(case when cnt_fav_s_saved > 0 then 1 end) as user_fav_added_serp_saved,
    sum(case when cnt_fav_shopx > 0 then 1 end) as user_fav_added_shop,
    sum(case when cnt_fav_from_map_s_area > 0 then 1 end) as user_fav_from_map_total,
    sum(case when fav_map_or_s > 0 then 1 end) as user_fav_map_or_s,
    sum(case when fav_multiloc > 0 then 1 end) as user_fav_multiloc,
    sum(case when fav_multiloc_reg > 0 then 1 end) as user_fav_multiloc_reg,
    sum(case when fav_s_multiloc > 0 then 1 end) as user_fav_s_multiloc,
    sum(case when fav_witcher_funnel_any > 0 then 1 end) as user_fav_witcher_funnel_any,
    sum(case when fav_witcher_funnel_delivery > 0 then 1 end) as user_fav_witcher_funnel_delivery,
    sum(case when fav_witcher_funnel_new_auto > 0 then 1 end) as user_fav_witcher_funnel_new_auto,
    sum(case when fav_witcher_funnel_new_flats > 0 then 1 end) as user_fav_witcher_funnel_new_flats,
    sum(case when fav_witcher_funnel_regions > 0 then 1 end) as user_fav_witcher_funnel_regions,
    sum(case when btc_with_multilocs > 0 then 1 end) as user_fav_with_multilocs,
    sum(case when favorites_added_from_jk_card > 0 then 1 end) as user_favorites_added_from_jk_card,
    sum(case when favorites_list_views > 0 then 1 end) as user_favorites_list_views,
    sum(case when favorites_removed > 0 then 1 end) as user_favorites_removed,
    sum(case when cnt_iv_from_map_s_area > 0 then 1 end) as user_item_view_from_map_total,
    sum(case when cnt_iv_any_ext_block > 0 then 1 end) as user_item_views_any_ext_block,
    sum(case when cnt_iv_dlv > 0 then 1 end) as user_item_views_delivery,
    sum(case when item_views_from_jk_card > 0 then 1 end) as user_item_views_from_jk_card,
    sum(case when cnt_iv_qrm > 0 then 1 end) as user_item_views_quorum,
    sum(case when cnt_iv_reg > 0 then 1 end) as user_item_views_regions,
    sum(case when cnt_iv_reg_any > 0 then 1 end) as user_item_views_regions_any,
    sum(case when cnt_iv_reg_mix > 0 then 1 end) as user_item_views_regions_mix,
    sum(case when cnt_iv_s_saved > 0 then 1 end) as user_item_views_serp_saved,
    sum(case when cnt_iv_shopx > 0 then 1 end) as user_item_views_shop,
    sum(case when item_views_total_premium > 0 then 1 end) as user_item_views_total_premium,
    sum(case when item_views_total_push > 0 then 1 end) as user_item_views_total_push,
    sum(case when item_views_total_vas > 0 then 1 end) as user_item_views_total_vas,
    sum(case when item_views_total_vip > 0 then 1 end) as user_item_views_total_vip,
    sum(case when cnt_used_cars_views > 0 then 1 end) as user_item_views_used_cars,
    sum(case when cnt_iv_vec > 0 then 1 end) as user_item_views_vector,
    sum(case when iv_actual_calendar > 0 then 1 end) as user_iv_actual_calendar,
    sum(case when cnt_iv_cpa > 0 then 1 end) as user_iv_cpa,
    sum(case when iv_developer > 0 then 1 end) as user_iv_developer,
    sum(case when cnt_iv_developer_from_map > 0 then 1 end) as user_iv_developer_map,
    sum(case when cnt_iv_developer_rec > 0 then 1 end) as user_iv_developer_rec,
    sum(case when iv_developer_search > 0 then 1 end) as user_iv_developer_search,
    sum(case when item_views_from_suggest > 0 then 1 end) as user_iv_from_suggest,
    sum(case when cnt_iv_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as user_iv_from_witcher_any,
    sum(case when cnt_iv_wtc_new_auto > 0 then 1 end) as user_iv_from_witcher_auto,
    sum(case when cnt_iv_wtc_dlv > 0 then 1 end) as user_iv_from_witcher_del,
    sum(case when cnt_iv_wtc_new_flats > 0 then 1 end) as user_iv_from_witcher_flats,
    sum(case when cnt_iv_wtc_reg > 0 then 1 end) as user_iv_from_witcher_reg,
    sum(case when iv_imv_re_good > 0 then 1 end) as user_iv_imv_re_good,
    sum(case when iv_imv_re_high > 0 then 1 end) as user_iv_imv_re_high,
    sum(case when iv_imv_re_low > 0 then 1 end) as user_iv_imv_re_low,
    sum(case when iv_imv_re_no_label > 0 then 1 end) as user_iv_imv_re_no_label,
    sum(case when item_views_in_stock > 0 then 1 end) as user_iv_in_stock,
    sum(case when item_views_item_pessimized > 0 then 1 end) as user_iv_item_pessimized,
    sum(case when item_views_item_pessimized_map > 0 then 1 end) as user_iv_item_pessimized_map,
    sum(case when item_views_item_pessimized_map_serp > 0 then 1 end) as user_iv_item_pessimized_map_serp,
    sum(case when item_views_item_pessimized_map_total > 0 then 1 end) as user_iv_item_pessimized_map_total,
    sum(case when item_views_item_pessimized_rec > 0 then 1 end) as user_iv_item_pessimized_rec,
    sum(case when item_views_item_pessimized_serp > 0 then 1 end) as user_iv_item_pessimized_serp,
    sum(case when iv_leadgen_item > 0 then 1 end) as user_iv_leadgen_item,
    sum(case when iv_map_or_s > 0 then 1 end) as user_iv_map_or_s,
    sum(case when iv_multiloc > 0 then 1 end) as user_iv_multiloc,
    sum(case when iv_multiloc_reg > 0 then 1 end) as user_iv_multiloc_reg,
    sum(case when iv_multiloc_vertical_defined > 0 then 1 end) as user_iv_multiloc_vertical_defined,
    sum(case when iv_multiloc_vertical_undefined > 0 then 1 end) as user_iv_multiloc_vertical_undefined,
    sum(case when iv_not_actual_calendar > 0 then 1 end) as user_iv_not_actual_calendar,
    sum(case when item_views_part_qual_compab > 0 then 1 end) as user_iv_part_qual_compab,
    sum(case when item_views_part_qual_exists > 0 then 1 end) as user_iv_part_qual_exists,
    sum(case when item_views_part_qual_unknown > 0 then 1 end) as user_iv_part_qual_unknown,
    sum(case when item_views_pessimized > 0 then 1 end) as user_iv_pessimized,
    sum(case when item_views_pessimized_map > 0 then 1 end) as user_iv_pessimized_map,
    sum(case when item_views_pessimized_map_serp > 0 then 1 end) as user_iv_pessimized_map_serp,
    sum(case when item_views_pessimized_map_total > 0 then 1 end) as user_iv_pessimized_map_total,
    sum(case when item_views_pessimized_rec > 0 then 1 end) as user_iv_pessimized_rec,
    sum(case when item_views_pessimized_serp > 0 then 1 end) as user_iv_pessimized_serp,
    sum(case when iv_pro_image > 0 then 1 end) as user_iv_pro_image,
    sum(case when cnt_iv_rec_cpa > 0 then 1 end) as user_iv_rec_cpa,
    sum(case when cnt_iv_s_cpa > 0 then 1 end) as user_iv_s_cpa,
    sum(case when iv_s_multiloc > 0 then 1 end) as user_iv_s_multiloc,
    sum(case when iv_s_vertical_defined > 0 then 1 end) as user_iv_s_vertical_defined,
    sum(case when iv_s_vertical_undefined > 0 then 1 end) as user_iv_s_vertical_undefined,
    sum(case when cnt_iv_seen > 0 then 1 end) as user_iv_seen,
    sum(case when item_views_seller_pessimized > 0 then 1 end) as user_iv_seller_pessimized,
    sum(case when item_views_seller_pessimized_map > 0 then 1 end) as user_iv_seller_pessimized_map,
    sum(case when item_views_seller_pessimized_map_serp > 0 then 1 end) as user_iv_seller_pessimized_map_serp,
    sum(case when item_views_seller_pessimized_map_total > 0 then 1 end) as user_iv_seller_pessimized_map_total,
    sum(case when item_views_seller_pessimized_rec > 0 then 1 end) as user_iv_seller_pessimized_rec,
    sum(case when item_views_seller_pessimized_serp > 0 then 1 end) as user_iv_seller_pessimized_serp,
    sum(case when iv_str_flat_verified_badge > 0 then 1 end) as user_iv_str_flat_verified_badge,
    sum(case when iv_str_online_booking_items > 0 then 1 end) as user_iv_str_online_booking_items,
    sum(case when item_views_to_order > 0 then 1 end) as user_iv_to_order,
    sum(case when iv_witcher_funnel_any > 0 then 1 end) as user_iv_witcher_funnel_any,
    sum(case when iv_witcher_funnel_delivery > 0 then 1 end) as user_iv_witcher_funnel_delivery,
    sum(case when iv_witcher_funnel_new_auto > 0 then 1 end) as user_iv_witcher_funnel_new_auto,
    sum(case when iv_witcher_funnel_new_flats > 0 then 1 end) as user_iv_witcher_funnel_new_flats,
    sum(case when iv_witcher_funnel_regions > 0 then 1 end) as user_iv_witcher_funnel_regions,
    sum(case when iv_with_multilocs > 0 then 1 end) as user_iv_with_multilocs,
    sum(case when iv_with_multilocs_vertical_defined > 0 then 1 end) as user_iv_with_multilocs_vertical_defined,
    sum(case when iv_with_multilocs_vertical_undefined > 0 then 1 end) as user_iv_with_multilocs_vertical_undefined,
    sum(case when cnt_s_without_query > 0 then 1 end) as user_noq,
    sum(case when push_land_shows > 0 then 1 end) as user_push_land_shows,
    sum(case when cnt_ph_realty_development > 0 then 1 end) as user_pv,
    sum(case when realty_dev_views_cat_jk_serp > 0 then 1 end) as user_realty_dev_views_cat_jk_serp,
    sum(case when realty_dev_views_item > 0 then 1 end) as user_realty_dev_views_item,
    sum(case when realty_dev_views_item_button > 0 then 1 end) as user_realty_dev_views_item_button,
    sum(case when realty_dev_views_item_name > 0 then 1 end) as user_realty_dev_views_item_name,
    sum(case when realty_dev_views_map > 0 then 1 end) as user_realty_dev_views_map,
    sum(case when realty_dev_views_rec > 0 then 1 end) as user_realty_dev_views_rec,
    sum(case when recblock_shows > 0 then 1 end) as user_recblock_shows,
    sum(case when recblock_shows_cv2vac > 0 then 1 end) as user_recblock_shows_cv2vac,
    sum(case when recblock_shows_i2i > 0 then 1 end) as user_recblock_shows_i2i,
    sum(case when recblock_shows_u2i > 0 then 1 end) as user_recblock_shows_u2i,
    sum(case when searches_from_suggest > 0 then 1 end) as user_s_from_suggest,
    sum(case when searches_from_witcher_any > 0 then 1 end) as user_s_from_witcher_any,
    sum(case when searches_from_witcher_new_auto > 0 then 1 end) as user_s_from_witcher_auto,
    sum(case when searches_from_witcher_delivery > 0 then 1 end) as user_s_from_witcher_del,
    sum(case when searches_from_witcher_new_flats > 0 then 1 end) as user_s_from_witcher_flats,
    sum(case when searches_from_witcher_regions > 0 then 1 end) as user_s_from_witcher_reg,
    sum(case when s_localpriority > 0 then 1 end) as user_s_localpriority,
    sum(case when s_map_or_s > 0 then 1 end) as user_s_map_or_s,
    sum(case when s_multiloc > 0 then 1 end) as user_s_multiloc,
    sum(case when searches_shop > 0 then 1 end) as user_searches_shop,
    sum(case when searches_shop_empty > 0 then 1 end) as user_searches_shop_empty,
    sum(case when searches_shop_small > 0 then 1 end) as user_searches_shop_small,
    sum(case when cnt_soc_btn > 0 then 1 end) as user_soc_btn,
    sum(case when search_q > 0 then 1 end) as user_sq,
    sum(case when cnt_s_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as user_witcher_any,
    sum(case when searches_witcher_new_auto > 0 then 1 end) as user_witcher_auto,
    sum(case when cnt_s_wtc_dlv > 0 then 1 end) as user_witcher_del,
    sum(case when searches_witcher_new_flats > 0 then 1 end) as user_witcher_flats,
    sum(case when searches_witcher_regions > 0 then 1 end) as user_witcher_reg,
    sum(case when cnt_iv_wtc_dlv_new_auto_flats_reg_s_from > 0 then 1 end) as user_wtc_from_witcher_any,
    sum(case when cnt_iv_wtc_new_auto_s_from > 0 then 1 end) as user_wtc_from_witcher_auto,
    sum(case when cnt_iv_wtc_dlv_s_from > 0 then 1 end) as user_wtc_from_witcher_del,
    sum(case when cnt_iv_wtc_new_flats_s_from > 0 then 1 end) as user_wtc_from_witcher_flats,
    sum(case when cnt_iv_wtc_reg_s_from > 0 then 1 end) as user_wtc_from_witcher_reg,
    sum(case when cnt_active > 1 then 1 end) as users_1plus_actions,
    sum(case when cnt_active > 2 then 1 end) as users_2plus_actions,
    sum(case when cnt_active > 0 then 1 end) as users_active_daily,
    sum(case when all_main_pages > 0 then 1 end) as users_all_main_page_daily,
    sum(case when cnt_any_action > 0 then 1 end) as users_any_action_daily,
    sum(case when bt_clicks > 0 then 1 end) as users_bt_click_daily,
    sum(case when bt_clicks_new > 0 then 1 end) as users_bt_click_new,
    sum(case when bt_clicks_returned > 0 then 1 end) as users_bt_click_returned,
    sum(case when buyer_target_clicks_metageo > 0 then 1 end) as users_btc_metageo,
    sum(case when cnt_btc_views_s_filter_price > 0 then 1 end) as users_btc_search_filter_any,
    sum(case when cnt_btc_from_map > 0 then 1 end) as users_buyer_target_click_from_map,
    sum(case when cnt_btc_s_map_area > 0 then 1 end) as users_buyer_target_click_from_map_area,
    sum(case when cnt_btc_new_from_map > 0 then 1 end) as users_buyer_target_click_new_from_map,
    sum(case when cnt_btc_new_s_map_area > 0 then 1 end) as users_buyer_target_click_new_from_map_area,
    sum(case when cnt_btc_new_rec > 0 then 1 end) as users_buyer_target_click_new_rec,
    sum(case when cnt_btc_no > 0 then 1 end) as users_buyer_target_click_nox_daily,
    sum(case when cnt_btc_rec > 0 then 1 end) as users_buyer_target_click_rec_daily,
    sum(case when cnt_btc_rec_vas > 0 then 1 end) as users_buyer_target_click_rec_daily_vas,
    sum(case when cnt_btc_job_ast > 0 then 1 end) as users_buyer_target_click_rec_job_ast,
    sum(case when cnt_btc_old_rec > 0 then 1 end) as users_buyer_target_click_returned_rec,
    sum(case when cnt_btc_s_item_attr > 0 then 1 end) as users_buyer_target_click_serp_daily,
    sum(case when cnt_btc_new_s_item_attr > 0 then 1 end) as users_buyer_target_click_serp_new,
    sum(case when cnt_btc_old_s_item_attr > 0 then 1 end) as users_buyer_target_click_serp_returned,
    sum(case when cnt_btc_s_wo_map_area > 0 then 1 end) as users_buyer_target_click_serp_wo_map_area,
    sum(case when cnt_btc_s_distr > 0 then 1 end) as users_buyer_target_clicks_serp_district,
    sum(case when cnt_btc_s_metro > 0 then 1 end) as users_buyer_target_clicks_serp_metro,
    sum(case when cnt_btc_s_radius > 0 then 1 end) as users_buyer_target_clicks_serp_radius,
    sum(case when cnt_btc_s_road > 0 then 1 end) as users_buyer_target_clicks_serp_road,
    sum(case when cnt_contact_delivery_serp > 0 then 1 end) as users_contact_delivery_serp,
    sum(case when contacts_metageo > 0 then 1 end) as users_contact_metageo,
    sum(case when cnt_cs_no_item_attr > 0 then 1 end) as users_contact_nox_daily,
    sum(case when cnt_cs_push_land > 0 then 1 end) as users_contact_push_land,
    sum(case when cnt_cs_rec_cv2vac > 0 then 1 end) as users_contact_rec_cv2vac,
    sum(case when cnt_cs_rec > 0 then 1 end) as users_contact_rec_daily,
    sum(case when cnt_cs_rec_vas > 0 then 1 end) as users_contact_rec_daily_vas,
    sum(case when cnt_cs_rec_i2i > 0 then 1 end) as users_contact_rec_i2i,
    sum(case when cnt_cs_rec_i2i_vas > 0 then 1 end) as users_contact_rec_i2i_vas,
    sum(case when cnt_c_rec_job_ast > 0 then 1 end) as users_contact_rec_job_ast,
    sum(case when cnt_cs_rec_u2i > 0 then 1 end) as users_contact_rec_u2i,
    sum(case when cnt_cs_rec_u2i_collab > 0 then 1 end) as users_contact_rec_u2i_collab,
    sum(case when cnt_cs_rec_u2i_graph > 0 then 1 end) as users_contact_rec_u2i_graph,
    sum(case when cnt_cs_rec_u2i_similars > 0 then 1 end) as users_contact_rec_u2i_similars,
    sum(case when cnt_cs_rec_u2i_user2vec > 0 then 1 end) as users_contact_rec_u2i_user2vec,
    sum(case when cnt_cs_rec_u2i_vas > 0 then 1 end) as users_contact_rec_u2i_vas,
    sum(case when cnt_s_noquery_c > 0 then 1 end) as users_contact_search_noquery,
    sum(case when cnt_s_query_c > 0 then 1 end) as users_contact_search_query,
    sum(case when cnt_cs_s_u2i > 0 then 1 end) as users_contact_search_u2i,
    sum(case when cnt_cs_s_item_attr > 0 then 1 end) as users_contact_serp_daily,
    sum(case when cnt_cs_vertical_main > 0 then 1 end) as users_contact_vertical_main,
    sum(case when cnt_cs_vertical_main_featured > 0 then 1 end) as users_contact_vertical_main_featured,
    sum(case when cnt_cs_vertical_main_rec > 0 then 1 end) as users_contact_vertical_main_rec,
    sum(case when cnt_contacts_delivery > 0 then 1 end) as users_contacts_delivery,
    sum(case when cnt_cs_fav_list > 0 then 1 end) as users_contacts_fav_list,
    sum(case when cnt_contacts_s_filter_price > 0 then 1 end) as users_contacts_from_searches_with_filters,
    sum(case when cnt_cs_s_distr > 0 then 1 end) as users_contacts_serp_district,
    sum(case when cnt_cs_s_distr_metro_road > 0 then 1 end) as users_contacts_serp_local_geo,
    sum(case when cnt_cs_s_metro > 0 then 1 end) as users_contacts_serp_metro,
    sum(case when cnt_cs_s_radius > 0 then 1 end) as users_contacts_serp_radius,
    sum(case when cnt_cs_s_road > 0 then 1 end) as users_contacts_serp_road,
    sum(case when cnt_delivery_click_serp > 0 then 1 end) as users_delivery_click_serp,
    sum(case when cnt_delivery_confirm_serp > 0 then 1 end) as users_delivery_confirm_serp,
    sum(case when cnt_delivery_iv_serp > 0 then 1 end) as users_delivery_iv_serp,
    sum(case when cnt_delivery_widget_serp > 0 then 1 end) as users_delivery_widget_serp,
    sum(case when cnt_fav_from_map > 0 then 1 end) as users_fav_from_map,
    sum(case when cnt_fav_s_map_area > 0 then 1 end) as users_fav_from_map_area,
    sum(case when cnt_fav_s_wo_map_area > 0 then 1 end) as users_fav_serp_wo_map_area,
    sum(case when favorites_added > 0 then 1 end) as users_favorites,
    sum(case when first_messages > 0 then 1 end) as users_first_messages,
    sum(case when head_main_pages > 0 then 1 end) as users_head_main_page_daily,
    sum(case when item_views > 15 then 1 end) as users_item_view_16plus,
    sum(case when item_views > 3 then 1 end) as users_item_view_4plus,
    sum(case when item_views > 7 then 1 end) as users_item_view_8plus,
    sum(case when item_views_client > 0 then 1 end) as users_item_view_client_daily,
    sum(case when item_views > 0 then 1 end) as users_item_view_daily,
    sum(case when cnt_iv_no_item_attr > 0 then 1 end) as users_item_view_nox_daily,
    sum(case when cnt_iv_push_land > 0 then 1 end) as users_item_view_push_land,
    sum(case when cnt_iv_rec_cv2vac > 0 then 1 end) as users_item_view_rec_cv2vac,
    sum(case when cnt_iv_rec > 0 then 1 end) as users_item_view_rec_daily,
    sum(case when cnt_iv_rec_vas > 0 then 1 end) as users_item_view_rec_daily_vas,
    sum(case when cnt_iv_rec_i2i > 0 then 1 end) as users_item_view_rec_i2i,
    sum(case when cnt_iv_rec_i2i_vas > 0 then 1 end) as users_item_view_rec_i2i_vas,
    sum(case when cnt_iv_rec_job_ast > 0 then 1 end) as users_item_view_rec_job_ast,
    sum(case when cnt_iv_rec_u2i > 0 then 1 end) as users_item_view_rec_u2i,
    sum(case when cnt_iv_rec_u2i_collab > 0 then 1 end) as users_item_view_rec_u2i_collab,
    sum(case when cnt_iv_rec_u2i_graph > 0 then 1 end) as users_item_view_rec_u2i_graph,
    sum(case when cnt_iv_rec_u2i_similars > 0 then 1 end) as users_item_view_rec_u2i_similars,
    sum(case when cnt_iv_rec_u2i_user2vec > 0 then 1 end) as users_item_view_rec_u2i_user2vec,
    sum(case when cnt_iv_rec_u2i_vas > 0 then 1 end) as users_item_view_rec_u2i_vas,
    sum(case when cnt_s_noquery_iv > 0 then 1 end) as users_item_view_search_noquery,
    sum(case when cnt_s_query_iv > 0 then 1 end) as users_item_view_search_query,
    sum(case when cnt_iv_s_u2i > 0 then 1 end) as users_item_view_search_u2i,
    sum(case when cnt_iv_s_item_attr > 0 then 1 end) as users_item_view_serp_daily,
    sum(case when cnt_iv_vertical_main > 0 then 1 end) as users_item_view_vertical_main,
    sum(case when cnt_iv_vertical_main > 0 then 1 end) as users_item_view_vertical_main_featured,
    sum(case when cnt_iv_vertical_main > 0 then 1 end) as users_item_view_vertical_main_rec,
    sum(case when cnt_fav_list_iv > 0 then 1 end) as users_item_views_fav_list,
    sum(case when cnt_iv_from_map > 0 then 1 end) as users_item_views_from_map,
    sum(case when cnt_iv_s_map_area > 0 then 1 end) as users_item_views_from_map_area,
    sum(case when cnt_iv_s_filter_price > 0 then 1 end) as users_item_views_search_filter_any,
    sum(case when cnt_iv_s_distr > 0 then 1 end) as users_item_views_serp_district,
    sum(case when cnt_iv_s_metro > 0 then 1 end) as users_item_views_serp_metro,
    sum(case when cnt_iv_s_radius > 0 then 1 end) as users_item_views_serp_radius,
    sum(case when cnt_iv_s_road > 0 then 1 end) as users_item_views_serp_road,
    sum(case when cnt_iv_s_wo_map_area > 0 then 1 end) as users_item_views_serp_wo_map_area,
    sum(case when item_views_metageo > 0 then 1 end) as users_iv_metageo,
    sum(case when cnt_cs_msg_fav_list > 0 then 1 end) as users_msg_fav_list,
    sum(case when cnt_cs_msg_no_item_attr > 0 then 1 end) as users_msg_nox,
    sum(case when cnt_cs_msg_rec_u2i > 0 then 1 end) as users_msg_rec_i2i,
    sum(case when cnt_cs_msg_rec_i2i > 0 then 1 end) as users_msg_rec_u2i,
    sum(case when cnt_cs_msg_s_item_attr > 0 then 1 end) as users_msg_serp,
    sum(case when cnt_cs_ph_fav_list > 0 then 1 end) as users_ph_fav_list,
    sum(case when cnt_cs_ph_no_item_attr > 0 then 1 end) as users_ph_nox,
    sum(case when cnt_cs_ph_rec_u2i > 0 then 1 end) as users_ph_rec_i2i,
    sum(case when cnt_cs_ph_rec_i2i > 0 then 1 end) as users_ph_rec_u2i,
    sum(case when cnt_cs_ph_s_item_attr > 0 then 1 end) as users_ph_serp,
    sum(case when phone_views_in_chat > 0 then 1 end) as users_phone_views_in_chat,
    sum(case when phone_view_button_clicks > 0 then 1 end) as users_pv_button_clicks,
    sum(case when re_main_pages > 0 then 1 end) as users_re_main_page_daily,
    sum(case when realty_dev_phone_views > 0 then 1 end) as users_realty_dev_phone_view,
    sum(case when realty_dev_views > 0 then 1 end) as users_realty_dev_view,
    sum(case when saved_searches > 0 then 1 end) as users_saved_searches,
    sum(case when saved_searches_added > 0 then 1 end) as users_saved_searches_added,
    sum(case when searches > 0 then 1 end) as users_search,
    sum(case when searches_with_filter_any > 0 then 1 end) as users_search_filter_any,
    sum(case when searches_metageo > 0 then 1 end) as users_search_metageo,
    sum(case when searches_with_query > 0 then 1 end) as users_search_query,
    sum(case when searches_any_ext_block > 0 then 1 end) as users_searches_any_ext_block,
    sum(case when searches_district > 0 then 1 end) as users_searches_district,
    sum(case when searches_extra_delivery > 0 then 1 end) as users_searches_extra_delivery,
    sum(case when searches_extra_quorum > 0 then 1 end) as users_searches_extra_quorum,
    sum(case when searches_extra_regions > 0 then 1 end) as users_searches_extra_regions,
    sum(case when searches_extra_regions_any > 0 then 1 end) as users_searches_extra_regions_any,
    sum(case when searches_extra_regions_mix > 0 then 1 end) as users_searches_extra_regions_mix,
    sum(case when searches_extra_vector > 0 then 1 end) as users_searches_extra_vector,
    sum(case when searches_local_geo > 0 then 1 end) as users_searches_local_geo,
    sum(case when searches_metro > 0 then 1 end) as users_searches_metro,
    sum(case when searches_radius > 0 then 1 end) as users_searches_radius,
    sum(case when searches_road > 0 then 1 end) as users_searches_road,
    sum(case when services_main_pages > 0 then 1 end) as users_services_main_page_daily,
    sum(case when transport_main_pages > 0 then 1 end) as users_transport_main_page_daily,
    sum(case when vertical_main > 0 then 1 end) as users_vertical_main,
    sum(case when vertical_main_featured > 0 then 1 end) as users_vertical_main_featured,
    sum(case when vertical_main_pages > 0 then 1 end) as users_vertical_main_page_daily,
    sum(case when vertical_main_rec > 0 then 1 end) as users_vertical_main_rec,
    sum(case when write_button_clicks > 0 then 1 end) as users_write_button_clicks
from (
    select
        cookie_id, cookie,
        sum(case when eid in (2572, 2592) then 1 end) as all_main_pages,
        sum(case when eid = 2581 then 1 end) as booking_created_short_rent,
        sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as bt_clicks,
        sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and new_user_btc = True then 1 end) as bt_clicks_new,
        sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and new_user_btc = False then 1 end) as bt_clicks_returned,
        sum(case when item_flags & 2 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_actual_calendar,
        sum(case when eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and SFAccount_Type = 'Девелопер' then 1 end) as btc_developer,
        sum(case when item_flags & 16 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_leadgen_item,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 2743 or x_eid = 300)) then 1 end) as btc_map_or_s,
        sum(case when item_serp_flags & 32768 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_multiloc,
        sum(case when item_serp_flags & 32768 > 0 and search_query_type = 9 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_multiloc_reg,
        sum(case when new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 2743 or x_eid = 300)) then 1 end) as btc_new_map_or_s,
        sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_not_actual_calendar,
        sum(case when item_flags & 1 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_pro_image,
        sum(case when search_flags & 17179869184 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_s_multiloc,
        sum(case when item_flags & 16777216 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_str_flat_verified_badge,
        sum(case when item_flags & 32 > 0 and eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) then 1 end) as btc_str_online_booking_items,
        sum(case when x_from_page in ('witcher-extra-delivery', 'witcher-extra-regions', 'witcher-marketplace', 'witcher-new-auto', 'witcher-new-flats') and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_any,
        sum(case when x_from_page = 'witcher-extra-delivery' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_delivery,
        sum(case when x_from_page = 'witcher-new-auto' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_new_auto,
        sum(case when x_from_page = 'witcher-new-flats' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_new_flats,
        sum(case when x_from_page = 'witcher-extra-regions' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_witcher_funnel_regions,
        sum(case when item_flags & 33554432 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_with_multilocs,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743)) then 1 end) as buyer_target_clicks_metageo,
        sum(case when item_flags & 2 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_actual_calendar,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and SFAccount_Type = 'Девелопер' then 1 end) as c_developer,
        sum(case when SFAccount_Type = 'Девелопер' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_developer_search,
        sum(case when item_flags & 16 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_leadgen_item,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 2743 or x_eid = 300)) then 1 end) as c_map_or_s,
        sum(case when item_flags & 32 > 0 and eid in (856, 857, 4066) then 1 end) as c_msg_str_online_booking_items,
        sum(case when item_serp_flags & 32768 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_multiloc,
        sum(case when item_serp_flags & 32768 > 0 and search_query_type = 9 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_multiloc_reg,
        sum(case when item_serp_flags & 32768 > 0 and x_vertical_id is not null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_multiloc_vertical_defined,
        sum(case when item_serp_flags & 32768 > 0 and x_vertical_id is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_multiloc_vertical_undefined,
        sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_not_actual_calendar,
        sum(case when item_flags & 1 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_pro_image,
        sum(case when search_flags & 17179869184 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_s_multiloc,
        sum(case when x_eid = 300 and x_vertical_id is not null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_s_vertical_defined,
        sum(case when x_eid = 300 and x_vertical_id is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_s_vertical_undefined,
        sum(case when item_flags & 16777216 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_str_flat_verified_badge,
        sum(case when item_flags & 32 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as c_str_online_booking_items,
        sum(case when x_from_page in ('witcher-extra-delivery', 'witcher-extra-regions', 'witcher-marketplace', 'witcher-new-auto', 'witcher-new-flats') and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_any,
        sum(case when x_from_page = 'witcher-extra-delivery' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_delivery,
        sum(case when x_from_page = 'witcher-new-auto' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_new_auto,
        sum(case when x_from_page = 'witcher-new-flats' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_new_flats,
        sum(case when x_from_page = 'witcher-extra-regions' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_witcher_funnel_regions,
        sum(case when item_flags & 33554432 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_with_multilocs,
        sum(case when item_flags & 33554432 > 0 and x_vertical_id is not null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_with_multilocs_vertical_defined,
        sum(case when item_flags & 33554432 > 0 and x_vertical_id is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_with_multilocs_vertical_undefined,
        sum(case when (page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) or eid in (301, 303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813)) then 1 end) as cnt_active,
        sum(1) as cnt_any_action,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_any_ext_block,
        sum(case when item_flags & 131072 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_cpa,
        sum(case when search_query_type = 10 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_dlv,
        sum(case when x_eid = 2743 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_from_map,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_btc_from_map_s_area,
        sum(case when x_eid = 4126 and from_page = 'assistant' and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_job_ast,
        sum(case when x_eid = 300 and new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_new_any_ext_block,
        sum(case when search_query_type = 10 and x_eid = 300 and new_user_btc = True and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_dlv,
        sum(case when x_eid = 2743 and new_user_btc = True and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_from_map,
        sum(case when new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_btc_new_from_map_s_area,
        sum(case when new_user_btc = True and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_new_rec,
        sum(case when new_user_btc = True and x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_rec_i2i,
        sum(case when new_user_btc = True and x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_rec_u2i,
        sum(case when new_user_btc = True and search_query_type = 9 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_reg,
        sum(case when new_user_btc = True and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_s_item_attr,
        sum(case when new_user_btc = True and search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_new_s_map_area,
        sum(case when x_eid is null and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_no,
        sum(case when x_eid = 300 and new_user_btc = False and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_btc_old_any_ext_block,
        sum(case when new_user_btc = False and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_old_rec,
        sum(case when new_user_btc = False and x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_rec_i2i,
        sum(case when new_user_btc = False and x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_rec_u2i,
        sum(case when new_user_btc = False and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_old_s_item_attr,
        sum(case when x_eid = 5354 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_push_land,
        sum(case when search_query_type = 15 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_qrm,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec,
        sum(case when item_flags & 131072 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_cpa,
        sum(case when x_eid = 4386 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_cv2vac,
        sum(case when x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_i2i,
        sum(case when x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i,
        sum(case when x_eid in (2012, 2309) and item_engines & 1 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_collab,
        sum(case when x_eid in (2012, 2309) and item_engines & 16 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_graph,
        sum(case when x_eid in (2012, 2309) and item_engines & 8 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_similars,
        sum(case when x_eid in (2012, 2309) and item_engines & 2 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i_user2vec,
        sum(case when item_vas_flags & 261231 > 0 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec_vas,
        sum(case when search_query_type = 9 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_reg,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 9 or search_query_type = 20)) then 1 end) as cnt_btc_reg_any,
        sum(case when search_query_type = 20 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_reg_mix,
        sum(case when x_eid = 300 and item_flags & 131072 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_cpa,
        sum(case when search_flags & 2 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_distr,
        sum(case when x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_item_attr,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_map_area,
        sum(case when search_flags & 1 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_metro,
        sum(case when q = '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_noquery,
        sum(case when q > '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_query,
        sum(case when search_flags & 8 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_radius,
        sum(case when search_flags & 4 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_road,
        sum(case when search_flags & 64 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_saved,
        sum(case when search_flags & 16 = 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_wo_map_area,
        sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_shopx,
        sum(case when search_query_type = 18 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_vec,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as cnt_btc_views_s_filter_price,
        sum(case when search_query_type = 12 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_dlv,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 12 or search_query_type = 13 or search_query_type = 14 or search_query_type = 11)) then 1 end) as cnt_btc_wtc_dlv_new_auto_flats_reg,
        sum(case when search_query_type = 13 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_new_auto,
        sum(case when search_query_type = 14 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_new_flats,
        sum(case when search_query_type = 11 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_reg,
        sum(case when x_eid = 4126 and from_page = 'assistant' and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_c_rec_job_ast,
        sum(case when eid = 4675 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_contact_delivery_serp,
        sum(case when eid = 4675 then 1 end) as cnt_contacts_delivery,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as cnt_contacts_s_filter_price,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_cs_any_ext_block,
        sum(case when item_flags & 131072 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_cpa,
        sum(case when SFAccount_Type = 'Девелопер' and x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_developer_from_map,
        sum(case when SFAccount_Type = 'Девелопер' and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_developer_rec,
        sum(case when search_query_type = 10 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_dlv,
        sum(case when x_eid = 400 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_fav_list,
        sum(case when x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_from_map,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as cnt_cs_from_map_s_area,
        sum(case when eid in (856, 857, 4066) and x_eid = 400 then 1 end) as cnt_cs_msg_fav_list,
        sum(case when eid in (856, 857, 4066) and x_eid is null then 1 end) as cnt_cs_msg_no_item_attr,
        sum(case when eid in (856, 857, 4066) and x_eid = 2437 then 1 end) as cnt_cs_msg_rec_i2i,
        sum(case when eid in (856, 857, 4066) and x_eid in (2012, 2309) then 1 end) as cnt_cs_msg_rec_u2i,
        sum(case when eid in (856, 857, 4066) and x_eid = 300 then 1 end) as cnt_cs_msg_s_item_attr,
        sum(case when x_eid is null and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_no_item_attr,
        sum(case when eid = 303 and x_eid = 400 then 1 end) as cnt_cs_ph_fav_list,
        sum(case when eid = 303 and x_eid is null then 1 end) as cnt_cs_ph_no_item_attr,
        sum(case when eid = 303 and x_eid = 2437 then 1 end) as cnt_cs_ph_rec_i2i,
        sum(case when eid = 303 and x_eid in (2012, 2309) then 1 end) as cnt_cs_ph_rec_u2i,
        sum(case when eid = 303 and x_eid = 300 then 1 end) as cnt_cs_ph_s_item_attr,
        sum(case when x_eid = 5354 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_push_land,
        sum(case when search_query_type = 15 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_qrm,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec,
        sum(case when item_flags & 131072 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_cpa,
        sum(case when x_eid = 4386 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_cv2vac,
        sum(case when x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i,
        sum(case when item_vas_flags & 261231 > 0 and x_eid = 2437 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_i2i_vas,
        sum(case when x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i,
        sum(case when x_eid in (2012, 2309) and item_engines & 1 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_collab,
        sum(case when x_eid in (2012, 2309) and item_engines & 16 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_graph,
        sum(case when x_eid in (2012, 2309) and item_engines & 8 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_similars,
        sum(case when x_eid in (2012, 2309) and item_engines & 2 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_user2vec,
        sum(case when item_vas_flags & 261231 > 0 and x_eid in (2012, 2309) and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_rec_u2i_vas,
        sum(case when item_vas_flags & 261231 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_vas,
        sum(case when search_query_type = 9 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_reg,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 9 or search_query_type = 20)) then 1 end) as cnt_cs_reg_any,
        sum(case when search_query_type = 20 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_reg_mix,
        sum(case when x_eid = 300 and item_flags & 131072 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_cpa,
        sum(case when search_flags & 2 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_distr,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 4 > 0)) then 1 end) as cnt_cs_s_distr_metro_road,
        sum(case when x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_item_attr,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_map_area,
        sum(case when search_flags & 1 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_metro,
        sum(case when search_flags & 8 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_radius,
        sum(case when search_flags & 4 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_road,
        sum(case when search_flags & 64 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_saved,
        sum(case when search_flags & 1024 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_u2i,
        sum(case when search_flags & 16 = 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_wo_map_area,
        sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_shopx,
        sum(case when search_query_type = 18 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vec,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and ((x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null)) or x_eid = 5516)) then 1 end) as cnt_cs_vertical_main,
        sum(case when x_rec_engine_id = 320590750001 and x_eid = 5516 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vertical_main_featured,
        sum(case when x_rec_engine_id = 320585250001 and x_eid = 5516 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vertical_main_rec,
        sum(case when search_query_type = 12 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_dlv,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 12 or search_query_type = 13 or search_query_type = 14 or search_query_type = 11)) then 1 end) as cnt_cs_wtc_dlv_new_auto_flats_reg,
        sum(case when search_query_type = 13 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_new_auto,
        sum(case when search_query_type = 14 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_new_flats,
        sum(case when search_query_type = 11 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_reg,
        sum(case when other_flags & 1 > 0 and eid = 2483 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_click_serp,
        sum(case when eid = 2749 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_confirm_serp,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_iv_serp,
        sum(case when eid = 2015 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_order_create_serp,
        sum(case when eid = 2013 and item_flags & 65536 > 0 and x_eid = 300 then 1 end) as cnt_delivery_widget_serp,
        sum(case when eid in (401, 2574, 2732) and x_eid = 2743 then 1 end) as cnt_fav_from_map,
        sum(case when eid in (401, 2574, 2732) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as cnt_fav_from_map_s_area,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 400 then 1 end) as cnt_fav_list_iv,
        sum(case when eid in (401, 2574, 2732) and x_eid = 5354 then 1 end) as cnt_fav_push_land,
        sum(case when eid in (401, 2574, 2732) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_fav_rec,
        sum(case when eid in (401, 2574, 2732) and x_eid = 4386 then 1 end) as cnt_fav_rec_cv2vac,
        sum(case when eid in (401, 2574, 2732) and x_eid = 2437 then 1 end) as cnt_fav_rec_i2i,
        sum(case when eid in (401, 2574, 2732) and x_eid = 4126 and from_page = 'assistant' then 1 end) as cnt_fav_rec_job_ast,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) then 1 end) as cnt_fav_rec_u2i,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 1 > 0 then 1 end) as cnt_fav_rec_u2i_collab,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 16 > 0 then 1 end) as cnt_fav_rec_u2i_graph,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 8 > 0 then 1 end) as cnt_fav_rec_u2i_similars,
        sum(case when eid in (401, 2574, 2732) and x_eid in (2012, 2309) and item_engines & 2 > 0 then 1 end) as cnt_fav_rec_u2i_user2vec,
        sum(case when eid in (401, 2574, 2732) and x_eid = 300 then 1 end) as cnt_fav_s,
        sum(case when eid in (401, 2574, 2732) and search_flags & 16 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_map_area,
        sum(case when eid in (401, 2574, 2732) and search_flags & 64 > 0 and x_eid = 300 then 1 end) as cnt_fav_s_saved,
        sum(case when eid in (401, 2574, 2732) and search_flags & 16 = 0 and x_eid = 300 then 1 end) as cnt_fav_s_wo_map_area,
        sum(case when eid in (401, 2574, 2732) and x_eid = 300 and search_flags & 128 > 0 then 1 end) as cnt_fav_shopx,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_iv_any_ext_block,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 131072 > 0 then 1 end) as cnt_iv_cpa,
        sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_developer_from_map,
        sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_developer_rec,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 10 and x_eid = 300 then 1 end) as cnt_iv_dlv,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_from_map,
        sum(case when eid = 301 and item_x_type = 0 and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as cnt_iv_from_map_s_area,
        sum(case when eid = 301 and item_x_type = 0 and x_eid is null then 1 end) as cnt_iv_no_item_attr,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 5354 then 1 end) as cnt_iv_push_land,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 15 and x_eid = 300 then 1 end) as cnt_iv_qrm,
        sum(case when eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 131072 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_cpa,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 4386 then 1 end) as cnt_iv_rec_cv2vac,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i,
        sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and x_eid = 2437 then 1 end) as cnt_iv_rec_i2i_vas,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 4126 and from_page = 'assistant' then 1 end) as cnt_iv_rec_job_ast,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 1 > 0 then 1 end) as cnt_iv_rec_u2i_collab,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 16 > 0 then 1 end) as cnt_iv_rec_u2i_graph,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 8 > 0 then 1 end) as cnt_iv_rec_u2i_similars,
        sum(case when eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) and item_engines & 2 > 0 then 1 end) as cnt_iv_rec_u2i_user2vec,
        sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and x_eid in (2012, 2309) then 1 end) as cnt_iv_rec_u2i_vas,
        sum(case when item_vas_flags & 261231 > 0 and eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_vas,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 9 and x_eid = 300 then 1 end) as cnt_iv_reg,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (9, 20)) then 1 end) as cnt_iv_reg_any,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 20 and x_eid = 300 then 1 end) as cnt_iv_reg_mix,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and item_flags & 131072 > 0 then 1 end) as cnt_iv_s_cpa,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 2 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_distr,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_flags & 768 > 0) then 1 end) as cnt_iv_s_filter_price,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 then 1 end) as cnt_iv_s_item_attr,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_map_area,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 1 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_metro,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 8 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_radius,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_road,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 64 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_saved,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 1024 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_u2i,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 = 0 and x_eid = 300 then 1 end) as cnt_iv_s_wo_map_area,
        sum(case when eid = 301 and from_page = 'witcher-seen-items' then 1 end) as cnt_iv_seen,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 128 > 0 then 1 end) as cnt_iv_shopx,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 18 and x_eid = 300 then 1 end) as cnt_iv_vec,
        sum(case when eid = 301 and (x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) or x_eid = 5516) then 1 end) as cnt_iv_vertical_main,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300 then 1 end) as cnt_iv_wtc_dlv,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (11, 12, 13, 14, 16)) then 1 end) as cnt_iv_wtc_dlv_new_auto_flats_reg,
        sum(case when (from_page = 'witcher-extra-delivery' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-new-auto' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-new-flats' and eid = 300 and (onmap = 0 or platform_id != 1) or from_page = 'witcher-extra-regions' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300 or eid = 301 and item_x_type = 0 and search_query_type = 16 and x_eid = 300) then 1 end) as cnt_iv_wtc_dlv_new_auto_flats_reg_s_from,
        sum(case when (from_page = 'witcher-extra-delivery' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300) then 1 end) as cnt_iv_wtc_dlv_s_from,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300 then 1 end) as cnt_iv_wtc_new_auto,
        sum(case when (from_page = 'witcher-new-auto' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300) then 1 end) as cnt_iv_wtc_new_auto_s_from,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300 then 1 end) as cnt_iv_wtc_new_flats,
        sum(case when (from_page = 'witcher-new-flats' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300) then 1 end) as cnt_iv_wtc_new_flats_s_from,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300 then 1 end) as cnt_iv_wtc_reg,
        sum(case when (from_page = 'witcher-extra-regions' and eid = 300 and (onmap = 0 or platform_id != 1) or eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300) then 1 end) as cnt_iv_wtc_reg_s_from,
        sum(case when eid in (303, 3005, 3461, 3461, 4600) then 1 end) as cnt_ph_realty_development,
        sum(case when q = '' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_noquery_c,
        sum(case when eid = 301 and item_x_type = 0 and q = '' and x_eid = 300 then 1 end) as cnt_s_noquery_iv,
        sum(case when q > '' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_query_c,
        sum(case when eid = 301 and item_x_type = 0 and q > '' and x_eid = 300 then 1 end) as cnt_s_query_iv,
        sum(case when eid = 300 and q = '' and (onmap = 0 or platform_id != 1) then 1 end) as cnt_s_without_query,
        sum(case when page_no = 0 and eid = 300 and search_flags & 16384 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_s_wtc_dlv,
        sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 16384 > 0 or search_flags & 32768 > 0 or search_flags & 65536 > 0 or search_flags & 8192 > 0)) then 1 end) as cnt_s_wtc_dlv_new_auto_flats_reg,
        sum(case when eid = 308 then 1 end) as cnt_soc_btn,
        sum(case when eid = 301 and logical_category_id = 24144500001 then 1 end) as cnt_used_cars_views,
        sum(case when item_flags & 64 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_imv_re_good,
        sum(case when item_flags & 256 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_imv_re_high,
        sum(case when item_flags & 128 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_imv_re_low,
        sum(case when item_flags & 512 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_imv_re_no_label,
        sum(case when item_flags & 4194304 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_in_stock,
        sum(case when item_flags & 16384 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_part_qual_compab,
        sum(case when item_flags & 8192 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_part_qual_exists,
        sum(case when item_flags & 32768 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_part_qual_unknown,
        sum(case when item_flags & 8388608 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contact_to_order,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contacts,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and search_flags & 2097152 > 0 then 1 end) as contacts_from_suggest,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_flags & 2048 > 0 then 1 end) as contacts_item_pessimized,
        sum(case when x_eid = 2743 and item_flags & 2048 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_item_pessimized_map,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and item_flags & 2048 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_item_pessimized_map_serp,
        sum(case when item_flags & 2048 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as contacts_item_pessimized_map_total,
        sum(case when item_flags & 2048 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as contacts_item_pessimized_rec,
        sum(case when x_eid = 300 and item_flags & 2048 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_item_pessimized_serp,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743)) then 1 end) as contacts_metageo,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and (item_flags & 6144 > 0) then 1 end) as contacts_pessimized,
        sum(case when x_eid = 2743 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_map,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_map_serp,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_map_total,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_rec,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as contacts_pessimized_serp,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and item_flags & 4096 > 0 then 1 end) as contacts_seller_pessimized,
        sum(case when x_eid = 2743 and item_flags & 4096 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_seller_pessimized_map,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and item_flags & 4096 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_seller_pessimized_map_serp,
        sum(case when item_flags & 4096 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743)) then 1 end) as contacts_seller_pessimized_map_total,
        sum(case when item_flags & 4096 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as contacts_seller_pessimized_rec,
        sum(case when x_eid = 300 and item_flags & 4096 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as contacts_seller_pessimized_serp,
        sum(case when item_vas_flags & 261231 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as contacts_total_vas,
        sum(case when eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813, 5629) then 1 end) as contacts_videocalls,
        sum(case when item_flags & 65536 > 0 and eid = 301 then 1 end) as delivery_total_item_view,
        sum(case when eid in (401, 2574, 2732) and (x_eid in (300, 2743)) then 1 end) as fav_map_or_s,
        sum(case when item_serp_flags & 32768 > 0 and eid in (401, 2574, 2732) then 1 end) as fav_multiloc,
        sum(case when item_serp_flags & 32768 > 0 and search_query_type = 9 and eid in (401, 2574, 2732) then 1 end) as fav_multiloc_reg,
        sum(case when search_flags & 17179869184 > 0 and eid in (401, 2574, 2732) then 1 end) as fav_s_multiloc,
        sum(case when x_from_page in ('witcher-extra-delivery', 'witcher-extra-regions', 'witcher-marketplace', 'witcher-new-auto', 'witcher-new-flats') and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_any,
        sum(case when x_from_page = 'witcher-extra-delivery' and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_delivery,
        sum(case when x_from_page = 'witcher-new-auto' and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_new_auto,
        sum(case when x_from_page = 'witcher-new-flats' and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_new_flats,
        sum(case when x_from_page = 'witcher-extra-regions' and eid in (401, 2574, 2732) then 1 end) as fav_witcher_funnel_regions,
        sum(case when item_flags & 33554432 > 0 and eid in (401, 2574, 2732) then 1 end) as fav_with_multilocs,
        sum(case when eid in (401, 2574, 2732) then 1 end) as favorites_added,
        sum(case when eid in (401, 2574, 2732) and from_page = 'catalog_jk_card' then 1 end) as favorites_added_from_jk_card,
        sum(case when eid = 400 then 1 end) as favorites_list_views,
        sum(case when eid = 402 then 1 end) as favorites_removed,
        sum(case when eid in (856, 857, 4066) then 1 end) as first_messages,
        sum(case when eid = 2572 then 1 end) as head_main_pages,
        sum(case when eid = 301 then 1 end) as item_views,
        sum(case when eid = 2649 then 1 end) as item_views_client,
        sum(case when eid = 301 and from_page = 'catalog_jk_card' then 1 end) as item_views_from_jk_card,
        sum(case when eid = 301 and search_flags & 2097152 > 0 then 1 end) as item_views_from_suggest,
        sum(case when item_flags & 4194304 > 0 and eid = 301 then 1 end) as item_views_in_stock,
        sum(case when item_flags & 2048 > 0 and eid = 301 then 1 end) as item_views_item_pessimized,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 and item_flags & 2048 > 0 then 1 end) as item_views_item_pessimized_map,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 and item_flags & 2048 > 0 then 1 end) as item_views_item_pessimized_map_serp,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 2048 > 0 and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as item_views_item_pessimized_map_total,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 2048 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as item_views_item_pessimized_rec,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and item_flags & 2048 > 0 then 1 end) as item_views_item_pessimized_serp,
        sum(case when eid = 301 and item_x_type = 0 and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743) then 1 end) as item_views_metageo,
        sum(case when item_flags & 16384 > 0 and eid = 301 then 1 end) as item_views_part_qual_compab,
        sum(case when item_flags & 8192 > 0 and eid = 301 then 1 end) as item_views_part_qual_exists,
        sum(case when item_flags & 32768 > 0 and eid = 301 then 1 end) as item_views_part_qual_unknown,
        sum(case when eid = 301 and (item_flags & 6144 > 0) then 1 end) as item_views_pessimized,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 and (item_flags & 6144 > 0) then 1 end) as item_views_pessimized_map,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 and (item_flags & 6144 > 0) then 1 end) as item_views_pessimized_map_serp,
        sum(case when eid = 301 and item_x_type = 0 and ((search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as item_views_pessimized_map_total,
        sum(case when eid = 301 and item_x_type = 0 and ((search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) and (item_flags & 2048 > 0 or item_flags & 4096 > 0)) then 1 end) as item_views_pessimized_rec,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (item_flags & 6144 > 0) then 1 end) as item_views_pessimized_serp,
        sum(case when item_flags & 4096 > 0 and eid = 301 then 1 end) as item_views_seller_pessimized,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 and item_flags & 4096 > 0 then 1 end) as item_views_seller_pessimized_map,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 and item_flags & 4096 > 0 then 1 end) as item_views_seller_pessimized_map_serp,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 4096 > 0 and (search_flags & 16 > 0 and x_eid = 300 or x_eid = 2743) then 1 end) as item_views_seller_pessimized_map_total,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 4096 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as item_views_seller_pessimized_rec,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and item_flags & 4096 > 0 then 1 end) as item_views_seller_pessimized_serp,
        sum(case when item_flags & 8388608 > 0 and eid = 301 then 1 end) as item_views_to_order,
        sum(case when item_vas_flags & 40 > 0 and eid = 301 then 1 end) as item_views_total_premium,
        sum(case when item_vas_flags & 4 > 0 and eid = 301 then 1 end) as item_views_total_push,
        sum(case when item_vas_flags & 261231 > 0 and eid = 301 then 1 end) as item_views_total_vas,
        sum(case when item_vas_flags & 1 > 0 and eid = 301 then 1 end) as item_views_total_vip,
        sum(case when item_flags & 2 > 0 and eid = 301 then 1 end) as iv_actual_calendar,
        sum(case when SFAccount_Type = 'Девелопер' and eid = 301 then 1 end) as iv_developer,
        sum(case when SFAccount_Type = 'Девелопер' and eid = 301 and item_x_type = 0 and x_eid = 300 then 1 end) as iv_developer_search,
        sum(case when item_flags & 64 > 0 and eid = 301 then 1 end) as iv_imv_re_good,
        sum(case when item_flags & 256 > 0 and eid = 301 then 1 end) as iv_imv_re_high,
        sum(case when item_flags & 128 > 0 and eid = 301 then 1 end) as iv_imv_re_low,
        sum(case when item_flags & 512 > 0 and eid = 301 then 1 end) as iv_imv_re_no_label,
        sum(case when item_flags & 16 > 0 and eid = 301 then 1 end) as iv_leadgen_item,
        sum(case when eid = 301 and item_x_type = 0 and (x_eid in (300, 2743)) then 1 end) as iv_map_or_s,
        sum(case when item_serp_flags & 32768 > 0 and eid = 301 and item_x_type = 0 then 1 end) as iv_multiloc,
        sum(case when item_serp_flags & 32768 > 0 and search_query_type = 9 and eid = 301 and item_x_type = 0 then 1 end) as iv_multiloc_reg,
        sum(case when item_serp_flags & 32768 > 0 and eid = 301 and item_x_type = 0 and x_vertical_id is not null then 1 end) as iv_multiloc_vertical_defined,
        sum(case when item_serp_flags & 32768 > 0 and eid = 301 and item_x_type = 0 and x_vertical_id is null then 1 end) as iv_multiloc_vertical_undefined,
        sum(case when logical_category_id = 1393250002 and item_flags & 2 = 0 and eid = 301 then 1 end) as iv_not_actual_calendar,
        sum(case when item_flags & 1 > 0 and eid = 301 then 1 end) as iv_pro_image,
        sum(case when search_flags & 17179869184 > 0 and eid = 301 and item_x_type = 0 then 1 end) as iv_s_multiloc,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and x_vertical_id is not null then 1 end) as iv_s_vertical_defined,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and x_vertical_id is null then 1 end) as iv_s_vertical_undefined,
        sum(case when item_flags & 16777216 > 0 and eid = 301 then 1 end) as iv_str_flat_verified_badge,
        sum(case when item_flags & 32 > 0 and eid = 301 then 1 end) as iv_str_online_booking_items,
        sum(case when x_from_page in ('witcher-extra-delivery', 'witcher-extra-regions', 'witcher-marketplace', 'witcher-new-auto', 'witcher-new-flats') and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_any,
        sum(case when x_from_page = 'witcher-extra-delivery' and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_delivery,
        sum(case when x_from_page = 'witcher-new-auto' and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_new_auto,
        sum(case when x_from_page = 'witcher-new-flats' and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_new_flats,
        sum(case when x_from_page = 'witcher-extra-regions' and eid = 301 and item_x_type = 0 then 1 end) as iv_witcher_funnel_regions,
        sum(case when item_flags & 33554432 > 0 and eid = 301 and item_x_type = 0 then 1 end) as iv_with_multilocs,
        sum(case when item_flags & 33554432 > 0 and eid = 301 and item_x_type = 0 and x_vertical_id is not null then 1 end) as iv_with_multilocs_vertical_defined,
        sum(case when item_flags & 33554432 > 0 and eid = 301 and item_x_type = 0 and x_vertical_id is null then 1 end) as iv_with_multilocs_vertical_undefined,
        sum(case when eid in (2216, 2650) then 1 end) as phone_view_button_clicks,
        sum(case when eid = 3005 then 1 end) as phone_views_in_chat,
        sum(case when eid in (303, 3005, 3461) then 1 end) as phone_views_total,
        sum(case when eid = 5354 then 1 end) as push_land_shows,
        sum(case when eid = 2592 and microcat_id = 2605 then 1 end) as re_main_pages,
        sum(case when eid in (3461, 4600) then 1 end) as realty_dev_phone_views,
        sum(case when eid = 3459 then 1 end) as realty_dev_views,
        sum(case when eid = 3459 and from_page = 'catalog_jk_serp' then 1 end) as realty_dev_views_cat_jk_serp,
        sum(case when eid = 3459 and from_page in ('item_jk_button', 'item_jk_name') then 1 end) as realty_dev_views_item,
        sum(case when eid = 3459 and from_page = 'item_jk_button' then 1 end) as realty_dev_views_item_button,
        sum(case when eid = 3459 and from_page = 'item_jk_name' then 1 end) as realty_dev_views_item_name,
        sum(case when eid = 3459 and from_page = 'map' then 1 end) as realty_dev_views_map,
        sum(case when eid = 3459 and from_page = 'jk_card_rec' then 1 end) as realty_dev_views_rec,
        sum(case when (eid in (2012, 2309, 2437, 4126, 4386) or search_flags & 1024 > 0) then 1 end) as recblock_shows,
        sum(case when eid = 4386 then 1 end) as recblock_shows_cv2vac,
        sum(case when eid = 2437 then 1 end) as recblock_shows_i2i,
        sum(case when eid in (2012, 2309) then 1 end) as recblock_shows_u2i,
        sum(case when eid = 300 and search_flags & 8589934592 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as s_localpriority,
        sum(case when (eid = 300 and page_no = 0 and (onmap = 0 or platform_id != 1) or eid = 2743) then 1 end) as s_map_or_s,
        sum(case when eid = 300 and search_flags & 17179869184 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as s_multiloc,
        sum(case when page_no = 0 and search_flags & 64 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as saved_searches,
        sum(case when eid = 2071 then 1 end) as saved_searches_added,
        sum(case when eid = 300 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as search_q,
        sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches,
        sum(case when eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 4096 > 0 or search_flags & 2048 > 0 or search_flags & 4194304 > 0 or search_flags & 262144 > 0 or search_flags & 524288 > 0)) then 1 end) as searches_any_ext_block,
        sum(case when page_no = 0 and search_flags & 2 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_district,
        sum(case when eid = 300 and search_flags & 4096 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_delivery,
        sum(case when eid = 300 and search_flags & 262144 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_quorum,
        sum(case when eid = 300 and search_flags & 2048 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_regions,
        sum(case when eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 4194304 > 0 or search_flags & 2048 > 0)) then 1 end) as searches_extra_regions_any,
        sum(case when eid = 300 and search_flags & 4194304 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_regions_mix,
        sum(case when eid = 300 and search_flags & 524288 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_extra_vector,
        sum(case when page_no = 0 and eid = 300 and search_flags & 2097152 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_suggest,
        sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (from_page = 'witcher-extra-delivery' or from_page = 'witcher-new-auto' or from_page = 'witcher-new-flats' or from_page = 'witcher-extra-regions')) then 1 end) as searches_from_witcher_any,
        sum(case when page_no = 0 and from_page = 'witcher-extra-delivery' and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_witcher_delivery,
        sum(case when page_no = 0 and from_page = 'witcher-new-auto' and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_witcher_new_auto,
        sum(case when page_no = 0 and from_page = 'witcher-new-flats' and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_witcher_new_flats,
        sum(case when page_no = 0 and from_page = 'witcher-extra-regions' and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_from_witcher_regions,
        sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 2 > 0 or search_flags & 1 > 0 or search_flags & 4 > 0)) then 1 end) as searches_local_geo,
        sum(case when page_no = 0 and search_flags & 16 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_map_area,
        sum(case when (eid = 300 and page_no = 0 and search_flags & 4196383 > 0 and (onmap = 0 or platform_id != 1) or eid = 2743) then 1 end) as searches_metageo,
        sum(case when page_no = 0 and search_flags & 1 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_metro,
        sum(case when page_no = 0 and search_flags & 8 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_radius,
        sum(case when page_no = 0 and search_flags & 4 > 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches_road,
        sum(case when page_no = 0 and eid = 300 and search_flags & 128 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_shop,
        sum(case when page_no = 0 and eid = 300 and item_count = 0 and search_flags & 128 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_shop_empty,
        sum(case when page_no = 0 and eid = 300 and item_count >= 1 and item_count <= 9 and search_flags & 128 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_shop_small,
        sum(case when eid = 300 and search_flags & 32768 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_witcher_new_auto,
        sum(case when eid = 300 and search_flags & 65536 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_witcher_new_flats,
        sum(case when eid = 300 and search_flags & 8192 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as searches_witcher_regions,
        sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as searches_with_filter_any,
        sum(case when page_no = 0 and eid = 300 and q > '' and (onmap = 0 or platform_id != 1) then 1 end) as searches_with_query,
        sum(case when eid = 2592 and microcat_id in (1741, 1748) then 1 end) as services_main_pages,
        sum(case when eid = 2664 then 1 end) as shortcut_clicks,
        sum(case when (eid in (4033, 4035) or other_flags & 4 > 0 and eid = 2483) then 1 end) as total_courier_btc,
        sum(case when (eid in (2013, 2015, 2749) or other_flags & 1 > 0 and eid = 2483) then 1 end) as total_delivery_btc,
        sum(case when other_flags & 1 > 0 and item_flags & 4 = 0 and eid = 2483 then 1 end) as total_delivery_click,
        sum(case when other_flags & 1 > 0 and item_flags & 4 = 0 and eid = 2483 then 1 end) as total_delivery_click_wo_messenger,
        sum(case when item_flags & 4 = 0 and eid = 2749 then 1 end) as total_delivery_confirm,
        sum(case when item_flags & 4 = 0 and eid = 2015 then 1 end) as total_delivery_contact,
        sum(case when item_flags & 4 = 0 and item_flags & 65536 > 0 and eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) then 1 end) as total_delivery_item_contact,
        sum(case when item_flags & 4 = 0 and eid = 2013 then 1 end) as total_delivery_widget,
        sum(case when eid = 2592 and microcat_id = 7096 then 1 end) as transport_main_pages,
        sum(case when eid = 2592 and (eid = 300 and (onmap = 0 or platform_id != 1) or x_eid = 300 and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) and q = '' and search_flags & 768 = 0 or x_eid in (2012, 2309) and (x_category_id = 250002 and x_subcategory_id = 250005 and x_param1_id is null or x_category_id is not null and x_subcategory_id is null) or eid in (2012, 2309)) then 1 end) as vertical_main,
        sum(case when eid = 2592 and x_rec_engine_id = 320590750001 then 1 end) as vertical_main_featured,
        sum(case when eid = 2592 then 1 end) as vertical_main_pages,
        sum(case when eid = 2592 and x_rec_engine_id = 320585250001 then 1 end) as vertical_main_rec,
        sum(case when eid = 2654 then 1 end) as write_button_clicks
    from buyer_stream t
    group by cookie_id, cookie
) _
;

create metrics buyer_stream_location_session_microcat as
select
    sum(case when cnt_cities_in_s > 0 then 1 end) as cities_in_search,
    sum(case when searches > 0 then 1 end) as locations_in_search,
    sum(case when cnt_reg_in_s > 0 then 1 end) as regions_in_search
from (
    select
        cookie_id, location_session_microcat,
        sum(case when location_level_id in (4, 5, 6) and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_cities_in_s,
        sum(case when location_level_id in (2, 3) and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_reg_in_s,
        sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches
    from buyer_stream t
    group by cookie_id, location_session_microcat
) _
;

create metrics buyer_stream_x as
select
    sum(case when cnt_cs_fav_list > 0 then 1 end) as fav_list_contact,
    sum(case when cnt_fav_list_iv > 0 then 1 end) as fav_list_item_view,
    sum(case when cnt_btc_s_map_area > 0 then 1 end) as map_area_searches_with_btc,
    sum(case when cnt_cs_s_map_area > 0 then 1 end) as map_area_searches_with_contact,
    sum(case when cnt_iv_s_map_area > 0 then 1 end) as map_area_searches_with_item_view,
    sum(case when cnt_btc_from_map > 0 then 1 end) as map_searches_with_btc,
    sum(case when cnt_cs_from_map > 0 then 1 end) as map_searches_with_contact,
    sum(case when cnt_iv_from_map > 0 then 1 end) as map_searches_with_item_view,
    sum(case when cnt_btc_s_query > 0 then 1 end) as s_btc_q,
    sum(case when btc_s_multiloc > 0 then 1 end) as s_multiloc_btc,
    sum(case when c_s_multiloc > 0 then 1 end) as s_multiloc_c,
    sum(case when fav_s_multiloc > 0 then 1 end) as s_multiloc_fav,
    sum(case when iv_s_multiloc > 0 then 1 end) as s_multiloc_iv,
    sum(case when cnt_btc_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as s_witcher_any_with_btc,
    sum(case when cnt_cs_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as s_witcher_any_with_c,
    sum(case when cnt_iv_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as s_witcher_any_with_iv,
    sum(case when cnt_btc_wtc_new_auto > 0 then 1 end) as s_witcher_auto_with_btc,
    sum(case when cnt_cs_wtc_new_auto > 0 then 1 end) as s_witcher_auto_with_c,
    sum(case when cnt_iv_wtc_new_auto > 0 then 1 end) as s_witcher_auto_with_iv,
    sum(case when cnt_btc_wtc_dlv > 0 then 1 end) as s_witcher_del_with_btc,
    sum(case when cnt_cs_wtc_dlv > 0 then 1 end) as s_witcher_del_with_c,
    sum(case when cnt_iv_wtc_dlv > 0 then 1 end) as s_witcher_del_with_iv,
    sum(case when cnt_btc_wtc_new_flats > 0 then 1 end) as s_witcher_flats_with_btc,
    sum(case when cnt_cs_wtc_new_flats > 0 then 1 end) as s_witcher_flats_with_c,
    sum(case when cnt_iv_wtc_new_flats > 0 then 1 end) as s_witcher_flats_with_iv,
    sum(case when cnt_btc_wtc_reg > 0 then 1 end) as s_witcher_reg_with_btc,
    sum(case when cnt_cs_wtc_reg > 0 then 1 end) as s_witcher_reg_with_c,
    sum(case when cnt_iv_wtc_reg > 0 then 1 end) as s_witcher_reg_with_iv,
    sum(case when cnt_btc_s_item_attr > 0 then 1 end) as search_btc,
    sum(case when cnt_s_u2i_c > 0 then 1 end) as search_u2i_contact,
    sum(case when cnt_s_u2i_iv > 0 then 1 end) as search_u2i_iv,
    sum(case when buyer_target_clicks_metageo > 0 then 1 end) as searches_btc_metageo,
    sum(case when cnt_cs_any_ext_block > 0 then 1 end) as searches_contact_any_ext_block,
    sum(case when cnt_cs_cpa > 0 then 1 end) as searches_contact_cpa,
    sum(case when cnt_cs_dlv > 0 then 1 end) as searches_contact_delivery,
    sum(case when contacts_metageo > 0 then 1 end) as searches_contact_metageo,
    sum(case when cnt_cs_premium > 0 then 1 end) as searches_contact_premium,
    sum(case when cnt_cs_push > 0 then 1 end) as searches_contact_push,
    sum(case when cnt_cs_qrm > 0 then 1 end) as searches_contact_quorum,
    sum(case when cnt_cs_rec_cpa > 0 then 1 end) as searches_contact_rec_cpa,
    sum(case when cnt_cs_reg > 0 then 1 end) as searches_contact_regions,
    sum(case when cnt_cs_reg_any > 0 then 1 end) as searches_contact_regions_any,
    sum(case when cnt_cs_reg_mix > 0 then 1 end) as searches_contact_regions_mix,
    sum(case when cnt_cs_s_cpa > 0 then 1 end) as searches_contact_s_cpa,
    sum(case when cnt_cs_s_item_attr > 0 then 1 end) as searches_contact_serp,
    sum(case when cnt_cs_vas > 0 then 1 end) as searches_contact_vas,
    sum(case when cnt_cs_vec > 0 then 1 end) as searches_contact_vector,
    sum(case when cnt_cs_vip > 0 then 1 end) as searches_contact_vip,
    sum(case when cnt_btc_s_distr > 0 then 1 end) as searches_district_with_btc,
    sum(case when cnt_cs_s_distr > 0 then 1 end) as searches_district_with_contact,
    sum(case when cnt_iv_s_distr > 0 then 1 end) as searches_district_with_item_view,
    sum(case when cnt_iv_any_ext_block > 0 then 1 end) as searches_item_view_any_ext_block,
    sum(case when cnt_iv_cpa > 0 then 1 end) as searches_item_view_cpa,
    sum(case when cnt_iv_dlv > 0 then 1 end) as searches_item_view_delivery,
    sum(case when cnt_iv_premium > 0 then 1 end) as searches_item_view_premium,
    sum(case when cnt_iv_push > 0 then 1 end) as searches_item_view_push,
    sum(case when cnt_iv_qrm > 0 then 1 end) as searches_item_view_quorum,
    sum(case when cnt_iv_rec_cpa > 0 then 1 end) as searches_item_view_rec_cpa,
    sum(case when cnt_iv_reg > 0 then 1 end) as searches_item_view_regions,
    sum(case when cnt_iv_reg_any > 0 then 1 end) as searches_item_view_regions_any,
    sum(case when cnt_iv_reg_mix > 0 then 1 end) as searches_item_view_regions_mix,
    sum(case when cnt_iv_s_cpa > 0 then 1 end) as searches_item_view_s_cpa,
    sum(case when cnt_iv_s_item_attr > 0 then 1 end) as searches_item_view_serp,
    sum(case when cnt_iv_vas > 0 then 1 end) as searches_item_view_vas,
    sum(case when cnt_iv_vec > 0 then 1 end) as searches_item_view_vector,
    sum(case when cnt_iv_vip > 0 then 1 end) as searches_item_view_vip,
    sum(case when item_views_metageo > 0 then 1 end) as searches_iv_metageo,
    sum(case when cnt_btc_s_metro > 0 then 1 end) as searches_metro_with_btc,
    sum(case when cnt_cs_s_metro > 0 then 1 end) as searches_metro_with_contact,
    sum(case when cnt_iv_s_metro > 0 then 1 end) as searches_metro_with_item_view,
    sum(case when cnt_btc_s_radius > 0 then 1 end) as searches_radius_with_btc,
    sum(case when cnt_cs_s_radius > 0 then 1 end) as searches_radius_with_contact,
    sum(case when cnt_iv_s_radius > 0 then 1 end) as searches_radius_with_item_view,
    sum(case when cnt_btc_s_road > 0 then 1 end) as searches_road_with_btc,
    sum(case when cnt_cs_s_road > 0 then 1 end) as searches_road_with_contact,
    sum(case when cnt_iv_s_road > 0 then 1 end) as searches_road_with_item_view,
    sum(case when cnt_btc_s_saved > 0 then 1 end) as searches_saved_with_btc,
    sum(case when cnt_cs_s_saved > 0 then 1 end) as searches_saved_with_contact,
    sum(case when cnt_iv_s_saved > 0 then 1 end) as searches_saved_with_item_view,
    sum(case when cnt_btc_shopx > 0 then 1 end) as searches_shop_with_btc,
    sum(case when cnt_cs_shopx > 0 then 1 end) as searches_shop_with_contact,
    sum(case when cnt_iv_shopx > 0 then 1 end) as searches_shop_with_item_view,
    sum(case when cnt_s_u2i_btc > 0 then 1 end) as searches_u2i_btc,
    sum(case when cnt_s_wtc_dlv_new_auto_flats_reg > 0 then 1 end) as searches_witcher_any,
    sum(case when cnt_s_wtc_dlv > 0 then 1 end) as searches_witcher_delivery,
    sum(case when cnt_btc_views_s_filter_price > 0 then 1 end) as searches_with_filters_with_btc,
    sum(case when cnt_contacts_s_filter_price > 0 then 1 end) as searches_with_filters_with_contacts,
    sum(case when cnt_iv_s_filter_price > 0 then 1 end) as searches_with_filters_with_iv,
    sum(case when cnt_btc_rec > 0 then 1 end) as shows_btc_recblock,
    sum(case when cnt_btc_rec_cv2vac > 0 then 1 end) as shows_btc_recblock_cv2vac,
    sum(case when cnt_btc_rec_i2i > 0 then 1 end) as shows_btc_recblock_i2i,
    sum(case when cnt_btc_rec_u2i > 0 then 1 end) as shows_btc_recblock_u2i,
    sum(case when cnt_cs_rec > 0 then 1 end) as shows_contact_recblock,
    sum(case when cnt_iv_rec > 0 then 1 end) as shows_item_view_recblock,
    sum(case when cnt_s_query_c > 0 then 1 end) as sq_c,
    sum(case when cnt_s_btc_date_sort > 0 then 1 end) as unq_x_s_btc_date_sort,
    sum(case when cnt_s_btc_default_sort > 0 then 1 end) as unq_x_s_btc_default_sort,
    sum(case when cnt_btc_s_noquery > 0 then 1 end) as unq_x_s_btc_noquery,
    sum(case when cnt_s_btc_price_sort > 0 then 1 end) as unq_x_s_btc_price_sort,
    sum(case when cnt_s_distr_with_iv_metro_road > 0 then 1 end) as unq_x_s_distr_with_iv_metro_road,
    sum(case when cnt_s_iv_date_sort > 0 then 1 end) as unq_x_s_iv_date_sort,
    sum(case when cnt_s_iv_default_sort > 0 then 1 end) as unq_x_s_iv_default_sort,
    sum(case when cnt_s_iv_price_sort > 0 then 1 end) as unq_x_s_iv_price_sort,
    sum(case when cnt_s_noquery_c > 0 then 1 end) as unq_x_s_noquery_c,
    sum(case when cnt_s_noquery_iv > 0 then 1 end) as unq_x_s_noquery_iv,
    sum(case when cnt_s_query_iv > 0 then 1 end) as unq_x_s_query_iv
from (
    select
        cookie_id, x,
        sum(case when search_flags & 17179869184 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as btc_s_multiloc,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743)) then 1 end) as buyer_target_clicks_metageo,
        sum(case when search_flags & 17179869184 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as c_s_multiloc,
        sum(case when x_eid = 2743 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_from_map,
        sum(case when ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_btc_rec,
        sum(case when x_eid = 4386 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_cv2vac,
        sum(case when x_eid = 2437 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_i2i,
        sum(case when x_eid in (2012, 2309) and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_rec_u2i,
        sum(case when search_flags & 2 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_distr,
        sum(case when x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_item_attr,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_map_area,
        sum(case when search_flags & 1 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_metro,
        sum(case when q = '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_noquery,
        sum(case when q > '' and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_query,
        sum(case when search_flags & 8 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_radius,
        sum(case when search_flags & 4 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_road,
        sum(case when search_flags & 64 > 0 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_s_saved,
        sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_shopx,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as cnt_btc_views_s_filter_price,
        sum(case when search_query_type = 12 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_dlv,
        sum(case when x_eid = 300 and ((eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 12 or search_query_type = 13 or search_query_type = 14 or search_query_type = 11)) then 1 end) as cnt_btc_wtc_dlv_new_auto_flats_reg,
        sum(case when search_query_type = 13 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_new_auto,
        sum(case when search_query_type = 14 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_new_flats,
        sum(case when search_query_type = 11 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_btc_wtc_reg,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_flags & 256 > 0 or search_flags & 512 > 0)) then 1 end) as cnt_contacts_s_filter_price,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 10 or search_query_type = 9 or search_query_type = 20 or search_query_type = 15 or search_query_type = 18)) then 1 end) as cnt_cs_any_ext_block,
        sum(case when item_flags & 131072 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_cpa,
        sum(case when search_query_type = 10 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_dlv,
        sum(case when x_eid = 400 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_fav_list,
        sum(case when x_eid = 2743 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_from_map,
        sum(case when search_query_type = 2 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_premium,
        sum(case when search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_push,
        sum(case when search_query_type = 15 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_qrm,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec,
        sum(case when item_flags & 131072 > 0 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386))) then 1 end) as cnt_cs_rec_cpa,
        sum(case when search_query_type = 9 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_reg,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 9 or search_query_type = 20)) then 1 end) as cnt_cs_reg_any,
        sum(case when search_query_type = 20 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_reg_mix,
        sum(case when x_eid = 300 and item_flags & 131072 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_cpa,
        sum(case when search_flags & 2 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_distr,
        sum(case when x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_item_attr,
        sum(case when search_flags & 16 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_map_area,
        sum(case when search_flags & 1 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_metro,
        sum(case when search_flags & 8 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_radius,
        sum(case when search_flags & 4 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_road,
        sum(case when search_flags & 64 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_s_saved,
        sum(case when x_eid = 300 and search_flags & 128 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_shopx,
        sum(case when item_serp_flags & 32527 > 0 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vas,
        sum(case when search_query_type = 18 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vec,
        sum(case when search_query_type = 3 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_vip,
        sum(case when search_query_type = 12 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_dlv,
        sum(case when x_eid = 300 and ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (search_query_type = 12 or search_query_type = 13 or search_query_type = 14 or search_query_type = 11)) then 1 end) as cnt_cs_wtc_dlv_new_auto_flats_reg,
        sum(case when search_query_type = 13 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_new_auto,
        sum(case when search_query_type = 14 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_new_flats,
        sum(case when search_query_type = 11 and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_cs_wtc_reg,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 400 then 1 end) as cnt_fav_list_iv,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (9, 10, 15, 18, 20)) then 1 end) as cnt_iv_any_ext_block,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 131072 > 0 then 1 end) as cnt_iv_cpa,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 10 and x_eid = 300 then 1 end) as cnt_iv_dlv,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 2743 then 1 end) as cnt_iv_from_map,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 2 and x_eid = 300 then 1 end) as cnt_iv_premium,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 1 and item_serp_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_iv_push,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 15 and x_eid = 300 then 1 end) as cnt_iv_qrm,
        sum(case when eid = 301 and item_x_type = 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec,
        sum(case when eid = 301 and item_x_type = 0 and item_flags & 131072 > 0 and (search_features & 1 > 0 or x_eid in (2012, 2309, 2437, 4126, 4386)) then 1 end) as cnt_iv_rec_cpa,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 9 and x_eid = 300 then 1 end) as cnt_iv_reg,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (9, 20)) then 1 end) as cnt_iv_reg_any,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 20 and x_eid = 300 then 1 end) as cnt_iv_reg_mix,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and item_flags & 131072 > 0 then 1 end) as cnt_iv_s_cpa,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 2 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_distr,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_flags & 768 > 0) then 1 end) as cnt_iv_s_filter_price,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 then 1 end) as cnt_iv_s_item_attr,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 16 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_map_area,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 1 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_metro,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 8 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_radius,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 4 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_road,
        sum(case when eid = 301 and item_x_type = 0 and search_flags & 64 > 0 and x_eid = 300 then 1 end) as cnt_iv_s_saved,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 128 > 0 then 1 end) as cnt_iv_shopx,
        sum(case when eid = 301 and item_x_type = 0 and item_serp_flags & 32527 > 0 and x_eid = 300 then 1 end) as cnt_iv_vas,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 18 and x_eid = 300 then 1 end) as cnt_iv_vec,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 3 and x_eid = 300 then 1 end) as cnt_iv_vip,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 12 and x_eid = 300 then 1 end) as cnt_iv_wtc_dlv,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_query_type in (11, 12, 13, 14, 16)) then 1 end) as cnt_iv_wtc_dlv_new_auto_flats_reg,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 13 and x_eid = 300 then 1 end) as cnt_iv_wtc_new_auto,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 14 and x_eid = 300 then 1 end) as cnt_iv_wtc_new_flats,
        sum(case when eid = 301 and item_x_type = 0 and search_query_type = 11 and x_eid = 300 then 1 end) as cnt_iv_wtc_reg,
        sum(case when search_sort in (1, 2) and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_btc_date_sort,
        sum(case when search_sort = 5 and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_btc_default_sort,
        sum(case when search_sort in (3, 4) and x_eid = 300 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_btc_price_sort,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and (search_flags & 7 > 0) then 1 end) as cnt_s_distr_with_iv_metro_road,
        sum(case when eid = 301 and item_x_type = 0 and search_sort in (1, 2) and x_eid = 300 then 1 end) as cnt_s_iv_date_sort,
        sum(case when eid = 301 and item_x_type = 0 and search_sort = 5 and x_eid = 300 then 1 end) as cnt_s_iv_default_sort,
        sum(case when eid = 301 and item_x_type = 0 and search_sort in (3, 4) and x_eid = 300 then 1 end) as cnt_s_iv_price_sort,
        sum(case when q = '' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_noquery_c,
        sum(case when eid = 301 and item_x_type = 0 and q = '' and x_eid = 300 then 1 end) as cnt_s_noquery_iv,
        sum(case when q > '' and x_eid = 300 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_query_c,
        sum(case when eid = 301 and item_x_type = 0 and q > '' and x_eid = 300 then 1 end) as cnt_s_query_iv,
        sum(case when x_eid = 300 and search_flags & 1024 > 0 and (eid in (303, 308, 401, 856, 857, 2013, 2015, 2483, 2581, 2654, 2732, 3005, 3461, 4035, 4066, 4198, 4600, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_u2i_btc,
        sum(case when x_eid = 300 and search_flags & 1024 > 0 and (eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) then 1 end) as cnt_s_u2i_c,
        sum(case when eid = 301 and item_x_type = 0 and x_eid = 300 and search_flags & 1024 > 0 then 1 end) as cnt_s_u2i_iv,
        sum(case when page_no = 0 and eid = 300 and search_flags & 16384 > 0 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_s_wtc_dlv,
        sum(case when page_no = 0 and eid = 300 and ((onmap = 0 or platform_id != 1) and (search_flags & 16384 > 0 or search_flags & 32768 > 0 or search_flags & 65536 > 0 or search_flags & 8192 > 0)) then 1 end) as cnt_s_wtc_dlv_new_auto_flats_reg,
        sum(case when ((eid in (303, 856, 857, 2581, 3005, 3461, 4066, 4198, 4675, 4813) and eid != 303 or eid = 303 and item_x_type = 0) and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743)) then 1 end) as contacts_metageo,
        sum(case when search_flags & 17179869184 > 0 and eid in (401, 2574, 2732) then 1 end) as fav_s_multiloc,
        sum(case when eid = 301 and item_x_type = 0 and (x_eid = 300 and (search_flags & 31 > 0 or search_query_type = 9 or search_query_type = 20) or x_eid = 2743) then 1 end) as item_views_metageo,
        sum(case when search_flags & 17179869184 > 0 and eid = 301 and item_x_type = 0 then 1 end) as iv_s_multiloc
    from buyer_stream t
    group by cookie_id, x
) _
;

create metrics buyer_stream_session_microcat_id_location_id as
select
    sum(case when cnt_cities_in_s > 0 then 1 end) as multi_city_sess,
    sum(case when cnt_reg_in_s > 0 then 1 end) as multi_region_sess,
    sum(case when searches > 0 then 1 end) as multiloc_sess,
    sum(case when cnt_cities_in_s > 0 then 1 end) as sess_search_1_plus_cities,
    sum(case when searches > 0 then 1 end) as sess_search_1_plus_locations,
    sum(case when cnt_reg_in_s > 0 then 1 end) as sess_search_1_plus_regions
from (
    select
        cookie_id, session,
        sum(case when cnt_cities_in_s > 2 then 1 end) as cnt_cities_in_s,
        sum(case when cnt_reg_in_s > 2 then 1 end) as cnt_reg_in_s,
        sum(case when searches > 2 then 1 end) as searches
    from (
        select
            cookie_id, session, microcat_id,
            sum(case when cnt_cities_in_s > 0 then 1 end) as cnt_cities_in_s,
            sum(case when cnt_reg_in_s > 0 then 1 end) as cnt_reg_in_s,
            sum(case when searches > 0 then 1 end) as searches
        from (
            select
                cookie_id, session, microcat_id, location_id,
                sum(case when location_level_id in (4, 5, 6) and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_cities_in_s,
                sum(case when location_level_id in (2, 3) and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_reg_in_s,
                sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches
            from buyer_stream t
            group by cookie_id, session, microcat_id, location_id
        ) _
        group by cookie_id, session, microcat_id
    ) _
    group by cookie_id, session
) _
;

create metrics buyer_stream_cookie_microcat_id_location_id as
select
    sum(case when searches > 0 then 1 end) as multiloc_users,
    sum(case when cnt_cities_in_s > 0 then 1 end) as user_search_1_plus_cities,
    sum(case when searches > 0 then 1 end) as user_search_1_plus_locations,
    sum(case when cnt_reg_in_s > 0 then 1 end) as user_search_1_plus_regions
from (
    select
        cookie_id, cookie,
        sum(case when cnt_cities_in_s > 1 then 1 end) as cnt_cities_in_s,
        sum(case when cnt_reg_in_s > 1 then 1 end) as cnt_reg_in_s,
        sum(case when searches > 2 then 1 end) as searches
    from (
        select
            cookie_id, cookie, microcat_id,
            sum(case when cnt_cities_in_s > 0 then 1 end) as cnt_cities_in_s,
            sum(case when cnt_reg_in_s > 0 then 1 end) as cnt_reg_in_s,
            sum(case when searches > 0 then 1 end) as searches
        from (
            select
                cookie_id, cookie, microcat_id, location_id,
                sum(case when location_level_id in (4, 5, 6) and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_cities_in_s,
                sum(case when location_level_id in (2, 3) and page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as cnt_reg_in_s,
                sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches
            from buyer_stream t
            group by cookie_id, cookie, microcat_id, location_id
        ) _
        group by cookie_id, cookie, microcat_id
    ) _
    group by cookie_id, cookie
) _
;

create metrics buyer_stream_location_id as
select
    sum(case when searches > 0 then 1 end) as uniq_locations_in_search
from (
    select
        cookie_id, location_id,
        sum(case when page_no = 0 and eid = 300 and (onmap = 0 or platform_id != 1) then 1 end) as searches
    from buyer_stream t
    group by cookie_id, location_id
) _
;
